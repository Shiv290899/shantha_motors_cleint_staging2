import{r as d,R as at,v as Hr,w as $a,j as t,u as Ra,G as Ea,a as Ta}from"./index-Ieo0N9F3.js";import{C as Fa,A as Ma,s as nn,D as br,a as yr,u as Yn,n as ut,l as vr,b as Ia}from"./caseInsensitive-D16MNlnB.js";import{f as Ba,i as xr,h as sr,S as Da,P as La}from"./PostServiceSheet-xW9kn41-.js";import{L as wr,d as He}from"./index-D-crTbsR.js";import{B as Ee}from"./button-CnzkbVQB.js";import{M as xn}from"./index-DJnp3ZGz.js";import{S as Gt}from"./index-D7eBwa3z.js";import{R as bt,a as po,S as rt}from"./index-CY9tsZK0.js";import{S as _a,I as yt,s as je}from"./index-CD4YwGtV.js";import{G as ir}from"./index-HpyCPvYK.js";import{C as qt}from"./index-BgLPR5_C.js";import{m as fo,q as ho,r as go,u as et,S as za,C as on,H as Va,M as Ua,U as Wa,y as qr,f as Oe,V as Ha,W as qa,X as Ga,Y as Ka,Z as Xa,$ as Ja,a0 as Ya,n as Gr,p as Kr,T as Nt,a1 as Za,t as io,K as Qa,x as es,o as ts,a2 as ns,j as yn,_ as Ho,l as Xr,c as Ft,a3 as qo,a4 as Go,G as os,O as Jr,a5 as rs,a6 as as,I as Dn,a7 as ss,a8 as Kt,a9 as Xe,v as kt,a as Yr,aa as Zr,d as Qr,e as Le,ab as Ke,b as ea,ac as ta,L as na,ad as Sr,ae as oa,af as is,ag as ls,ah as cs,R as jr,D as ds,P as us,Q as ms,B as Cr,z as De,A as ye}from"./TextArea-CAqhmoVd.js";import{T as ra}from"./index-Ds8OLNSI.js";import{T as tt}from"./index-Bu8NwQ7H.js";import{I as Mt}from"./AntdIcon-6jnzrDeS.js";import{R as ps,a as Ar}from"./ThunderboltOutlined--ij7Ig0C.js";import{a as fs,g as hs,F as G}from"./index-DhuOMrZ7.js";import{R as gs}from"./CheckOutlined-CJulnyn0.js";import{D as bs,R as ys,a as vs}from"./ReloadOutlined-BWu9n86q.js";import{F as xs}from"./Table-Dhv4ytuv.js";import{T as We}from"./index-Dshaf5ky.js";import{C as ws}from"./index-BnLSe9wz.js";import{p as Ss}from"./pickAttrs-gW2BtiuW.js";import{i as js}from"./index-Dbom8ACT.js";import{R as Cs}from"./EyeOutlined-3IAnEXsa.js";const Ko=d.createContext({}),As=e=>{const{antCls:n,componentCls:o,iconCls:r,avatarBg:c,avatarColor:i,containerSize:m,containerSizeLG:u,containerSizeSM:g,textFontSize:y,textFontSizeLG:b,textFontSizeSM:w,iconFontSize:B,iconFontSizeLG:S,iconFontSizeSM:$,borderRadius:E,borderRadiusLG:C,borderRadiusSM:h,lineWidth:T,lineType:N}=e,x=(j,M,R,W)=>({width:j,height:j,borderRadius:"50%",fontSize:M,[`&${o}-square`]:{borderRadius:W},[`&${o}-icon`]:{fontSize:R,[`> ${r}`]:{margin:0}}});return{[o]:Object.assign(Object.assign(Object.assign(Object.assign({},go(e)),{position:"relative",display:"inline-flex",justifyContent:"center",alignItems:"center",overflow:"hidden",color:i,whiteSpace:"nowrap",textAlign:"center",verticalAlign:"middle",background:c,border:`${et(T)} ${N} transparent`,"&-image":{background:"transparent"},[`${n}-image-img`]:{display:"block"}}),x(m,y,B,E)),{"&-lg":Object.assign({},x(u,b,S,C)),"&-sm":Object.assign({},x(g,w,$,h)),"> img":{display:"block",width:"100%",height:"100%",objectFit:"cover"}})}},Ns=e=>{const{componentCls:n,groupBorderColor:o,groupOverlapping:r,groupSpace:c}=e;return{[`${n}-group`]:{display:"inline-flex",[n]:{borderColor:o},"> *:not(:first-child)":{marginInlineStart:r}},[`${n}-group-popover`]:{[`${n} + ${n}`]:{marginInlineStart:c}}}},ks=e=>{const{controlHeight:n,controlHeightLG:o,controlHeightSM:r,fontSize:c,fontSizeLG:i,fontSizeXL:m,fontSizeHeading3:u,marginXS:g,marginXXS:y,colorBorderBg:b}=e;return{containerSize:n,containerSizeLG:o,containerSizeSM:r,textFontSize:c,textFontSizeLG:c,textFontSizeSM:c,iconFontSize:Math.round((i+m)/2),iconFontSizeLG:u,iconFontSizeSM:c,groupSpace:y,groupOverlapping:-g,groupBorderColor:b}},aa=fo("Avatar",e=>{const{colorTextLightSolid:n,colorTextPlaceholder:o}=e,r=ho(e,{avatarBg:o,avatarColor:n});return[As(r),Ns(r)]},ks);var Ps=function(e,n){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,r=Object.getOwnPropertySymbols(e);c<r.length;c++)n.indexOf(r[c])<0&&Object.prototype.propertyIsEnumerable.call(e,r[c])&&(o[r[c]]=e[r[c]]);return o};const sa=d.forwardRef((e,n)=>{const{prefixCls:o,shape:r,size:c,src:i,srcSet:m,icon:u,className:g,rootClassName:y,style:b,alt:w,draggable:B,children:S,crossOrigin:$,gap:E=4,onError:C}=e,h=Ps(e,["prefixCls","shape","size","src","srcSet","icon","className","rootClassName","style","alt","draggable","children","crossOrigin","gap","onError"]),[T,N]=d.useState(1),[x,j]=d.useState(!1),[M,R]=d.useState(!0),W=d.useRef(null),ae=d.useRef(null),U=za(n,W),{getPrefixCls:xe,avatar:re}=d.useContext(on),ee=d.useContext(Ko),I=()=>{if(!ae.current||!W.current)return;const he=ae.current.offsetWidth,oe=W.current.offsetWidth;he!==0&&oe!==0&&E*2<oe&&N(oe-E*2<he?(oe-E*2)/he:1)};d.useEffect(()=>{j(!0)},[]),d.useEffect(()=>{R(!0),N(1)},[i]),d.useEffect(I,[E]);const k=()=>{C?.()!==!1&&R(!1)},L=Va(he=>{var oe,Te;return(Te=(oe=c??ee?.size)!==null&&oe!==void 0?oe:he)!==null&&Te!==void 0?Te:"default"}),ne=Object.keys(typeof L=="object"?L||{}:{}).some(he=>["xs","sm","md","lg","xl","xxl"].includes(he)),le=Ua(ne),K=d.useMemo(()=>{if(typeof L!="object")return{};const he=Wa.find(Te=>le[Te]),oe=L[he];return oe?{width:oe,height:oe,fontSize:oe&&(u||S)?oe/2:18}:{}},[le,L]),Y=xe("avatar",o),te=qr(Y),[se,z,ie]=aa(Y,te),me=Oe({[`${Y}-lg`]:L==="large",[`${Y}-sm`]:L==="small"}),Ce=d.isValidElement(i),de=r||ee?.shape||"circle",pe=Oe(Y,me,re?.className,`${Y}-${de}`,{[`${Y}-image`]:Ce||i&&M,[`${Y}-icon`]:!!u},ie,te,g,y,z),we=typeof L=="number"?{width:L,height:L,fontSize:u?L/2:18}:{};let fe;if(typeof i=="string"&&M)fe=d.createElement("img",{src:i,draggable:B,srcSet:m,onError:k,alt:w,crossOrigin:$});else if(Ce)fe=i;else if(u)fe=u;else if(x||T!==1){const he=`scale(${T})`,oe={msTransform:he,WebkitTransform:he,transform:he};fe=d.createElement(Ha,{onResize:I},d.createElement("span",{className:`${Y}-string`,ref:ae,style:Object.assign({},oe)},S))}else fe=d.createElement("span",{className:`${Y}-string`,style:{opacity:0},ref:ae},S);return se(d.createElement("span",Object.assign({},h,{style:Object.assign(Object.assign(Object.assign(Object.assign({},we),K),re?.style),b),className:pe,ref:U}),fe))}),lo=e=>e?typeof e=="function"?e():e:null,Os=e=>{const{componentCls:n,popoverColor:o,titleMinWidth:r,fontWeightStrong:c,innerPadding:i,boxShadowSecondary:m,colorTextHeading:u,borderRadiusLG:g,zIndexPopup:y,titleMarginBottom:b,colorBgElevated:w,popoverBg:B,titleBorderBottom:S,innerContentPadding:$,titlePadding:E}=e;return[{[n]:Object.assign(Object.assign({},go(e)),{position:"absolute",top:0,left:{_skip_check_:!0,value:0},zIndex:y,fontWeight:"normal",whiteSpace:"normal",textAlign:"start",cursor:"auto",userSelect:"text","--valid-offset-x":"var(--arrow-offset-horizontal, var(--arrow-x))",transformOrigin:["var(--valid-offset-x, 50%)","var(--arrow-y, 50%)"].join(" "),"--antd-arrow-background-color":w,width:"max-content",maxWidth:"100vw","&-rtl":{direction:"rtl"},"&-hidden":{display:"none"},[`${n}-content`]:{position:"relative"},[`${n}-inner`]:{backgroundColor:B,backgroundClip:"padding-box",borderRadius:g,boxShadow:m,padding:i},[`${n}-title`]:{minWidth:r,marginBottom:b,color:u,fontWeight:c,borderBottom:S,padding:E},[`${n}-inner-content`]:{color:o,padding:$}})},Ga(e,"var(--antd-arrow-background-color)"),{[`${n}-pure`]:{position:"relative",maxWidth:"none",margin:e.sizePopupArrow,display:"inline-block",[`${n}-content`]:{display:"inline-block"}}}]},$s=e=>{const{componentCls:n}=e;return{[n]:Ka.map(o=>{const r=e[`${o}6`];return{[`&${n}-${o}`]:{"--antd-arrow-background-color":r,[`${n}-inner`]:{backgroundColor:r},[`${n}-arrow`]:{background:"transparent"}}}})}},Rs=e=>{const{lineWidth:n,controlHeight:o,fontHeight:r,padding:c,wireframe:i,zIndexPopupBase:m,borderRadiusLG:u,marginXS:g,lineType:y,colorSplit:b,paddingSM:w}=e,B=o-r,S=B/2,$=B/2-n,E=c;return Object.assign(Object.assign(Object.assign({titleMinWidth:177,zIndexPopup:m+30},Xa(e)),Ja({contentRadius:u,limitVerticalRadius:!0})),{innerPadding:i?0:12,titleMarginBottom:i?0:g,titlePadding:i?`${S}px ${E}px ${$}px`:0,titleBorderBottom:i?`${n}px ${y} ${b}`:"none",innerContentPadding:i?`${w}px ${E}px`:0})},ia=fo("Popover",e=>{const{colorBgElevated:n,colorText:o}=e,r=ho(e,{popoverBg:n,popoverColor:o});return[Os(r),$s(r),qa(r,"zoom-big")]},Rs,{resetStyle:!1,deprecatedTokens:[["width","titleMinWidth"],["minWidth","titleMinWidth"]]});var Es=function(e,n){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,r=Object.getOwnPropertySymbols(e);c<r.length;c++)n.indexOf(r[c])<0&&Object.prototype.propertyIsEnumerable.call(e,r[c])&&(o[r[c]]=e[r[c]]);return o};const la=({title:e,content:n,prefixCls:o})=>!e&&!n?null:d.createElement(d.Fragment,null,e&&d.createElement("div",{className:`${o}-title`},e),n&&d.createElement("div",{className:`${o}-inner-content`},n)),Ts=e=>{const{hashId:n,prefixCls:o,className:r,style:c,placement:i="top",title:m,content:u,children:g}=e,y=lo(m),b=lo(u),w=Oe(n,o,`${o}-pure`,`${o}-placement-${i}`,r);return d.createElement("div",{className:w,style:c},d.createElement("div",{className:`${o}-arrow`}),d.createElement(Ya,Object.assign({},e,{className:n,prefixCls:o}),g||d.createElement(la,{prefixCls:o,title:y,content:b})))},Fs=e=>{const{prefixCls:n,className:o}=e,r=Es(e,["prefixCls","className"]),{getPrefixCls:c}=d.useContext(on),i=c("popover",n),[m,u,g]=ia(i);return m(d.createElement(Ts,Object.assign({},r,{prefixCls:i,hashId:u,className:Oe(o,g)})))};var Ms=function(e,n){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,r=Object.getOwnPropertySymbols(e);c<r.length;c++)n.indexOf(r[c])<0&&Object.prototype.propertyIsEnumerable.call(e,r[c])&&(o[r[c]]=e[r[c]]);return o};const Is=d.forwardRef((e,n)=>{var o,r;const{prefixCls:c,title:i,content:m,overlayClassName:u,placement:g="top",trigger:y="hover",children:b,mouseEnterDelay:w=.1,mouseLeaveDelay:B=.1,onOpenChange:S,overlayStyle:$={},styles:E,classNames:C}=e,h=Ms(e,["prefixCls","title","content","overlayClassName","placement","trigger","children","mouseEnterDelay","mouseLeaveDelay","onOpenChange","overlayStyle","styles","classNames"]),{getPrefixCls:T,className:N,style:x,classNames:j,styles:M}=Gr("popover"),R=T("popover",c),[W,ae,U]=ia(R),xe=T(),re=Oe(u,ae,U,N,j.root,C?.root),ee=Oe(j.body,C?.body),[I,k]=Kr(!1,{value:(o=e.open)!==null&&o!==void 0?o:e.visible,defaultValue:(r=e.defaultOpen)!==null&&r!==void 0?r:e.defaultVisible}),L=(te,se)=>{k(te,!0),S?.(te,se)},ne=te=>{te.keyCode===Qa.ESC&&L(!1,te)},le=te=>{L(te)},K=lo(i),Y=lo(m);return W(d.createElement(Nt,Object.assign({placement:g,trigger:y,mouseEnterDelay:w,mouseLeaveDelay:B},h,{prefixCls:R,classNames:{root:re,body:ee},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign({},M.root),x),$),E?.root),body:Object.assign(Object.assign({},M.body),E?.body)},ref:n,open:I,onOpenChange:le,overlay:K||Y?d.createElement(la,{prefixCls:R,title:K,content:Y}):null,transitionName:Za(xe,"zoom-big",h.transitionName),"data-popover-inject":!0}),io(b,{onKeyDown:te=>{var se,z;d.isValidElement(b)&&((z=b==null?void 0:(se=b.props).onKeyDown)===null||z===void 0||z.call(se,te)),ne(te)}})))}),In=Is;In._InternalPanelDoNotUseOrYouWillBeFired=Fs;const Nr=e=>{const{size:n,shape:o}=d.useContext(Ko),r=d.useMemo(()=>({size:e.size||n,shape:e.shape||o}),[e.size,e.shape,n,o]);return d.createElement(Ko.Provider,{value:r},e.children)},Bs=e=>{var n,o,r,c;const{getPrefixCls:i,direction:m}=d.useContext(on),{prefixCls:u,className:g,rootClassName:y,style:b,maxCount:w,maxStyle:B,size:S,shape:$,maxPopoverPlacement:E,maxPopoverTrigger:C,children:h,max:T}=e,N=i("avatar",u),x=`${N}-group`,j=qr(N),[M,R,W]=aa(N,j),ae=Oe(x,{[`${x}-rtl`]:m==="rtl"},W,j,g,y,R),U=es(h).map((ee,I)=>io(ee,{key:`avatar-key-${I}`})),xe=T?.count||w,re=U.length;if(xe&&xe<re){const ee=U.slice(0,xe),I=U.slice(xe,re),k=T?.style||B,L=((n=T?.popover)===null||n===void 0?void 0:n.trigger)||C||"hover",ne=((o=T?.popover)===null||o===void 0?void 0:o.placement)||E||"top",le=Object.assign(Object.assign({content:I},T?.popover),{classNames:{root:Oe(`${x}-popover`,(c=(r=T?.popover)===null||r===void 0?void 0:r.classNames)===null||c===void 0?void 0:c.root)},placement:ne,trigger:L});return ee.push(d.createElement(In,Object.assign({key:"avatar-popover-key",destroyOnHidden:!0},le),d.createElement(sa,{style:k},`+${re-xe}`))),M(d.createElement(Nr,{shape:$,size:S},d.createElement("div",{className:ae,style:b},ee)))}return M(d.createElement(Nr,{shape:$,size:S},d.createElement("div",{className:ae,style:b},U)))},ca=sa;ca.Group=Bs;var Ds={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"}}]},name:"file-text",theme:"outlined"},Ls={percent:0,prefixCls:"rc-progress",strokeColor:"#2db7f5",strokeLinecap:"round",strokeWidth:1,trailColor:"#D9D9D9",trailWidth:1,gapPosition:"bottom"},_s=function(){var n=d.useRef([]),o=d.useRef(null);return d.useEffect(function(){var r=Date.now(),c=!1;n.current.forEach(function(i){if(i){c=!0;var m=i.style;m.transitionDuration=".3s, .3s, .3s, .06s",o.current&&r-o.current<100&&(m.transitionDuration="0s, 0s")}}),c&&(o.current=Date.now())}),n.current},kr=0,zs=ns();function Vs(){var e;return zs?(e=kr,kr+=1):e="TEST_OR_SSR",e}const Us=function(e){var n=d.useState(),o=ts(n,2),r=o[0],c=o[1];return d.useEffect(function(){c("rc_progress_".concat(Vs()))},[]),e||r};var Pr=function(n){var o=n.bg,r=n.children;return d.createElement("div",{style:{width:"100%",height:"100%",background:o}},r)};function Or(e,n){return Object.keys(e).map(function(o){var r=parseFloat(o),c="".concat(Math.floor(r*n),"%");return"".concat(e[o]," ").concat(c)})}var Ws=d.forwardRef(function(e,n){var o=e.prefixCls,r=e.color,c=e.gradientId,i=e.radius,m=e.style,u=e.ptg,g=e.strokeLinecap,y=e.strokeWidth,b=e.size,w=e.gapDegree,B=r&&yn(r)==="object",S=B?"#FFF":void 0,$=b/2,E=d.createElement("circle",{className:"".concat(o,"-circle-path"),r:i,cx:$,cy:$,stroke:S,strokeLinecap:g,strokeWidth:y,opacity:u===0?0:1,style:m,ref:n});if(!B)return E;var C="".concat(c,"-conic"),h=w?"".concat(180+w/2,"deg"):"0deg",T=Or(r,(360-w)/360),N=Or(r,1),x="conic-gradient(from ".concat(h,", ").concat(T.join(", "),")"),j="linear-gradient(to ".concat(w?"bottom":"top",", ").concat(N.join(", "),")");return d.createElement(d.Fragment,null,d.createElement("mask",{id:C},E),d.createElement("foreignObject",{x:0,y:0,width:b,height:b,mask:"url(#".concat(C,")")},d.createElement(Pr,{bg:j},d.createElement(Pr,{bg:x}))))}),Fn=100,Bo=function(n,o,r,c,i,m,u,g,y,b){var w=arguments.length>10&&arguments[10]!==void 0?arguments[10]:0,B=r/100*360*((360-m)/360),S=m===0?0:{bottom:0,top:180,left:90,right:-90}[u],$=(100-c)/100*o;y==="round"&&c!==100&&($+=b/2,$>=o&&($=o-.01));var E=Fn/2;return{stroke:typeof g=="string"?g:void 0,strokeDasharray:"".concat(o,"px ").concat(n),strokeDashoffset:$+w,transform:"rotate(".concat(i+B+S,"deg)"),transformOrigin:"".concat(E,"px ").concat(E,"px"),transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s, stroke-width .06s ease .3s, opacity .3s ease 0s",fillOpacity:0}},Hs=["id","prefixCls","steps","strokeWidth","trailWidth","gapDegree","gapPosition","trailColor","strokeLinecap","style","className","strokeColor","percent"];function $r(e){var n=e??[];return Array.isArray(n)?n:[n]}var qs=function(n){var o=Ho(Ho({},Ls),n),r=o.id,c=o.prefixCls,i=o.steps,m=o.strokeWidth,u=o.trailWidth,g=o.gapDegree,y=g===void 0?0:g,b=o.gapPosition,w=o.trailColor,B=o.strokeLinecap,S=o.style,$=o.className,E=o.strokeColor,C=o.percent,h=Xr(o,Hs),T=Fn/2,N=Us(r),x="".concat(N,"-gradient"),j=T-m/2,M=Math.PI*2*j,R=y>0?90+y/2:-90,W=M*((360-y)/360),ae=yn(i)==="object"?i:{count:i,gap:2},U=ae.count,xe=ae.gap,re=$r(C),ee=$r(E),I=ee.find(function(te){return te&&yn(te)==="object"}),k=I&&yn(I)==="object",L=k?"butt":B,ne=Bo(M,W,0,100,R,y,b,w,L,m),le=_s(),K=function(){var se=0;return re.map(function(z,ie){var me=ee[ie]||ee[ee.length-1],Ce=Bo(M,W,se,z,R,y,b,me,L,m);return se+=z,d.createElement(Ws,{key:ie,color:me,ptg:z,radius:j,prefixCls:c,gradientId:x,style:Ce,strokeLinecap:L,strokeWidth:m,gapDegree:y,ref:function(pe){le[ie]=pe},size:Fn})}).reverse()},Y=function(){var se=Math.round(U*(re[0]/100)),z=100/U,ie=0;return new Array(U).fill(null).map(function(me,Ce){var de=Ce<=se-1?ee[0]:w,pe=de&&yn(de)==="object"?"url(#".concat(x,")"):void 0,we=Bo(M,W,ie,z,R,y,b,de,"butt",m,xe);return ie+=(W-we.strokeDashoffset+xe)*100/W,d.createElement("circle",{key:Ce,className:"".concat(c,"-circle-path"),r:j,cx:T,cy:T,stroke:pe,strokeWidth:m,opacity:1,style:we,ref:function(he){le[Ce]=he}})})};return d.createElement("svg",Ft({className:Oe("".concat(c,"-circle"),$),viewBox:"0 0 ".concat(Fn," ").concat(Fn),style:S,id:r,role:"presentation"},h),!U&&d.createElement("circle",{className:"".concat(c,"-circle-trail"),r:j,cx:T,cy:T,stroke:w,strokeLinecap:L,strokeWidth:u||m,style:ne}),U?Y():K())};function Xt(e){return!e||e<0?0:e>100?100:e}function co({success:e,successPercent:n}){let o=n;return e&&"progress"in e&&(o=e.progress),e&&"percent"in e&&(o=e.percent),o}const Gs=({percent:e,success:n,successPercent:o})=>{const r=Xt(co({success:n,successPercent:o}));return[r,Xt(Xt(e)-r)]},Ks=({success:e={},strokeColor:n})=>{const{strokeColor:o}=e;return[o||qo.green,n||null]},bo=(e,n,o)=>{var r,c,i,m;let u=-1,g=-1;if(n==="step"){const y=o.steps,b=o.strokeWidth;typeof e=="string"||typeof e>"u"?(u=e==="small"?2:14,g=b??8):typeof e=="number"?[u,g]=[e,e]:[u=14,g=8]=Array.isArray(e)?e:[e.width,e.height],u*=y}else if(n==="line"){const y=o?.strokeWidth;typeof e=="string"||typeof e>"u"?g=y||(e==="small"?6:8):typeof e=="number"?[u,g]=[e,e]:[u=-1,g=8]=Array.isArray(e)?e:[e.width,e.height]}else(n==="circle"||n==="dashboard")&&(typeof e=="string"||typeof e>"u"?[u,g]=e==="small"?[60,60]:[120,120]:typeof e=="number"?[u,g]=[e,e]:Array.isArray(e)&&(u=(c=(r=e[0])!==null&&r!==void 0?r:e[1])!==null&&c!==void 0?c:120,g=(m=(i=e[0])!==null&&i!==void 0?i:e[1])!==null&&m!==void 0?m:120));return[u,g]},Xs=3,Js=e=>Xs/e*100,Ys=e=>{const{prefixCls:n,trailColor:o=null,strokeLinecap:r="round",gapPosition:c,gapDegree:i,width:m=120,type:u,children:g,success:y,size:b=m,steps:w}=e,[B,S]=bo(b,"circle");let{strokeWidth:$}=e;$===void 0&&($=Math.max(Js(B),6));const E={width:B,height:S,fontSize:B*.15+6},C=d.useMemo(()=>{if(i||i===0)return i;if(u==="dashboard")return 75},[i,u]),h=Gs(e),T=c||u==="dashboard"&&"bottom"||void 0,N=Object.prototype.toString.call(e.strokeColor)==="[object Object]",x=Ks({success:y,strokeColor:e.strokeColor}),j=Oe(`${n}-inner`,{[`${n}-circle-gradient`]:N}),M=d.createElement(qs,{steps:w,percent:w?h[1]:h,strokeWidth:$,trailWidth:$,strokeColor:w?x[1]:x,strokeLinecap:r,trailColor:o,prefixCls:n,gapDegree:C,gapPosition:T}),R=B<=20,W=d.createElement("div",{className:j,style:E},M,!R&&g);return R?d.createElement(Nt,{title:g},W):W},uo="--progress-line-stroke-color",da="--progress-percent",Rr=e=>{const n=e?"100%":"-100%";return new Go(`antProgress${e?"RTL":"LTR"}Active`,{"0%":{transform:`translateX(${n}) scaleX(0)`,opacity:.1},"20%":{transform:`translateX(${n}) scaleX(0)`,opacity:.5},to:{transform:"translateX(0) scaleX(1)",opacity:0}})},Zs=e=>{const{componentCls:n,iconCls:o}=e;return{[n]:Object.assign(Object.assign({},go(e)),{display:"inline-block","&-rtl":{direction:"rtl"},"&-line":{position:"relative",width:"100%",fontSize:e.fontSize},[`${n}-outer`]:{display:"inline-flex",alignItems:"center",width:"100%"},[`${n}-inner`]:{position:"relative",display:"inline-block",width:"100%",flex:1,overflow:"hidden",verticalAlign:"middle",backgroundColor:e.remainingColor,borderRadius:e.lineBorderRadius},[`${n}-inner:not(${n}-circle-gradient)`]:{[`${n}-circle-path`]:{stroke:e.defaultColor}},[`${n}-success-bg, ${n}-bg`]:{position:"relative",background:e.defaultColor,borderRadius:e.lineBorderRadius,transition:`all ${e.motionDurationSlow} ${e.motionEaseInOutCirc}`},[`${n}-layout-bottom`]:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",[`${n}-text`]:{width:"max-content",marginInlineStart:0,marginTop:e.marginXXS}},[`${n}-bg`]:{overflow:"hidden","&::after":{content:'""',background:{_multi_value_:!0,value:["inherit",`var(${uo})`]},height:"100%",width:`calc(1 / var(${da}) * 100%)`,display:"block"},[`&${n}-bg-inner`]:{minWidth:"max-content","&::after":{content:"none"},[`${n}-text-inner`]:{color:e.colorWhite,[`&${n}-text-bright`]:{color:"rgba(0, 0, 0, 0.45)"}}}},[`${n}-success-bg`]:{position:"absolute",insetBlockStart:0,insetInlineStart:0,backgroundColor:e.colorSuccess},[`${n}-text`]:{display:"inline-block",marginInlineStart:e.marginXS,color:e.colorText,lineHeight:1,width:"2em",whiteSpace:"nowrap",textAlign:"start",verticalAlign:"middle",wordBreak:"normal",[o]:{fontSize:e.fontSize},[`&${n}-text-outer`]:{width:"max-content"},[`&${n}-text-outer${n}-text-start`]:{width:"max-content",marginInlineStart:0,marginInlineEnd:e.marginXS}},[`${n}-text-inner`]:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",marginInlineStart:0,padding:`0 ${et(e.paddingXXS)}`,[`&${n}-text-start`]:{justifyContent:"start"},[`&${n}-text-end`]:{justifyContent:"end"}},[`&${n}-status-active`]:{[`${n}-bg::before`]:{position:"absolute",inset:0,backgroundColor:e.colorBgContainer,borderRadius:e.lineBorderRadius,opacity:0,animationName:Rr(),animationDuration:e.progressActiveMotionDuration,animationTimingFunction:e.motionEaseOutQuint,animationIterationCount:"infinite",content:'""'}},[`&${n}-rtl${n}-status-active`]:{[`${n}-bg::before`]:{animationName:Rr(!0)}},[`&${n}-status-exception`]:{[`${n}-bg`]:{backgroundColor:e.colorError},[`${n}-text`]:{color:e.colorError}},[`&${n}-status-exception ${n}-inner:not(${n}-circle-gradient)`]:{[`${n}-circle-path`]:{stroke:e.colorError}},[`&${n}-status-success`]:{[`${n}-bg`]:{backgroundColor:e.colorSuccess},[`${n}-text`]:{color:e.colorSuccess}},[`&${n}-status-success ${n}-inner:not(${n}-circle-gradient)`]:{[`${n}-circle-path`]:{stroke:e.colorSuccess}}})}},Qs=e=>{const{componentCls:n,iconCls:o}=e;return{[n]:{[`${n}-circle-trail`]:{stroke:e.remainingColor},[`&${n}-circle ${n}-inner`]:{position:"relative",lineHeight:1,backgroundColor:"transparent"},[`&${n}-circle ${n}-text`]:{position:"absolute",insetBlockStart:"50%",insetInlineStart:0,width:"100%",margin:0,padding:0,color:e.circleTextColor,fontSize:e.circleTextFontSize,lineHeight:1,whiteSpace:"normal",textAlign:"center",transform:"translateY(-50%)",[o]:{fontSize:e.circleIconFontSize}},[`${n}-circle&-status-exception`]:{[`${n}-text`]:{color:e.colorError}},[`${n}-circle&-status-success`]:{[`${n}-text`]:{color:e.colorSuccess}}},[`${n}-inline-circle`]:{lineHeight:1,[`${n}-inner`]:{verticalAlign:"bottom"}}}},ei=e=>{const{componentCls:n}=e;return{[n]:{[`${n}-steps`]:{display:"inline-block","&-outer":{display:"flex",flexDirection:"row",alignItems:"center"},"&-item":{flexShrink:0,minWidth:e.progressStepMinWidth,marginInlineEnd:e.progressStepMarginInlineEnd,backgroundColor:e.remainingColor,transition:`all ${e.motionDurationSlow}`,"&-active":{backgroundColor:e.defaultColor}}}}}},ti=e=>{const{componentCls:n,iconCls:o}=e;return{[n]:{[`${n}-small&-line, ${n}-small&-line ${n}-text ${o}`]:{fontSize:e.fontSizeSM}}}},ni=e=>({circleTextColor:e.colorText,defaultColor:e.colorInfo,remainingColor:e.colorFillSecondary,lineBorderRadius:100,circleTextFontSize:"1em",circleIconFontSize:`${e.fontSize/e.fontSizeSM}em`}),oi=fo("Progress",e=>{const n=e.calc(e.marginXXS).div(2).equal(),o=ho(e,{progressStepMarginInlineEnd:n,progressStepMinWidth:n,progressActiveMotionDuration:"2.4s"});return[Zs(o),Qs(o),ei(o),ti(o)]},ni);var ri=function(e,n){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,r=Object.getOwnPropertySymbols(e);c<r.length;c++)n.indexOf(r[c])<0&&Object.prototype.propertyIsEnumerable.call(e,r[c])&&(o[r[c]]=e[r[c]]);return o};const ai=e=>{let n=[];return Object.keys(e).forEach(o=>{const r=parseFloat(o.replace(/%/g,""));Number.isNaN(r)||n.push({key:r,value:e[o]})}),n=n.sort((o,r)=>o.key-r.key),n.map(({key:o,value:r})=>`${r} ${o}%`).join(", ")},si=(e,n)=>{const{from:o=qo.blue,to:r=qo.blue,direction:c=n==="rtl"?"to left":"to right"}=e,i=ri(e,["from","to","direction"]);if(Object.keys(i).length!==0){const u=ai(i),g=`linear-gradient(${c}, ${u})`;return{background:g,[uo]:g}}const m=`linear-gradient(${c}, ${o}, ${r})`;return{background:m,[uo]:m}},ii=e=>{const{prefixCls:n,direction:o,percent:r,size:c,strokeWidth:i,strokeColor:m,strokeLinecap:u="round",children:g,trailColor:y=null,percentPosition:b,success:w}=e,{align:B,type:S}=b,$=m&&typeof m!="string"?si(m,o):{[uo]:m,background:m},E=u==="square"||u==="butt"?0:void 0,C=c??[-1,i||(c==="small"?6:8)],[h,T]=bo(C,"line",{strokeWidth:i}),N={backgroundColor:y||void 0,borderRadius:E},x=Object.assign(Object.assign({width:`${Xt(r)}%`,height:T,borderRadius:E},$),{[da]:Xt(r)/100}),j=co(e),M={width:`${Xt(j)}%`,height:T,borderRadius:E,backgroundColor:w?.strokeColor},R={width:h<0?"100%":h},W=d.createElement("div",{className:`${n}-inner`,style:N},d.createElement("div",{className:Oe(`${n}-bg`,`${n}-bg-${S}`),style:x},S==="inner"&&g),j!==void 0&&d.createElement("div",{className:`${n}-success-bg`,style:M})),ae=S==="outer"&&B==="start",U=S==="outer"&&B==="end";return S==="outer"&&B==="center"?d.createElement("div",{className:`${n}-layout-bottom`},W,g):d.createElement("div",{className:`${n}-outer`,style:R},ae&&g,W,U&&g)},li=e=>{const{size:n,steps:o,rounding:r=Math.round,percent:c=0,strokeWidth:i=8,strokeColor:m,trailColor:u=null,prefixCls:g,children:y}=e,b=r(o*(c/100)),B=n??[n==="small"?2:14,i],[S,$]=bo(B,"step",{steps:o,strokeWidth:i}),E=S/o,C=Array.from({length:o});for(let h=0;h<o;h++){const T=Array.isArray(m)?m[h]:m;C[h]=d.createElement("div",{key:h,className:Oe(`${g}-steps-item`,{[`${g}-steps-item-active`]:h<=b-1}),style:{backgroundColor:h<=b-1?T:u,width:E,height:$}})}return d.createElement("div",{className:`${g}-steps-outer`},C,y)};var ci=function(e,n){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,r=Object.getOwnPropertySymbols(e);c<r.length;c++)n.indexOf(r[c])<0&&Object.prototype.propertyIsEnumerable.call(e,r[c])&&(o[r[c]]=e[r[c]]);return o};const di=["normal","exception","active","success"],ua=d.forwardRef((e,n)=>{const{prefixCls:o,className:r,rootClassName:c,steps:i,strokeColor:m,percent:u=0,size:g="default",showInfo:y=!0,type:b="line",status:w,format:B,style:S,percentPosition:$={}}=e,E=ci(e,["prefixCls","className","rootClassName","steps","strokeColor","percent","size","showInfo","type","status","format","style","percentPosition"]),{align:C="end",type:h="outer"}=$,T=Array.isArray(m)?m[0]:m,N=typeof m=="string"||Array.isArray(m)?m:void 0,x=d.useMemo(()=>{if(T){const K=typeof T=="string"?T:Object.values(T)[0];return new os(K).isLight()}return!1},[m]),j=d.useMemo(()=>{var K,Y;const te=co(e);return parseInt(te!==void 0?(K=te??0)===null||K===void 0?void 0:K.toString():(Y=u??0)===null||Y===void 0?void 0:Y.toString(),10)},[u,e.success,e.successPercent]),M=d.useMemo(()=>!di.includes(w)&&j>=100?"success":w||"normal",[w,j]),{getPrefixCls:R,direction:W,progress:ae}=d.useContext(on),U=R("progress",o),[xe,re,ee]=oi(U),I=b==="line",k=I&&!i,L=d.useMemo(()=>{if(!y)return null;const K=co(e);let Y;const te=B||(z=>`${z}%`),se=I&&x&&h==="inner";return h==="inner"||B||M!=="exception"&&M!=="success"?Y=te(Xt(u),Xt(K)):M==="exception"?Y=I?d.createElement(rs,null):d.createElement(as,null):M==="success"&&(Y=I?d.createElement(fs,null):d.createElement(gs,null)),d.createElement("span",{className:Oe(`${U}-text`,{[`${U}-text-bright`]:se,[`${U}-text-${C}`]:k,[`${U}-text-${h}`]:k}),title:typeof Y=="string"?Y:void 0},Y)},[y,u,j,M,b,U,B]);let ne;b==="line"?ne=i?d.createElement(li,Object.assign({},e,{strokeColor:N,prefixCls:U,steps:typeof i=="object"?i.count:i}),L):d.createElement(ii,Object.assign({},e,{strokeColor:T,prefixCls:U,direction:W,percentPosition:{align:C,type:h}}),L):(b==="circle"||b==="dashboard")&&(ne=d.createElement(Ys,Object.assign({},e,{strokeColor:T,prefixCls:U,progressStatus:M}),L));const le=Oe(U,`${U}-status-${M}`,{[`${U}-${b==="dashboard"&&"circle"||b}`]:b!=="line",[`${U}-inline-circle`]:b==="circle"&&bo(g,"circle")[0]<=20,[`${U}-line`]:k,[`${U}-line-align-${C}`]:k,[`${U}-line-position-${h}`]:k,[`${U}-steps`]:i,[`${U}-show-info`]:y,[`${U}-${g}`]:typeof g=="string",[`${U}-rtl`]:W==="rtl"},ae?.className,r,c,re,ee);return xe(d.createElement("div",Object.assign({ref:n,style:Object.assign(Object.assign({},ae?.style),S),className:le,role:"progressbar","aria-valuenow":j,"aria-valuemin":0,"aria-valuemax":100},Jr(E,["trailColor","strokeWidth","width","gapDegree","gapPosition","strokeLinecap","success","successPercent"])),ne))});var ui={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-792 72h752v120H136V232zm752 560H136V440h752v352zm-237-64h165c4.4 0 8-3.6 8-8v-72c0-4.4-3.6-8-8-8H651c-4.4 0-8 3.6-8 8v72c0 4.4 3.6 8 8 8z"}}]},name:"credit-card",theme:"outlined"},mi=function(n,o){return d.createElement(Dn,Ft({},n,{ref:o,icon:bs}))},pi=d.forwardRef(mi),fi={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},hi=function(n,o){return d.createElement(Dn,Ft({},n,{ref:o,icon:fi}))},gi=d.forwardRef(hi),bi={icon:function(n,o){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M534 352V136H232v752h560V394H576a42 42 0 01-42-42z",fill:o}},{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM602 137.8L790.2 326H602V137.8zM792 888H232V136h302v216a42 42 0 0042 42h216v494z",fill:n}}]}},name:"file",theme:"twotone"},yi=function(n,o){return d.createElement(Dn,Ft({},n,{ref:o,icon:bi}))},vi=d.forwardRef(yi),xi={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"},wi={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M536.1 273H488c-4.4 0-8 3.6-8 8v275.3c0 2.6 1.2 5 3.3 6.5l165.3 120.7c3.6 2.6 8.6 1.9 11.2-1.7l28.6-39c2.7-3.7 1.9-8.7-1.7-11.2L544.1 528.5V281c0-4.4-3.6-8-8-8zm219.8 75.2l156.8 38.3c5 1.2 9.9-2.6 9.9-7.7l.8-161.5c0-6.7-7.7-10.5-12.9-6.3L752.9 334.1a8 8 0 003 14.1zm167.7 301.1l-56.7-19.5a8 8 0 00-10.1 4.8c-1.9 5.1-3.9 10.1-6 15.1-17.8 42.1-43.3 80-75.9 112.5a353 353 0 01-112.5 75.9 352.18 352.18 0 01-137.7 27.8c-47.8 0-94.1-9.3-137.7-27.8a353 353 0 01-112.5-75.9c-32.5-32.5-58-70.4-75.9-112.5A353.44 353.44 0 01171 512c0-47.8 9.3-94.2 27.8-137.8 17.8-42.1 43.3-80 75.9-112.5a353 353 0 01112.5-75.9C430.6 167.3 477 158 524.8 158s94.1 9.3 137.7 27.8A353 353 0 01775 261.7c10.2 10.3 19.8 21 28.6 32.3l59.8-46.8C784.7 146.6 662.2 81.9 524.6 82 285 82.1 92.6 276.7 95 516.4 97.4 751.9 288.9 942 524.8 942c185.5 0 343.5-117.6 403.7-282.3 1.5-4.2-.7-8.9-4.9-10.4z"}}]},name:"history",theme:"outlined"},Si={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"},ji={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M779.3 196.6c-94.2-94.2-247.6-94.2-341.7 0l-261 260.8c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l261-260.8c32.4-32.4 75.5-50.2 121.3-50.2s88.9 17.8 121.2 50.2c32.4 32.4 50.2 75.5 50.2 121.2 0 45.8-17.8 88.8-50.2 121.2l-266 265.9-43.1 43.1c-40.3 40.3-105.8 40.3-146.1 0-19.5-19.5-30.2-45.4-30.2-73s10.7-53.5 30.2-73l263.9-263.8c6.7-6.6 15.5-10.3 24.9-10.3h.1c9.4 0 18.1 3.7 24.7 10.3 6.7 6.7 10.3 15.5 10.3 24.9 0 9.3-3.7 18.1-10.3 24.7L372.4 653c-1.7 1.7-2.6 4-2.6 6.4s.9 4.7 2.6 6.4l36.9 36.9a9 9 0 0012.7 0l215.6-215.6c19.9-19.9 30.8-46.3 30.8-74.4s-11-54.6-30.8-74.4c-41.1-41.1-107.9-41-149 0L463 364 224.8 602.1A172.22 172.22 0 00174 724.8c0 46.3 18.1 89.8 50.8 122.5 33.9 33.8 78.3 50.7 122.7 50.7 44.4 0 88.8-16.9 122.6-50.7l309.2-309C824.8 492.7 850 432 850 367.5c.1-64.6-25.1-125.3-70.7-170.9z"}}]},name:"paper-clip",theme:"outlined"},Ci=function(n,o){return d.createElement(Dn,Ft({},n,{ref:o,icon:ji}))},Ai=d.forwardRef(Ci),Ni={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M877.1 238.7L770.6 132.3c-13-13-30.4-20.3-48.8-20.3s-35.8 7.2-48.8 20.3L558.3 246.8c-13 13-20.3 30.5-20.3 48.9 0 18.5 7.2 35.8 20.3 48.9l89.6 89.7a405.46 405.46 0 01-86.4 127.3c-36.7 36.9-79.6 66-127.2 86.6l-89.6-89.7c-13-13-30.4-20.3-48.8-20.3a68.2 68.2 0 00-48.8 20.3L132.3 673c-13 13-20.3 30.5-20.3 48.9 0 18.5 7.2 35.8 20.3 48.9l106.4 106.4c22.2 22.2 52.8 34.9 84.2 34.9 6.5 0 12.8-.5 19.2-1.6 132.4-21.8 263.8-92.3 369.9-198.3C818 606 888.4 474.6 910.4 342.1c6.3-37.6-6.3-76.3-33.3-103.4zm-37.6 91.5c-19.5 117.9-82.9 235.5-178.4 331s-213 158.9-330.9 178.4c-14.8 2.5-30-2.5-40.8-13.2L184.9 721.9 295.7 611l119.8 120 .9.9 21.6-8a481.29 481.29 0 00285.7-285.8l8-21.6-120.8-120.7 110.8-110.9 104.5 104.5c10.8 10.8 15.8 26 13.3 40.8z"}}]},name:"phone",theme:"outlined"},ki={icon:function(n,o){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2z",fill:n}},{tag:"path",attrs:{d:"M424.6 765.8l-150.1-178L136 752.1V792h752v-30.4L658.1 489z",fill:o}},{tag:"path",attrs:{d:"M136 652.7l132.4-157c3.2-3.8 9-3.8 12.2 0l144 170.7L652 396.8c3.2-3.8 9-3.8 12.2 0L888 662.2V232H136v420.7zM304 280a88 88 0 110 176 88 88 0 010-176z",fill:o}},{tag:"path",attrs:{d:"M276 368a28 28 0 1056 0 28 28 0 10-56 0z",fill:o}},{tag:"path",attrs:{d:"M304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z",fill:n}}]}},name:"picture",theme:"twotone"},Pi=function(n,o){return d.createElement(Dn,Ft({},n,{ref:o,icon:ki}))},Oi=d.forwardRef(Pi),$i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M882 272.1V144c0-17.7-14.3-32-32-32H174c-17.7 0-32 14.3-32 32v128.1c-16.7 1-30 14.9-30 31.9v131.7a177 177 0 0014.4 70.4c4.3 10.2 9.6 19.8 15.6 28.9v345c0 17.6 14.3 32 32 32h676c17.7 0 32-14.3 32-32V535a175 175 0 0015.6-28.9c9.5-22.3 14.4-46 14.4-70.4V304c0-17-13.3-30.9-30-31.9zM214 184h596v88H214v-88zm362 656.1H448V736h128v104.1zm234 0H640V704c0-17.7-14.3-32-32-32H416c-17.7 0-32 14.3-32 32v136.1H214V597.9c2.9 1.4 5.9 2.8 9 4 22.3 9.4 46 14.1 70.4 14.1s48-4.7 70.4-14.1c13.8-5.8 26.8-13.2 38.7-22.1.2-.1.4-.1.6 0a180.4 180.4 0 0038.7 22.1c22.3 9.4 46 14.1 70.4 14.1 24.4 0 48-4.7 70.4-14.1 13.8-5.8 26.8-13.2 38.7-22.1.2-.1.4-.1.6 0a180.4 180.4 0 0038.7 22.1c22.3 9.4 46 14.1 70.4 14.1 24.4 0 48-4.7 70.4-14.1 3-1.3 6-2.6 9-4v242.2zm30-404.4c0 59.8-49 108.3-109.3 108.3-40.8 0-76.4-22.1-95.2-54.9-2.9-5-8.1-8.1-13.9-8.1h-.6c-5.7 0-11 3.1-13.9 8.1A109.24 109.24 0 01512 544c-40.7 0-76.2-22-95-54.7-3-5.1-8.4-8.3-14.3-8.3s-11.4 3.2-14.3 8.3a109.63 109.63 0 01-95.1 54.7C233 544 184 495.5 184 435.7v-91.2c0-.3.2-.5.5-.5h655c.3 0 .5.2.5.5v91.2z"}}]},name:"shop",theme:"outlined"};const Do=function(e,n){if(e&&n){var o=Array.isArray(n)?n:n.split(","),r=e.name||"",c=e.type||"",i=c.replace(/\/.*$/,"");return o.some(function(m){var u=m.trim();if(/^\*(\/\*)?$/.test(m))return!0;if(u.charAt(0)==="."){var g=r.toLowerCase(),y=u.toLowerCase(),b=[y];return(y===".jpg"||y===".jpeg")&&(b=[".jpg",".jpeg"]),b.some(function(w){return g.endsWith(w)})}return/\/\*$/.test(u)?i===u.replace(/\/.*$/,""):c===u?!0:/^\w+$/.test(u)?(ss(!1,"Upload takes an invalidate 'accept' type '".concat(u,"'.Skip for check.")),!0):!1})}return!0};function Ri(e,n){var o="cannot ".concat(e.method," ").concat(e.action," ").concat(n.status,"'"),r=new Error(o);return r.status=n.status,r.method=e.method,r.url=e.action,r}function Er(e){var n=e.responseText||e.response;if(!n)return n;try{return JSON.parse(n)}catch{return n}}function Ei(e){var n=new XMLHttpRequest;e.onProgress&&n.upload&&(n.upload.onprogress=function(i){i.total>0&&(i.percent=i.loaded/i.total*100),e.onProgress(i)});var o=new FormData;e.data&&Object.keys(e.data).forEach(function(c){var i=e.data[c];if(Array.isArray(i)){i.forEach(function(m){o.append("".concat(c,"[]"),m)});return}o.append(c,i)}),e.file instanceof Blob?o.append(e.filename,e.file,e.file.name):o.append(e.filename,e.file),n.onerror=function(i){e.onError(i)},n.onload=function(){return n.status<200||n.status>=300?e.onError(Ri(e,n),Er(n)):e.onSuccess(Er(n),n)},n.open(e.method,e.action,!0),e.withCredentials&&"withCredentials"in n&&(n.withCredentials=!0);var r=e.headers||{};return r["X-Requested-With"]!==null&&n.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(r).forEach(function(c){r[c]!==null&&n.setRequestHeader(c,r[c])}),n.send(o),{abort:function(){n.abort()}}}var Ti=function(){var e=Kt(Xe().mark(function n(o,r){var c,i,m,u,g,y,b,w;return Xe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:y=function(){return y=Kt(Xe().mark(function E(C){return Xe().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.abrupt("return",new Promise(function(N){C.file(function(x){r(x)?(C.fullPath&&!x.webkitRelativePath&&(Object.defineProperties(x,{webkitRelativePath:{writable:!0}}),x.webkitRelativePath=C.fullPath.replace(/^\//,""),Object.defineProperties(x,{webkitRelativePath:{writable:!1}})),N(x)):N(null)})}));case 1:case"end":return T.stop()}},E)})),y.apply(this,arguments)},g=function(E){return y.apply(this,arguments)},u=function(){return u=Kt(Xe().mark(function E(C){var h,T,N,x,j;return Xe().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:h=C.createReader(),T=[];case 2:return R.next=5,new Promise(function(W){h.readEntries(W,function(){return W([])})});case 5:if(N=R.sent,x=N.length,x){R.next=9;break}return R.abrupt("break",12);case 9:for(j=0;j<x;j++)T.push(N[j]);R.next=2;break;case 12:return R.abrupt("return",T);case 13:case"end":return R.stop()}},E)})),u.apply(this,arguments)},m=function(E){return u.apply(this,arguments)},c=[],i=[],o.forEach(function($){return i.push($.webkitGetAsEntry())}),b=function(){var $=Kt(Xe().mark(function E(C,h){var T,N;return Xe().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(C){j.next=2;break}return j.abrupt("return");case 2:if(C.path=h||"",!C.isFile){j.next=10;break}return j.next=6,g(C);case 6:T=j.sent,T&&c.push(T),j.next=15;break;case 10:if(!C.isDirectory){j.next=15;break}return j.next=13,m(C);case 13:N=j.sent,i.push.apply(i,kt(N));case 15:case"end":return j.stop()}},E)}));return function(C,h){return $.apply(this,arguments)}}(),w=0;case 9:if(!(w<i.length)){S.next=15;break}return S.next=12,b(i[w]);case 12:w++,S.next=9;break;case 15:return S.abrupt("return",c);case 16:case"end":return S.stop()}},n)}));return function(o,r){return e.apply(this,arguments)}}(),Fi=+new Date,Mi=0;function Lo(){return"rc-upload-".concat(Fi,"-").concat(++Mi)}var Ii=["component","prefixCls","className","classNames","disabled","id","name","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],Bi=function(e){Yr(o,e);var n=Zr(o);function o(){var r;Qr(this,o);for(var c=arguments.length,i=new Array(c),m=0;m<c;m++)i[m]=arguments[m];return r=n.call.apply(n,[this].concat(i)),Le(Ke(r),"state",{uid:Lo()}),Le(Ke(r),"reqs",{}),Le(Ke(r),"fileInput",void 0),Le(Ke(r),"_isMounted",void 0),Le(Ke(r),"onChange",function(u){var g=r.props,y=g.accept,b=g.directory,w=u.target.files,B=kt(w).filter(function(S){return!b||Do(S,y)});r.uploadFiles(B),r.reset()}),Le(Ke(r),"onClick",function(u){var g=r.fileInput;if(g){var y=u.target,b=r.props.onClick;if(y&&y.tagName==="BUTTON"){var w=g.parentNode;w.focus(),y.blur()}g.click(),b&&b(u)}}),Le(Ke(r),"onKeyDown",function(u){u.key==="Enter"&&r.onClick(u)}),Le(Ke(r),"onDataTransferFiles",function(){var u=Kt(Xe().mark(function g(y,b){var w,B,S,$,E,C,h;return Xe().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(w=r.props,B=w.multiple,S=w.accept,$=w.directory,E=kt(y.items||[]),C=kt(y.files||[]),(C.length>0||E.some(function(x){return x.kind==="file"}))&&b?.(),!$){N.next=11;break}return N.next=7,Ti(Array.prototype.slice.call(E),function(x){return Do(x,r.props.accept)});case 7:C=N.sent,r.uploadFiles(C),N.next=14;break;case 11:h=kt(C).filter(function(x){return Do(x,S)}),B===!1&&(h=C.slice(0,1)),r.uploadFiles(h);case 14:case"end":return N.stop()}},g)}));return function(g,y){return u.apply(this,arguments)}}()),Le(Ke(r),"onFilePaste",function(){var u=Kt(Xe().mark(function g(y){var b,w;return Xe().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:if(b=r.props.pastable,b){S.next=3;break}return S.abrupt("return");case 3:if(y.type!=="paste"){S.next=6;break}return w=y.clipboardData,S.abrupt("return",r.onDataTransferFiles(w,function(){y.preventDefault()}));case 6:case"end":return S.stop()}},g)}));return function(g){return u.apply(this,arguments)}}()),Le(Ke(r),"onFileDragOver",function(u){u.preventDefault()}),Le(Ke(r),"onFileDrop",function(){var u=Kt(Xe().mark(function g(y){var b;return Xe().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(y.preventDefault(),y.type!=="drop"){B.next=4;break}return b=y.dataTransfer,B.abrupt("return",r.onDataTransferFiles(b));case 4:case"end":return B.stop()}},g)}));return function(g){return u.apply(this,arguments)}}()),Le(Ke(r),"uploadFiles",function(u){var g=kt(u),y=g.map(function(b){return b.uid=Lo(),r.processFile(b,g)});Promise.all(y).then(function(b){var w=r.props.onBatchStart;w?.(b.map(function(B){var S=B.origin,$=B.parsedFile;return{file:S,parsedFile:$}})),b.filter(function(B){return B.parsedFile!==null}).forEach(function(B){r.post(B)})})}),Le(Ke(r),"processFile",function(){var u=Kt(Xe().mark(function g(y,b){var w,B,S,$,E,C,h,T,N;return Xe().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(w=r.props.beforeUpload,B=y,!w){j.next=14;break}return j.prev=3,j.next=6,w(y,b);case 6:B=j.sent,j.next=12;break;case 9:j.prev=9,j.t0=j.catch(3),B=!1;case 12:if(B!==!1){j.next=14;break}return j.abrupt("return",{origin:y,parsedFile:null,action:null,data:null});case 14:if(S=r.props.action,typeof S!="function"){j.next=21;break}return j.next=18,S(y);case 18:$=j.sent,j.next=22;break;case 21:$=S;case 22:if(E=r.props.data,typeof E!="function"){j.next=29;break}return j.next=26,E(y);case 26:C=j.sent,j.next=30;break;case 29:C=E;case 30:return h=(yn(B)==="object"||typeof B=="string")&&B?B:y,h instanceof File?T=h:T=new File([h],y.name,{type:y.type}),N=T,N.uid=y.uid,j.abrupt("return",{origin:y,data:C,parsedFile:N,action:$});case 35:case"end":return j.stop()}},g,null,[[3,9]])}));return function(g,y){return u.apply(this,arguments)}}()),Le(Ke(r),"saveFileInput",function(u){r.fileInput=u}),r}return ea(o,[{key:"componentDidMount",value:function(){this._isMounted=!0;var c=this.props.pastable;c&&document.addEventListener("paste",this.onFilePaste)}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort(),document.removeEventListener("paste",this.onFilePaste)}},{key:"componentDidUpdate",value:function(c){var i=this.props.pastable;i&&!c.pastable?document.addEventListener("paste",this.onFilePaste):!i&&c.pastable&&document.removeEventListener("paste",this.onFilePaste)}},{key:"post",value:function(c){var i=this,m=c.data,u=c.origin,g=c.action,y=c.parsedFile;if(this._isMounted){var b=this.props,w=b.onStart,B=b.customRequest,S=b.name,$=b.headers,E=b.withCredentials,C=b.method,h=u.uid,T=B||Ei,N={action:g,filename:S,data:m,file:y,headers:$,withCredentials:E,method:C||"post",onProgress:function(j){var M=i.props.onProgress;M?.(j,y)},onSuccess:function(j,M){var R=i.props.onSuccess;R?.(j,y,M),delete i.reqs[h]},onError:function(j,M){var R=i.props.onError;R?.(j,M,y),delete i.reqs[h]}};w(u),this.reqs[h]=T(N)}}},{key:"reset",value:function(){this.setState({uid:Lo()})}},{key:"abort",value:function(c){var i=this.reqs;if(c){var m=c.uid?c.uid:c;i[m]&&i[m].abort&&i[m].abort(),delete i[m]}else Object.keys(i).forEach(function(u){i[u]&&i[u].abort&&i[u].abort(),delete i[u]})}},{key:"render",value:function(){var c=this.props,i=c.component,m=c.prefixCls,u=c.className,g=c.classNames,y=g===void 0?{}:g,b=c.disabled,w=c.id,B=c.name,S=c.style,$=c.styles,E=$===void 0?{}:$,C=c.multiple,h=c.accept,T=c.capture,N=c.children,x=c.directory,j=c.openFileDialogOnClick,M=c.onMouseEnter,R=c.onMouseLeave,W=c.hasControlInside,ae=Xr(c,Ii),U=Oe(Le(Le(Le({},m,!0),"".concat(m,"-disabled"),b),u,u)),xe=x?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},re=b?{}:{onClick:j?this.onClick:function(){},onKeyDown:j?this.onKeyDown:function(){},onMouseEnter:M,onMouseLeave:R,onDrop:this.onFileDrop,onDragOver:this.onFileDragOver,tabIndex:W?void 0:"0"};return at.createElement(i,Ft({},re,{className:U,role:W?void 0:"button",style:S}),at.createElement("input",Ft({},Ss(ae,{aria:!0,data:!0}),{id:w,name:B,disabled:b,type:"file",ref:this.saveFileInput,onClick:function(I){return I.stopPropagation()},key:this.state.uid,style:Ho({display:"none"},E.input),className:y.input,accept:h},xe,{multiple:C,onChange:this.onChange},T!=null?{capture:T}:{})),N)}}]),o}(d.Component);function _o(){}var Xo=function(e){Yr(o,e);var n=Zr(o);function o(){var r;Qr(this,o);for(var c=arguments.length,i=new Array(c),m=0;m<c;m++)i[m]=arguments[m];return r=n.call.apply(n,[this].concat(i)),Le(Ke(r),"uploader",void 0),Le(Ke(r),"saveUploader",function(u){r.uploader=u}),r}return ea(o,[{key:"abort",value:function(c){this.uploader.abort(c)}},{key:"render",value:function(){return at.createElement(Bi,Ft({},this.props,{ref:this.saveUploader}))}}]),o}(d.Component);Le(Xo,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:_o,onError:_o,onSuccess:_o,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});const Di=e=>{const{componentCls:n,iconCls:o}=e;return{[`${n}-wrapper`]:{[`${n}-drag`]:{position:"relative",width:"100%",height:"100%",textAlign:"center",background:e.colorFillAlter,border:`${et(e.lineWidth)} dashed ${e.colorBorder}`,borderRadius:e.borderRadiusLG,cursor:"pointer",transition:`border-color ${e.motionDurationSlow}`,[n]:{padding:e.padding},[`${n}-btn`]:{display:"table",width:"100%",height:"100%",outline:"none",borderRadius:e.borderRadiusLG,"&:focus-visible":{outline:`${et(e.lineWidthFocus)} solid ${e.colorPrimaryBorder}`}},[`${n}-drag-container`]:{display:"table-cell",verticalAlign:"middle"},[`
          &:not(${n}-disabled):hover,
          &-hover:not(${n}-disabled)
        `]:{borderColor:e.colorPrimaryHover},[`p${n}-drag-icon`]:{marginBottom:e.margin,[o]:{color:e.colorPrimary,fontSize:e.uploadThumbnailSize}},[`p${n}-text`]:{margin:`0 0 ${et(e.marginXXS)}`,color:e.colorTextHeading,fontSize:e.fontSizeLG},[`p${n}-hint`]:{color:e.colorTextDescription,fontSize:e.fontSize},[`&${n}-disabled`]:{[`p${n}-drag-icon ${o},
            p${n}-text,
            p${n}-hint
          `]:{color:e.colorTextDisabled}}}}}},Li=e=>{const{componentCls:n,iconCls:o,fontSize:r,lineHeight:c,calc:i}=e,m=`${n}-list-item`,u=`${m}-actions`,g=`${m}-action`;return{[`${n}-wrapper`]:{[`${n}-list`]:Object.assign(Object.assign({},ta()),{lineHeight:e.lineHeight,[m]:{position:"relative",height:i(e.lineHeight).mul(r).equal(),marginTop:e.marginXS,fontSize:r,display:"flex",alignItems:"center",transition:`background-color ${e.motionDurationSlow}`,borderRadius:e.borderRadiusSM,"&:hover":{backgroundColor:e.controlItemBgHover},[`${m}-name`]:Object.assign(Object.assign({},na),{padding:`0 ${et(e.paddingXS)}`,lineHeight:c,flex:"auto",transition:`all ${e.motionDurationSlow}`}),[u]:{whiteSpace:"nowrap",[g]:{opacity:0},[o]:{color:e.actionsColor,transition:`all ${e.motionDurationSlow}`},[`
              ${g}:focus-visible,
              &.picture ${g}
            `]:{opacity:1}},[`${n}-icon ${o}`]:{color:e.colorIcon,fontSize:r},[`${m}-progress`]:{position:"absolute",bottom:e.calc(e.uploadProgressOffset).mul(-1).equal(),width:"100%",paddingInlineStart:i(r).add(e.paddingXS).equal(),fontSize:r,lineHeight:0,pointerEvents:"none","> div":{margin:0}}},[`${m}:hover ${g}`]:{opacity:1},[`${m}-error`]:{color:e.colorError,[`${m}-name, ${n}-icon ${o}`]:{color:e.colorError},[u]:{[`${o}, ${o}:hover`]:{color:e.colorError},[g]:{opacity:1}}},[`${n}-list-item-container`]:{transition:`opacity ${e.motionDurationSlow}, height ${e.motionDurationSlow}`,"&::before":{display:"table",width:0,height:0,content:'""'}}})}}},_i=e=>{const{componentCls:n}=e,o=new Go("uploadAnimateInlineIn",{from:{width:0,height:0,padding:0,opacity:0,margin:e.calc(e.marginXS).div(-2).equal()}}),r=new Go("uploadAnimateInlineOut",{to:{width:0,height:0,padding:0,opacity:0,margin:e.calc(e.marginXS).div(-2).equal()}}),c=`${n}-animate-inline`;return[{[`${n}-wrapper`]:{[`${c}-appear, ${c}-enter, ${c}-leave`]:{animationDuration:e.motionDurationSlow,animationTimingFunction:e.motionEaseInOutCirc,animationFillMode:"forwards"},[`${c}-appear, ${c}-enter`]:{animationName:o},[`${c}-leave`]:{animationName:r}}},{[`${n}-wrapper`]:js(e)},o,r]},zi=e=>{const{componentCls:n,iconCls:o,uploadThumbnailSize:r,uploadProgressOffset:c,calc:i}=e,m=`${n}-list`,u=`${m}-item`;return{[`${n}-wrapper`]:{[`
        ${m}${m}-picture,
        ${m}${m}-picture-card,
        ${m}${m}-picture-circle
      `]:{[u]:{position:"relative",height:i(r).add(i(e.lineWidth).mul(2)).add(i(e.paddingXS).mul(2)).equal(),padding:e.paddingXS,border:`${et(e.lineWidth)} ${e.lineType} ${e.colorBorder}`,borderRadius:e.borderRadiusLG,"&:hover":{background:"transparent"},[`${u}-thumbnail`]:Object.assign(Object.assign({},na),{width:r,height:r,lineHeight:et(i(r).add(e.paddingSM).equal()),textAlign:"center",flex:"none",[o]:{fontSize:e.fontSizeHeading2,color:e.colorPrimary},img:{display:"block",width:"100%",height:"100%",overflow:"hidden"}}),[`${u}-progress`]:{bottom:c,width:`calc(100% - ${et(i(e.paddingSM).mul(2).equal())})`,marginTop:0,paddingInlineStart:i(r).add(e.paddingXS).equal()}},[`${u}-error`]:{borderColor:e.colorError,[`${u}-thumbnail ${o}`]:{[`svg path[fill='${Sr[0]}']`]:{fill:e.colorErrorBg},[`svg path[fill='${Sr.primary}']`]:{fill:e.colorError}}},[`${u}-uploading`]:{borderStyle:"dashed",[`${u}-name`]:{marginBottom:c}}},[`${m}${m}-picture-circle ${u}`]:{[`&, &::before, ${u}-thumbnail`]:{borderRadius:"50%"}}}}},Vi=e=>{const{componentCls:n,iconCls:o,fontSizeLG:r,colorTextLightSolid:c,calc:i}=e,m=`${n}-list`,u=`${m}-item`,g=e.uploadPicCardSize;return{[`
      ${n}-wrapper${n}-picture-card-wrapper,
      ${n}-wrapper${n}-picture-circle-wrapper
    `]:Object.assign(Object.assign({},ta()),{display:"block",[`${n}${n}-select`]:{width:g,height:g,textAlign:"center",verticalAlign:"top",backgroundColor:e.colorFillAlter,border:`${et(e.lineWidth)} dashed ${e.colorBorder}`,borderRadius:e.borderRadiusLG,cursor:"pointer",transition:`border-color ${e.motionDurationSlow}`,[`> ${n}`]:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center"},[`&:not(${n}-disabled):hover`]:{borderColor:e.colorPrimary}},[`${m}${m}-picture-card, ${m}${m}-picture-circle`]:{display:"flex",flexWrap:"wrap","@supports not (gap: 1px)":{"& > *":{marginBlockEnd:e.marginXS,marginInlineEnd:e.marginXS}},"@supports (gap: 1px)":{gap:e.marginXS},[`${m}-item-container`]:{display:"inline-block",width:g,height:g,verticalAlign:"top"},"&::after":{display:"none"},"&::before":{display:"none"},[u]:{height:"100%",margin:0,"&::before":{position:"absolute",zIndex:1,width:`calc(100% - ${et(i(e.paddingXS).mul(2).equal())})`,height:`calc(100% - ${et(i(e.paddingXS).mul(2).equal())})`,backgroundColor:e.colorBgMask,opacity:0,transition:`all ${e.motionDurationSlow}`,content:'" "'}},[`${u}:hover`]:{[`&::before, ${u}-actions`]:{opacity:1}},[`${u}-actions`]:{position:"absolute",insetInlineStart:0,zIndex:10,width:"100%",whiteSpace:"nowrap",textAlign:"center",opacity:0,transition:`all ${e.motionDurationSlow}`,[`
            ${o}-eye,
            ${o}-download,
            ${o}-delete
          `]:{zIndex:10,width:r,margin:`0 ${et(e.marginXXS)}`,fontSize:r,cursor:"pointer",transition:`all ${e.motionDurationSlow}`,color:c,"&:hover":{color:c},svg:{verticalAlign:"baseline"}}},[`${u}-thumbnail, ${u}-thumbnail img`]:{position:"static",display:"block",width:"100%",height:"100%",objectFit:"contain"},[`${u}-name`]:{display:"none",textAlign:"center"},[`${u}-file + ${u}-name`]:{position:"absolute",bottom:e.margin,display:"block",width:`calc(100% - ${et(i(e.paddingXS).mul(2).equal())})`},[`${u}-uploading`]:{[`&${u}`]:{backgroundColor:e.colorFillAlter},[`&::before, ${o}-eye, ${o}-download, ${o}-delete`]:{display:"none"}},[`${u}-progress`]:{bottom:e.marginXL,width:`calc(100% - ${et(i(e.paddingXS).mul(2).equal())})`,paddingInlineStart:0}}}),[`${n}-wrapper${n}-picture-circle-wrapper`]:{[`${n}${n}-select`]:{borderRadius:"50%"}}}},Ui=e=>{const{componentCls:n}=e;return{[`${n}-rtl`]:{direction:"rtl"}}},Wi=e=>{const{componentCls:n,colorTextDisabled:o}=e;return{[`${n}-wrapper`]:Object.assign(Object.assign({},go(e)),{[n]:{outline:0,"input[type='file']":{cursor:"pointer"}},[`${n}-select`]:{display:"inline-block"},[`${n}-hidden`]:{display:"none"},[`${n}-disabled`]:{color:o,cursor:"not-allowed"}})}},Hi=e=>({actionsColor:e.colorIcon}),qi=fo("Upload",e=>{const{fontSizeHeading3:n,fontHeight:o,lineWidth:r,controlHeightLG:c,calc:i}=e,m=ho(e,{uploadThumbnailSize:i(n).mul(2).equal(),uploadProgressOffset:i(i(o).div(2)).add(r).equal(),uploadPicCardSize:i(c).mul(2.55).equal()});return[Wi(m),Di(m),zi(m),Vi(m),Li(m),_i(m),Ui(m),hs(m)]},Hi);function Zn(e){return Object.assign(Object.assign({},e),{lastModified:e.lastModified,lastModifiedDate:e.lastModifiedDate,name:e.name,size:e.size,type:e.type,uid:e.uid,percent:0,originFileObj:e})}function Qn(e,n){const o=kt(n),r=o.findIndex(({uid:c})=>c===e.uid);return r===-1?o.push(e):o[r]=e,o}function zo(e,n){const o=e.uid!==void 0?"uid":"name";return n.filter(r=>r[o]===e[o])[0]}function Gi(e,n){const o=e.uid!==void 0?"uid":"name",r=n.filter(c=>c[o]!==e[o]);return r.length===n.length?null:r}const Ki=(e="")=>{const n=e.split("/"),r=n[n.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(r)||[""])[0]},ma=e=>e.indexOf("image/")===0,Xi=e=>{if(e.type&&!e.thumbUrl)return ma(e.type);const n=e.thumbUrl||e.url||"",o=Ki(n);return/^data:image\//.test(n)||/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico|heic|heif)$/i.test(o)?!0:!(/^data:/.test(n)||o)},Wt=200;function Ji(e){return new Promise(n=>{if(!e.type||!ma(e.type)){n("");return}const o=document.createElement("canvas");o.width=Wt,o.height=Wt,o.style.cssText=`position: fixed; left: 0; top: 0; width: ${Wt}px; height: ${Wt}px; z-index: 9999; display: none;`,document.body.appendChild(o);const r=o.getContext("2d"),c=new Image;if(c.onload=()=>{const{width:i,height:m}=c;let u=Wt,g=Wt,y=0,b=0;i>m?(g=m*(Wt/i),b=-(g-u)/2):(u=i*(Wt/m),y=-(u-g)/2),r.drawImage(c,y,b,u,g);const w=o.toDataURL();document.body.removeChild(o),window.URL.revokeObjectURL(c.src),n(w)},c.crossOrigin="anonymous",e.type.startsWith("image/svg+xml")){const i=new FileReader;i.onload=()=>{i.result&&typeof i.result=="string"&&(c.src=i.result)},i.readAsDataURL(e)}else if(e.type.startsWith("image/gif")){const i=new FileReader;i.onload=()=>{i.result&&n(i.result)},i.readAsDataURL(e)}else c.src=window.URL.createObjectURL(e)})}const Yi=d.forwardRef(({prefixCls:e,className:n,style:o,locale:r,listType:c,file:i,items:m,progress:u,iconRender:g,actionIconRender:y,itemRender:b,isImgUrl:w,showPreviewIcon:B,showRemoveIcon:S,showDownloadIcon:$,previewIcon:E,removeIcon:C,downloadIcon:h,extra:T,onPreview:N,onDownload:x,onClose:j},M)=>{var R,W;const{status:ae}=i,[U,xe]=d.useState(ae);d.useEffect(()=>{ae!=="removed"&&xe(ae)},[ae]);const[re,ee]=d.useState(!1);d.useEffect(()=>{const oe=setTimeout(()=>{ee(!0)},300);return()=>{clearTimeout(oe)}},[]);const I=g(i);let k=d.createElement("div",{className:`${e}-icon`},I);if(c==="picture"||c==="picture-card"||c==="picture-circle")if(U==="uploading"||!i.thumbUrl&&!i.url){const oe=Oe(`${e}-list-item-thumbnail`,{[`${e}-list-item-file`]:U!=="uploading"});k=d.createElement("div",{className:oe},I)}else{const oe=w?.(i)?d.createElement("img",{src:i.thumbUrl||i.url,alt:i.name,className:`${e}-list-item-image`,crossOrigin:i.crossOrigin}):I,Te=Oe(`${e}-list-item-thumbnail`,{[`${e}-list-item-file`]:w&&!w(i)});k=d.createElement("a",{className:Te,onClick:Me=>N(i,Me),href:i.url||i.thumbUrl,target:"_blank",rel:"noopener noreferrer"},oe)}const L=Oe(`${e}-list-item`,`${e}-list-item-${U}`),ne=typeof i.linkProps=="string"?JSON.parse(i.linkProps):i.linkProps,le=(typeof S=="function"?S(i):S)?y((typeof C=="function"?C(i):C)||d.createElement(pi,null),()=>j(i),e,r.removeFile,!0):null,K=(typeof $=="function"?$(i):$)&&U==="done"?y((typeof h=="function"?h(i):h)||d.createElement(gi,null),()=>x(i),e,r.downloadFile):null,Y=c!=="picture-card"&&c!=="picture-circle"&&d.createElement("span",{key:"download-delete",className:Oe(`${e}-list-item-actions`,{picture:c==="picture"})},K,le),te=typeof T=="function"?T(i):T,se=te&&d.createElement("span",{className:`${e}-list-item-extra`},te),z=Oe(`${e}-list-item-name`),ie=i.url?d.createElement("a",Object.assign({key:"view",target:"_blank",rel:"noopener noreferrer",className:z,title:i.name},ne,{href:i.url,onClick:oe=>N(i,oe)}),i.name,se):d.createElement("span",{key:"view",className:z,onClick:oe=>N(i,oe),title:i.name},i.name,se),me=(typeof B=="function"?B(i):B)&&(i.url||i.thumbUrl)?d.createElement("a",{href:i.url||i.thumbUrl,target:"_blank",rel:"noopener noreferrer",onClick:oe=>N(i,oe),title:r.previewFile},typeof E=="function"?E(i):E||d.createElement(Cs,null)):null,Ce=(c==="picture-card"||c==="picture-circle")&&U!=="uploading"&&d.createElement("span",{className:`${e}-list-item-actions`},me,U==="done"&&K,le),{getPrefixCls:de}=d.useContext(on),pe=de(),we=d.createElement("div",{className:L},k,ie,Y,Ce,re&&d.createElement(oa,{motionName:`${pe}-fade`,visible:U==="uploading",motionDeadline:2e3},({className:oe})=>{const Te="percent"in i?d.createElement(ua,Object.assign({type:"line",percent:i.percent,"aria-label":i["aria-label"],"aria-labelledby":i["aria-labelledby"]},u)):null;return d.createElement("div",{className:Oe(`${e}-list-item-progress`,oe)},Te)})),fe=i.response&&typeof i.response=="string"?i.response:((R=i.error)===null||R===void 0?void 0:R.statusText)||((W=i.error)===null||W===void 0?void 0:W.message)||r.uploadError,he=U==="error"?d.createElement(Nt,{title:fe,getPopupContainer:oe=>oe.parentNode},we):we;return d.createElement("div",{className:Oe(`${e}-list-item-container`,n),style:o,ref:M},b?b(he,i,m,{download:x.bind(null,i),preview:N.bind(null,i),remove:j.bind(null,i)}):he)}),Zi=(e,n)=>{const{listType:o="text",previewFile:r=Ji,onPreview:c,onDownload:i,onRemove:m,locale:u,iconRender:g,isImageUrl:y=Xi,prefixCls:b,items:w=[],showPreviewIcon:B=!0,showRemoveIcon:S=!0,showDownloadIcon:$=!1,removeIcon:E,previewIcon:C,downloadIcon:h,extra:T,progress:N={size:[-1,2],showInfo:!1},appendAction:x,appendActionVisible:j=!0,itemRender:M,disabled:R}=e,W=is(),[ae,U]=d.useState(!1),xe=["picture-card","picture-circle"].includes(o);d.useEffect(()=>{o.startsWith("picture")&&(w||[]).forEach(z=>{!(z.originFileObj instanceof File||z.originFileObj instanceof Blob)||z.thumbUrl!==void 0||(z.thumbUrl="",r?.(z.originFileObj).then(ie=>{z.thumbUrl=ie||"",W()}))})},[o,w,r]),d.useEffect(()=>{U(!0)},[]);const re=(z,ie)=>{if(c)return ie?.preventDefault(),c(z)},ee=z=>{typeof i=="function"?i(z):z.url&&window.open(z.url)},I=z=>{m?.(z)},k=z=>{if(g)return g(z,o);const ie=z.status==="uploading";if(o.startsWith("picture")){const me=o==="picture"?d.createElement(jr,null):u.uploading,Ce=y?.(z)?d.createElement(Oi,null):d.createElement(vi,null);return ie?me:Ce}return ie?d.createElement(jr,null):d.createElement(Ai,null)},L=(z,ie,me,Ce,de)=>{const pe={type:"text",size:"small",title:Ce,onClick:we=>{var fe,he;ie(),d.isValidElement(z)&&((he=(fe=z.props).onClick)===null||he===void 0||he.call(fe,we))},className:`${me}-list-item-action`,disabled:de?R:!1};return d.isValidElement(z)?d.createElement(Ee,Object.assign({},pe,{icon:io(z,Object.assign(Object.assign({},z.props),{onClick:()=>{}}))})):d.createElement(Ee,Object.assign({},pe),d.createElement("span",null,z))};d.useImperativeHandle(n,()=>({handlePreview:re,handleDownload:ee}));const{getPrefixCls:ne}=d.useContext(on),le=ne("upload",b),K=ne(),Y=Oe(`${le}-list`,`${le}-list-${o}`),te=d.useMemo(()=>Jr(ls(K),["onAppearEnd","onEnterEnd","onLeaveEnd"]),[K]),se=Object.assign(Object.assign({},xe?{}:te),{motionDeadline:2e3,motionName:`${le}-${xe?"animate-inline":"animate"}`,keys:kt(w.map(z=>({key:z.uid,file:z}))),motionAppear:ae});return d.createElement("div",{className:Y},d.createElement(cs,Object.assign({},se,{component:!1}),({key:z,file:ie,className:me,style:Ce})=>d.createElement(Yi,{key:z,locale:u,prefixCls:le,className:me,style:Ce,file:ie,items:w,progress:N,listType:o,isImgUrl:y,showPreviewIcon:B,showRemoveIcon:S,showDownloadIcon:$,removeIcon:E,previewIcon:C,downloadIcon:h,extra:T,iconRender:k,actionIconRender:L,itemRender:M,onPreview:re,onDownload:ee,onClose:I})),x&&d.createElement(oa,Object.assign({},se,{visible:j,forceRender:!0}),({className:z,style:ie})=>io(x,me=>({className:Oe(me.className,z),style:Object.assign(Object.assign(Object.assign({},ie),{pointerEvents:z?"none":void 0}),me.style)}))))},Qi=d.forwardRef(Zi);var el=function(e,n,o,r){function c(i){return i instanceof o?i:new o(function(m){m(i)})}return new(o||(o=Promise))(function(i,m){function u(b){try{y(r.next(b))}catch(w){m(w)}}function g(b){try{y(r.throw(b))}catch(w){m(w)}}function y(b){b.done?i(b.value):c(b.value).then(u,g)}y((r=r.apply(e,[])).next())})};const Mn=`__LIST_IGNORE_${Date.now()}__`,tl=(e,n)=>{const o=Gr("upload"),{fileList:r,defaultFileList:c,onRemove:i,showUploadList:m=!0,listType:u="text",onPreview:g,onDownload:y,onChange:b,onDrop:w,previewFile:B,disabled:S,locale:$,iconRender:E,isImageUrl:C,progress:h,prefixCls:T,className:N,type:x="select",children:j,style:M,itemRender:R,maxCount:W,data:ae={},multiple:U=!1,hasControlInside:xe=!0,action:re="",accept:ee="",supportServerRender:I=!0,rootClassName:k}=e,L=d.useContext(ds),ne=S??L,le=e.customRequest||o.customRequest,[K,Y]=Kr(c||[],{value:r,postState:ue=>ue??[]}),[te,se]=d.useState("drop"),z=d.useRef(null),ie=d.useRef(null);d.useMemo(()=>{const ue=Date.now();(r||[]).forEach((X,ke)=>{!X.uid&&!Object.isFrozen(X)&&(X.uid=`__AUTO__${ue}_${ke}__`)})},[r]);const me=(ue,X,ke)=>{let ge=kt(X),Pe=!1;W===1?ge=ge.slice(-1):W&&(Pe=ge.length>W,ge=ge.slice(0,W)),Cr.flushSync(()=>{Y(ge)});const Fe={file:ue,fileList:ge};ke&&(Fe.event=ke),(!Pe||ue.status==="removed"||ge.some(st=>st.uid===ue.uid))&&Cr.flushSync(()=>{b?.(Fe)})},Ce=(ue,X)=>el(void 0,void 0,void 0,function*(){const{beforeUpload:ke,transformFile:ge}=e;let Pe=ue;if(ke){const Fe=yield ke(ue,X);if(Fe===!1)return!1;if(delete ue[Mn],Fe===Mn)return Object.defineProperty(ue,Mn,{value:!0,configurable:!0}),!1;typeof Fe=="object"&&Fe&&(Pe=Fe)}return ge&&(Pe=yield ge(Pe)),Pe}),de=ue=>{const X=ue.filter(Pe=>!Pe.file[Mn]);if(!X.length)return;const ke=X.map(Pe=>Zn(Pe.file));let ge=kt(K);ke.forEach(Pe=>{ge=Qn(Pe,ge)}),ke.forEach((Pe,Fe)=>{let st=Pe;if(X[Fe].parsedFile)Pe.status="uploading";else{const{originFileObj:nt}=Pe;let Ie;try{Ie=new File([nt],nt.name,{type:nt.type})}catch{Ie=new Blob([nt],{type:nt.type}),Ie.name=nt.name,Ie.lastModifiedDate=new Date,Ie.lastModified=new Date().getTime()}Ie.uid=Pe.uid,st=Ie}me(st,ge)})},pe=(ue,X,ke)=>{try{typeof ue=="string"&&(ue=JSON.parse(ue))}catch{}if(!zo(X,K))return;const ge=Zn(X);ge.status="done",ge.percent=100,ge.response=ue,ge.xhr=ke;const Pe=Qn(ge,K);me(ge,Pe)},we=(ue,X)=>{if(!zo(X,K))return;const ke=Zn(X);ke.status="uploading",ke.percent=ue.percent;const ge=Qn(ke,K);me(ke,ge,ue)},fe=(ue,X,ke)=>{if(!zo(ke,K))return;const ge=Zn(ke);ge.error=ue,ge.response=X,ge.status="error";const Pe=Qn(ge,K);me(ge,Pe)},he=ue=>{let X;Promise.resolve(typeof i=="function"?i(ue):i).then(ke=>{var ge;if(ke===!1)return;const Pe=Gi(ue,K);Pe&&(X=Object.assign(Object.assign({},ue),{status:"removed"}),K?.forEach(Fe=>{const st=X.uid!==void 0?"uid":"name";Fe[st]===X[st]&&!Object.isFrozen(Fe)&&(Fe.status="removed")}),(ge=z.current)===null||ge===void 0||ge.abort(X),me(X,Pe))})},oe=ue=>{se(ue.type),ue.type==="drop"&&w?.(ue)};d.useImperativeHandle(n,()=>({onBatchStart:de,onSuccess:pe,onProgress:we,onError:fe,fileList:K,upload:z.current,nativeElement:ie.current}));const{getPrefixCls:Te,direction:Me,upload:qe}=d.useContext(on),ce=Te("upload",T),Ne=Object.assign(Object.assign({onBatchStart:de,onError:fe,onProgress:we,onSuccess:pe},e),{customRequest:le,data:ae,multiple:U,action:re,accept:ee,supportServerRender:I,prefixCls:ce,disabled:ne,beforeUpload:Ce,onChange:void 0,hasControlInside:xe});delete Ne.className,delete Ne.style,(!j||ne)&&delete Ne.id;const vt=`${ce}-wrapper`,[xt,wt,It]=qi(ce,vt),[Bt]=us("Upload",ms.Upload),{showRemoveIcon:Pt,showPreviewIcon:pt,showDownloadIcon:_e,removeIcon:$e,previewIcon:Ge,downloadIcon:Ot,extra:Dt}=typeof m=="boolean"?{}:m,Lt=typeof Pt>"u"?!ne:Pt,$t=(ue,X)=>m?d.createElement(Qi,{prefixCls:ce,listType:u,items:K,previewFile:B,onPreview:g,onDownload:y,onRemove:he,showRemoveIcon:Lt,showPreviewIcon:pt,showDownloadIcon:_e,removeIcon:$e,previewIcon:Ge,downloadIcon:Ot,iconRender:E,extra:Dt,locale:Object.assign(Object.assign({},Bt),$),isImageUrl:C,progress:h,appendAction:ue,appendActionVisible:X,itemRender:R,disabled:ne}):ue,_t=Oe(vt,N,k,wt,It,qe?.className,{[`${ce}-rtl`]:Me==="rtl",[`${ce}-picture-card-wrapper`]:u==="picture-card",[`${ce}-picture-circle-wrapper`]:u==="picture-circle"}),rn=Object.assign(Object.assign({},qe?.style),M);if(x==="drag"){const ue=Oe(wt,ce,`${ce}-drag`,{[`${ce}-drag-uploading`]:K.some(X=>X.status==="uploading"),[`${ce}-drag-hover`]:te==="dragover",[`${ce}-disabled`]:ne,[`${ce}-rtl`]:Me==="rtl"});return xt(d.createElement("span",{className:_t,ref:ie},d.createElement("div",{className:ue,style:rn,onDrop:oe,onDragOver:oe,onDragLeave:oe},d.createElement(Xo,Object.assign({},Ne,{ref:z,className:`${ce}-btn`}),d.createElement("div",{className:`${ce}-drag-container`},j))),$t()))}const Jt=Oe(ce,`${ce}-select`,{[`${ce}-disabled`]:ne,[`${ce}-hidden`]:!j}),zt=d.createElement("div",{className:Jt,style:rn},d.createElement(Xo,Object.assign({},Ne,{ref:z})));return xt(u==="picture-card"||u==="picture-circle"?d.createElement("span",{className:_t,ref:ie},$t(zt,!!j)):d.createElement("span",{className:_t,ref:ie},zt,$t()))},pa=d.forwardRef(tl);var nl=function(e,n){var o={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(o[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,r=Object.getOwnPropertySymbols(e);c<r.length;c++)n.indexOf(r[c])<0&&Object.prototype.propertyIsEnumerable.call(e,r[c])&&(o[r[c]]=e[r[c]]);return o};const ol=d.forwardRef((e,n)=>{var{style:o,height:r,hasControlInside:c=!1}=e,i=nl(e,["style","height","hasControlInside"]);return d.createElement(pa,Object.assign({ref:n,hasControlInside:c},i,{type:"drag",style:Object.assign(Object.assign({},o),{height:r})}))}),Bn=pa;Bn.Dragger=ol;Bn.LIST_IGNORE=Mn;function Jo(){return Jo=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},Jo.apply(this,arguments)}const rl=(e,n)=>d.createElement(Mt,Jo({},e,{ref:n,icon:Fa})),al=d.forwardRef(rl);function Yo(){return Yo=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},Yo.apply(this,arguments)}const sl=(e,n)=>d.createElement(Mt,Yo({},e,{ref:n,icon:ui})),At=d.forwardRef(sl);function Zo(){return Zo=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},Zo.apply(this,arguments)}const il=(e,n)=>d.createElement(Mt,Zo({},e,{ref:n,icon:Ds})),Tr=d.forwardRef(il);function Qo(){return Qo=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},Qo.apply(this,arguments)}const ll=(e,n)=>d.createElement(Mt,Qo({},e,{ref:n,icon:xi})),cl=d.forwardRef(ll);function er(){return er=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},er.apply(this,arguments)}const dl=(e,n)=>d.createElement(Mt,er({},e,{ref:n,icon:wi})),ul=d.forwardRef(dl);function tr(){return tr=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},tr.apply(this,arguments)}const ml=(e,n)=>d.createElement(Mt,tr({},e,{ref:n,icon:Si})),pl=d.forwardRef(ml);function nr(){return nr=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},nr.apply(this,arguments)}const fl=(e,n)=>d.createElement(Mt,nr({},e,{ref:n,icon:Ni})),Vo=d.forwardRef(fl);function or(){return or=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},or.apply(this,arguments)}const hl=(e,n)=>d.createElement(Mt,or({},e,{ref:n,icon:_a})),gl=d.forwardRef(hl);function rr(){return rr=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},rr.apply(this,arguments)}const bl=(e,n)=>d.createElement(Mt,rr({},e,{ref:n,icon:$i})),yl=d.forwardRef(bl),fa="https://script.google.com/macros/s/AKfycbzWT7aSLTZl-qW2peDaHMcsW_aA55ttVfheZThFfYpj7sMm09Mg_6Gp2xjc7Z0XNHmwpw/exec",ha=e=>e&&typeof e=="object"&&!Array.isArray(e),vl=(e={})=>{const n=(i,m)=>e[i]!==void 0?e[i]:e[m],o=n("action","Action"),r=n("chassisNo","Chassis_No");return{movementId:n("movementId","MovementId"),chassisNo:r?String(r).toUpperCase():void 0,company:n("company","Company"),model:n("model","Model"),variant:n("variant","Variant"),color:n("color","Color"),action:o?String(o).toLowerCase():void 0,sourceBranch:n("sourceBranch","Source_Branch"),targetBranch:n("targetBranch","Target_Branch"),returnTo:n("returnTo","Return_To"),customerName:n("customerName","Customer_Name"),transferStatus:n("transferStatus","Transfer_Status"),notes:n("notes","Notes"),createdByName:n("createdByName","CreatedByName"),createdById:n("createdById","CreatedById"),resolvedByName:n("resolvedByName","ResolvedByName"),resolvedById:n("resolvedById","ResolvedById"),resolvedAt:n("resolvedAt","ResolvedAt"),deleted:n("deleted","Deleted"),timestamp:n("timestamp","Timestamp")}},yo=async e=>{try{const o=await Hr.get("/stocks/gas",{params:e,validateStatus:()=>!0});if(ha(o?.data))return o.data}catch{}const n=fa;try{return(await $a.get(n,{params:e,validateStatus:()=>!0}))?.data||{}}catch{return{}}},vo=async e=>{try{const o=await Hr.post("/stocks/gas",e||{},{validateStatus:()=>!0});if(ha(o?.data))return o.data}catch{}const n=fa;try{const o=await fetch(n,{method:"POST",mode:"cors",credentials:"omit",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(e||{})});try{return await o.json()}catch{return{}}}catch{return{}}},Rc=async({branch:e,mode:n,limit:o=1e3,page:r=1}={})=>{const c=await yo({action:"list",branch:e,mode:n,limit:o,page:r});return{success:!!c.ok,data:c.data||[],total:c.total||0,count:c.count||(c.data?c.data.length:0)}},Ec=async({branch:e,limit:n=5e3,page:o=1}={})=>{const r=await yo({action:"current",branch:e,limit:n,page:o});return{success:!!r.ok,data:r.data||[],total:r.total||0,count:r.count||(r.data?r.data.length:0)}},Fr=async({branch:e,limit:n=5e3,page:o=1}={})=>{const r=await yo({action:"current",branch:e,limit:n,page:o});return{success:!!r.ok,data:r.data||[],total:r.total||0,count:r.count||(r.data?r.data.length:0)}},Tc=async({branch:e,limit:n=5e3}={})=>{const o={action:"pending",limit:n};e&&(o.branch=e);const r=await yo(o);return{success:!!r.ok,data:r.data||[],message:r.message}},xl=async({data:e,createdBy:n})=>{const r=await vo({action:"create",data:e,createdBy:n});return{success:!!r.ok,data:r.data,message:r.message}},Fc=async(e,n)=>{const o=vl(n||{}),c=await vo({action:"update",movementId:e,data:o});return{success:!!c.ok,data:c.data,message:c.message}},Mc=async(e,n)=>{const o=await vo({action:"admit",movementId:e,notes:n});return{success:!!o.ok,data:o.data,message:o.message}},Ic=async(e,n)=>{const o=await vo({action:"reject",movementId:e,reason:n,notes:n});return{success:!!o.ok,data:o.data,message:o.message}},ga=d.forwardRef(function({active:n=!0,vals:o={}},r){const c=String(o?.branch||"").trim(),i=c,u=c.toLowerCase()==="byadarahalli",g=o?.customerName||o?.name||`${o?.firstName||""} ${o?.lastName||""}`.trim()||"-",y=o?.mobileNumber||o?.mobile||o?.phone||"-",b=o?.address||o?.addressLine||[o?.addressLine1,o?.addressLine2,o?.city,o?.pincode].filter(Boolean).join(", ")||"-",w=o?.vehicle||{},B=w?.company||o?.company||o?.make||"",S=w?.model||o?.bikeModel||o?.modelName||"",$=w?.variant||o?.variantName||o?.trim||"",E=w?.color||o?.vehicleColor||"",C=w?.availability||o?.availability||o?.chassisStatus||"",h=w?.chassisNo||o?.chassisNo||(C==="allot"?"To be allotted":"-"),T=o?.purchaseMode||o?.purchaseType||o?.paymentType||"-",N=String(T).toLowerCase(),x=o?.financierName||o?.financier||o?.hpFinancier||o?.nohpFinancier||o?.selectedFinancier||"",j=o?.rtoOffice||o?.rto||o?.rtoOfficeName||o?.rtoCode||"",M=ee=>{const I=Number(String(ee??"").replace(/[^\d.-]/g,""));return Number.isFinite(I)?I:0},R=(()=>{const ee=[],I=(k,L,ne,le)=>{const K=M(ne);K&&ee.push({part:k?`Part ${k}`:"",mode:String(L||"").toLowerCase()==="online"?"Online":"Cash",amount:K,reference:le||""})};return Array.isArray(o?.payments)&&o.payments.length?o.payments.forEach((k,L)=>I(k?.part||L+1,k?.mode||k?.paymentMode,k?.amount??k?.total??k?.value,k?.reference||k?.ref||k?.utr||k?.refNo)):Array.isArray(o?.paymentSplit)&&o.paymentSplit.length?o.paymentSplit.forEach(k=>{I(k?.part,"Cash",k?.cash),I(k?.part,"Online",k?.online,k?.reference||k?.ref||k?.utr)}):[1,2,3].forEach(k=>{const L=M(o?.[`bookingAmount${k}Cash`]),ne=M(o?.[`bookingAmount${k}Online`]),le=M(o?.[`bookingAmount${k}`]),K=String(o?.[`paymentMode${k}`]||"").toLowerCase(),Y=o?.[`paymentReference${k}`]||o?.[`paymentRef${k}`]||o?.[`utr${k}`]||o?.utr;!L&&!ne&&le?K==="online"?I(k,"Online",le,Y):I(k,"Cash",le):(L&&I(k,"Cash",L),ne&&I(k,"Online",ne,Y))}),ee})(),W=R.reduce((ee,I)=>ee+I.amount,0),ae=o?.executive||o?.salesExecutive||o?.salesperson||"-",U=o?.createdAt||o?.ts||new Date,xe=["hp","loan"].includes(N)?"HP (Loan)":["nohp","self","self-funded","selffunded"].includes(N)?"No Hypothecation":N==="cash"?"Cash":String(T).toUpperCase(),re=["loan","hp","nohp"].includes(N);return t.jsxs("div",{ref:r,className:`print-sheet ${n?"active":""}`,children:[t.jsx("style",{children:`
/* =========================
   PRINT BASELINE (A4)
   ========================= */
@page { size: A4 portrait; margin: 0; }
html, body {
  margin: 0 !important;
  padding: 0 !important;
  background: #fff !important;
  -webkit-print-color-adjust: exact !important; /* helps keep intended colors */
  print-color-adjust: exact !important;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, Helvetica, sans-serif;
}
img { max-width: 100%; height: auto; background: transparent; }

/* Hide inside main app screens; visible in dedicated print doc or when printing */
@media screen {
  body:not(.print-host) .print-sheet { display: none !important; }
}

/* Scope print to only the active sheet and avoid blank extra pages */
@media print {
  body * { visibility: hidden !important; }
  .print-sheet { display: block; }
  .print-sheet.active,
  .print-sheet.active * { visibility: visible !important; }
  .print-sheet:not(.active) { display: none !important; }
  .print-sheet.active { position: absolute; inset: 0; width: 100%; }

  /* Keep large blocks together on one page */
  .bk-a4, .wrap, .box, .hdr, .grid, .grid-3, .sign-row { break-inside: avoid; page-break-inside: avoid; }
}

/* =========================
   COMPONENT STYLES
   ========================= */
.bk-a4 { display: block; }
.wrap { padding: 7mm; color: #000; }
.box { border: 1px solid #111; border-radius: 1mm; padding: 3mm; }

.title { text-align: center; font-size: 16.5pt; font-weight: 800; margin: 1.5mm 0 2.5mm; letter-spacing: 0.4px; }
.hdr { display: grid; grid-template-columns: 26mm 1fr 26mm; align-items: center; gap: 3mm; }
.shop { text-align: center; }
.shop .en { font-size: 14.5pt; font-weight: 600; line-height: 1.08; }
.shop .sub { font-size: 9.5pt; margin-top: 1mm; }
.tiny { font-size: 9px; }
.label { font-weight: 600; }

/* Labelvalue INLINE layout (no stacking) */
.kv {
  display: grid;
  grid-template-columns: 38mm 1fr; /* label width | flexible value */
  align-items: center;
  column-gap: 2mm;
  padding: 1mm 0;
  border: none;
  border-bottom: 1px solid #e5e7eb; /* light divider */
}
.kv .name { color: #111; }
.kv .val { font-weight: 600; white-space: pre-line; }

.grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2mm; margin-top: 2mm; }
.grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 2mm; margin-top: 2mm; }
.full { grid-column: 1 / -1; }
.pay-table { width: 100%; border-collapse: collapse; margin-top: 2mm; font-size: 11pt; }
.pay-table th, .pay-table td { border: 1px solid #d1d5db; padding: 2mm 2.5mm; text-align: left; }
.pay-table th { background: #f3f4f6; }

.sign-row { display: grid; grid-template-columns: 1fr 1fr; gap: 6mm; margin-top: 6mm; }
.sign { border-top: 1px dashed #777; padding-top: 2mm; text-align: center; }

.note { margin-top: 3mm; font-size: 10.5pt; }
.note-title { font-weight: 700; margin-bottom: 2mm; }
.note ol { margin: 0; padding-left: 4mm; }
      `}),t.jsx("div",{className:"bk-a4",children:t.jsx("div",{className:"wrap",children:t.jsxs("div",{className:"box",children:[t.jsxs("div",{className:"hdr",children:[t.jsx("img",{src:u?"/honda-logo.png":"/shantha-logoprint.jpg",alt:u?"NH Motors":"Shantha Motors",style:{width:"100%",maxHeight:92}}),t.jsx("div",{className:"shop",children:u?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"en",children:"NH MOTORS |   "}),t.jsxs("div",{className:"sub",style:{marginTop:4},children:["Site No. 116/1, Bydarahalli, Magadi Main Road, Opp.",t.jsx("br",{}),"HP Petrol Bunk, Bangalore - 560091"]}),t.jsx("div",{className:"sub",children:"Mob: 9731366921 / 8073283502 / 9741609799"})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"en",children:"SHANTHA MOTORS |  "}),t.jsx("div",{className:"sub",children:"Multi Brand Two Wheeler Sales & Service"}),t.jsx("div",{className:"sub",children:"Mob No : 9731366921 / 8073283502"}),t.jsx("div",{className:"tiny",children:"Kadabagere  Muddinapalya   Andrahalli  Tavarekere  Hegganahalli  Channenahalli  Nelagadrahalli"})]})}),t.jsxs("div",{children:[t.jsx("img",{src:"/location-qr.png",alt:"Location QR",style:{width:"100%",maxHeight:92}}),t.jsx("div",{style:{fontSize:12.5,fontWeight:600,marginTop:4},children:"Scan for Location"})]})]}),t.jsx("div",{className:"title",children:"Vehicle Booking Form"}),t.jsxs("div",{className:"grid-3",children:[t.jsxs("div",{className:"kv",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Date:"})}),t.jsx("div",{className:"val",children:Ba(U)})]}),t.jsxs("div",{className:"kv",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Branch:"})}),t.jsx("div",{className:"val",children:i||"-"})]}),t.jsxs("div",{className:"kv",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Executive:"})}),t.jsx("div",{className:"val",children:ae})]})]}),t.jsxs("div",{className:"grid",children:[t.jsxs("div",{className:"kv full",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Customer Name:"})}),t.jsx("div",{className:"val",children:g})]}),t.jsxs("div",{className:"kv",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Mobile:"})}),t.jsx("div",{className:"val",children:y})]}),t.jsxs("div",{className:"kv",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"RTO Office:"})}),t.jsx("div",{className:"val",children:j||"-"})]}),t.jsxs("div",{className:"kv full",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Address:"})}),t.jsx("div",{className:"val",children:b})]})]}),t.jsxs("div",{className:"grid",children:[t.jsxs("div",{className:"kv",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Company:"})}),t.jsx("div",{className:"val",children:B||"-"})]}),t.jsxs("div",{className:"kv",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Model:"})}),t.jsx("div",{className:"val",children:S||"-"})]}),t.jsxs("div",{className:"kv",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Variant:"})}),t.jsx("div",{className:"val",children:$||"-"})]}),t.jsxs("div",{className:"kv",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Color:"})}),t.jsx("div",{className:"val",children:E||"-"})]}),t.jsxs("div",{className:"kv full",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Chassis No:"})}),t.jsx("div",{className:"val",children:h})]})]}),t.jsxs("div",{className:"grid",children:[t.jsxs("div",{className:"kv",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Purchase Mode:"})}),t.jsx("div",{className:"val",children:xe})]}),re&&t.jsxs("div",{className:"kv",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Financier:"})}),t.jsx("div",{className:"val",children:x||"-"})]})]}),t.jsx("div",{className:"grid",children:t.jsxs("div",{className:"kv",children:[t.jsx("div",{className:"name",children:t.jsx("span",{className:"label",children:"Booking Amount Paid:"})}),t.jsx("div",{className:"val",children:W?xr(W):"-"})]})}),t.jsxs("table",{className:"pay-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{style:{width:"28%"},children:"Payment Part"}),t.jsx("th",{style:{width:"22%"},children:"Mode"}),t.jsx("th",{style:{width:"25%"},children:"Amount"}),t.jsx("th",{children:"UTR / Ref"})]})}),t.jsx("tbody",{children:R.length?R.map((ee,I)=>t.jsxs("tr",{children:[t.jsx("td",{children:ee.part||`Part ${I+1}`}),t.jsx("td",{children:ee.mode}),t.jsx("td",{children:xr(ee.amount)}),t.jsx("td",{children:ee.reference||"-"})]},`${ee.part||"p"}-${I}`)):t.jsx("tr",{children:t.jsx("td",{colSpan:4,style:{textAlign:"center"},children:"No payment recorded"})})})]}),t.jsxs("div",{className:"note",children:[t.jsx("div",{className:"note-title",children:"Notes / Terms"}),t.jsxs("ol",{children:[t.jsx("li",{children:"This slip acknowledges booking toward the above vehicle."}),t.jsx("li",{children:"Prices, delivery timelines and availability are subject to change by manufacturer/RTO."}),t.jsx("li",{children:"This is not a tax invoice."})]})]}),t.jsxs("div",{className:"sign-row",children:[t.jsx("div",{className:"sign tiny",children:"Customer Signature"}),t.jsxs("div",{className:"sign tiny",children:[u?"For NH Motors":"For Shantha Motors","  Authorised Signatory"]})]})]})})})]})}),Mr=e=>String(e||"").replace(/\D/g,"").slice(-10),mt=e=>{if(e==null||e==="")return 0;const n=String(e).replace(/[,\s]/g,""),o=Number(n);return Number.isFinite(o)?o:0},wl=e=>{if(!e||typeof e!="string")return{};try{const n=JSON.parse(e);return n&&typeof n=="object"?n:{}}catch{return{}}},ve=(e={},n=[])=>{for(const o of n){const r=e?.[o];if(r!=null&&!(typeof r=="string"&&r.trim()===""))return r}},Uo=e=>{const n=String(e||"").toLowerCase().trim();return n==="cash"||n==="online"?n:n==="upi"||n==="card"||n==="netbanking"||n==="bank"?"online":""},Sl=(e=[],n={})=>{const o=[{cash:0,online:0,ref:void 0},{cash:0,online:0,ref:void 0},{cash:0,online:0,ref:void 0}],r=(c,i=0)=>{if(!c)return;const m=mt(c.amount);if(!m)return;const u=Uo(c.mode)||"cash",g=Number(c.part)&&Number(c.part)>=1&&Number(c.part)<=3?Number(c.part)-1:Math.min(Math.max(i,0),2);u==="online"?(o[g].online+=m,o[g].ref||(o[g].ref=c.reference||c.utr||c.ref||c.txnId||"")):o[g].cash+=m};e.forEach((c,i)=>r(c,i));for(let c=0;c<3;c++){const i=`bookingAmount${c+1}Cash`,m=`bookingAmount${c+1}Online`;o[c].cash=o[c].cash||mt(ve(n,[i])),o[c].online=o[c].online||mt(ve(n,[m])),o[c].ref||(o[c].ref=ve(n,[`paymentReference${c+1}`,`paymentRef${c+1}`,`utr${c+1}`])||void 0);const u=mt(ve(n,[`bookingAmount${c+1}`])),g=Uo(ve(n,[`paymentMode${c+1}`]));!o[c].cash&&!o[c].online&&u&&(g==="online"?o[c].online=u:o[c].cash=u)}if(!o[0].cash&&!o[0].online){const c=mt(ve(n,["bookingAmount","Booking Amount","Booking_Amount"])),i=Uo(ve(n,["paymentMode","Payment Mode","Purchase Mode","purchaseMode"]));c>0&&(i==="online"?o[0].online=c:o[0].cash=c)}return o},jl=e=>Array.isArray(e)?e:e?String(e).split(",").map(n=>n.trim()).filter(Boolean):[],ba=(e={})=>{const n=e&&typeof e=="object"?e:{},o=wl(ve(n,["rawPayload","Raw Payload"])),r={...o,...n},c=o.vehicle&&typeof o.vehicle=="object"?o.vehicle:{},i=n.vehicle&&typeof n.vehicle=="object"?n.vehicle:{},m={...c,...i},u=String(ve(r,["purchaseMode","purchaseType","Purchase Mode"])||"cash").toLowerCase(),g=jl(ve(r,["addressProofTypes","Address Proof Types"])),y=Array.isArray(r.payments)?r.payments:[],b=Sl(y,r),w=ve(r,["financier","Financier"])||void 0,B=ve(r,["nohpFinancier"])||w||void 0;return{patch:{executive:ve(r,["executive","Executive"])||void 0,branch:ve(r,["branch","Branch"])||void 0,customerName:ve(r,["customerName","name","Customer Name"])||"",mobileNumber:Mr(ve(r,["mobileNumber","mobile","Mobile Number"])||""),address:ve(r,["address","Address"])||"",company:ve(r,["company","Company","Company Name","brand"])||m.company||"",bikeModel:ve(r,["bikeModel","model","Model"])||m.model||"",variant:ve(r,["variant","Variant"])||m.variant||"",color:ve(r,["color","colour","Color","Colour"])||m.color||void 0,chassisNo:String(m.availability||"").toLowerCase()==="allot"?"__ALLOT__":ve(r,["chassisNo","Chassis Number"])||m.chassisNo||void 0,rtoOffice:ve(r,["rtoOffice","RTO Office"])||"KA",purchaseType:u,financier:u==="loan"?w:void 0,nohpFinancier:u==="nohp"?B:void 0,disbursementAmount:(u==="loan"||u==="nohp")&&mt(ve(r,["disbursementAmount","Disbursement Amount"])||ve(r,["loanDisbursementAmount"]))||void 0,emiAmount:(u==="loan"||u==="nohp")&&mt(ve(r,["emiAmount","EMI Amount"]))||void 0,tenure:(u==="loan"||u==="nohp")&&mt(ve(r,["tenure","tenureMonths","Tenure","Tenure Months"]))||void 0,addressProofMode:ve(r,["addressProofMode","addressProof","Address Proof Mode"])||"aadhaar",addressProofTypes:g,bookingAmount1Cash:b[0].cash||void 0,bookingAmount1Online:b[0].online||void 0,paymentReference1:b[0].ref||void 0,bookingAmount2Cash:b[1].cash||void 0,bookingAmount2Online:b[1].online||void 0,paymentReference2:b[1].ref||void 0,bookingAmount3Cash:b[2].cash||void 0,bookingAmount3Online:b[2].online||void 0,paymentReference3:b[2].ref||void 0,downPayment:mt(ve(r,["downPayment"])??ve(r,["dp"])?.downPayment),extraFittingAmount:mt(ve(r,["extraFittingAmount"])??ve(r,["dp"])?.extraFittingAmount),affidavitCharges:mt(ve(r,["affidavitCharges"])??ve(r,["dp"])?.affidavitCharges),discountAmount:mt(ve(r,["discountAmount"])??ve(r,["dp"])?.discountAmount)},metadata:{bookingId:ve(r,["bookingId","Booking ID","serialNo"])||void 0,mobile:Mr(ve(r,["mobileNumber","mobile","Mobile Number"])||""),vehicle:m}}};function Cl({form:e,webhookUrl:n,setSelectedCompany:o,setSelectedModel:r,onApplied:c,autoSearch:i}){const[m,u]=d.useState(!1),[g,y]=d.useState("mobile"),[b,w]=d.useState(""),[B,S]=d.useState(!1),[$,E]=d.useState([]),[C,h]=d.useState(""),T=d.useRef(null),N=I=>String(I||"").replace(/\D/g,"").slice(-10),x=I=>String(I||"").toUpperCase().replace(/\s+/g,""),j=I=>String(I||"").toUpperCase().replace(/[^A-Z0-9]/g,""),M=/^[A-Z]{2}\d{2}[A-Z]{2}\d{4}$/,R=I=>{const k=j(I);return k.length>10||!/^[A-Z0-9]*$/.test(k)?!1:[/^[A-Z]{0,2}$/,/^[A-Z]{2}\d{0,2}$/,/^[A-Z]{2}\d{2}[A-Z]{0,2}$/,/^[A-Z]{2}\d{2}[A-Z]{2}\d{0,4}$/].some(ne=>ne.test(k))},W=I=>{const k=I,L=k==="mobile"&&N(b)||String(b||"").trim(),ne=L?`The ${k==="mobile"?"mobile number":k==="vehicle"?"vehicle number":"booking ID"} "${L}" is not in our records.`:"No matching booking found in our records.";h(ne),xn.warning({centered:!0,title:"No booking found",content:ne,okText:"Got it"})},ae=async(I,k)=>{if(!n)throw new Error("Booking webhook URL not configured");const L=k,ne=String(I??b??"").trim(),le={action:"search",mode:L,query:ne},K=await nn({webhookUrl:n,method:"GET",payload:le});let Y=Array.isArray((K?.data||K)?.rows)?(K?.data||K).rows:[];if(!Y.length&&L==="vehicle"){const te=await nn({webhookUrl:n,method:"GET",payload:{...le,mode:"reg"}}).catch(()=>null);Y=Array.isArray((te?.data||te)?.rows)?(te?.data||te).rows:[]}if(!Y.length&&L==="vehicle")try{const te=await nn({webhookUrl:n,method:"GET",payload:{action:"list"}}),se=te?.data||te,z=Array.isArray(se?.rows)?se.rows:Array.isArray(se?.data)?se.data:[],ie=j(ne);Y=z.filter(Ce=>{const de=Ce?.values||{},pe=Ce?.payload||Ce||{},we=j(de["Vehicle No"]||de.Vehicle_No||de.RegNo||de["Reg No"]||de["Registration Number"]||de["Vehicle Number"]||""),fe=j(pe.vehicle?.regNo||pe.vehicle?.registrationNumber||pe.vehicleNo||pe.regNo||pe.registrationNumber||""),he=j(typeof pe.rawPayload=="string"?pe.rawPayload:"");return ie&&we===ie||ie&&fe===ie||ie&&he.includes(ie)})}catch{}return Y},U=I=>{const k=I&&I.payload?I.payload:I;return k&&typeof k=="object"?k:{}},xe=I=>{try{const k=U(I),{patch:L,metadata:ne}=ba(k);e.setFieldsValue(L),L.company&&o?.(L.company),L.bikeModel&&r?.(L.bikeModel),je.success("Booking details filled."),u(!1),E([]),w("");try{c?.(ne)}catch{}window.dispatchEvent(new CustomEvent("bookingPrefillComplete"))}catch(k){console.warn("applyToForm error:",k),je.error("Could not apply booking details."),window.dispatchEvent(new CustomEvent("bookingPrefillComplete"))}},re=async({modeOverride:I,queryOverride:k,silent:L,autoSearch:ne=!1}={})=>{const le=String(k??b??"").trim(),K=I||g||"mobile",Y=()=>{ne&&typeof window<"u"&&window.dispatchEvent(new CustomEvent("bookingPrefillComplete"))};if(!le){L||je.warning(K==="mobile"?"Enter 10-digit Mobile":K==="vehicle"?"Enter vehicle no. (KA03AB1234)":"Enter Booking ID"),Y();return}let te=le;if(K==="mobile"){const se=N(le);if(se.length!==10){L||je.error("Enter a valid 10-digit mobile number."),Y();return}te=se,w(se)}else if(K==="vehicle"){const se=j(le);if(!M.test(se)){L||je.error("Enter vehicle as KA03AB1234."),Y();return}te=se,w(se)}else te=x(le),w(te);y(K),h(""),S(!0);try{const z=(await ae(te,K)).map(ie=>({payload:U(ie)}));if(!z.length){L||W(K),E([]);return}if(z.length===1){xe(z[0].payload);return}E(z.slice(0,10)),L||je.info(`Found ${z.length} matches. Pick one.`)}catch(se){console.warn("Booking search error:",se),L||je.error("Could not fetch bookings. Check webhook.")}finally{S(!1),ne&&typeof window<"u"&&window.dispatchEvent(new CustomEvent("bookingPrefillComplete"))}};d.useEffect(()=>{const I=String(i?.query||"").trim();if(!I)return;const k=i?.mode||"mobile",L=`${k}:${I}`;T.current!==L&&(T.current=L,re({modeOverride:k,queryOverride:I,silent:!0,autoSearch:!0}))},[i?.mode,i?.query]);const ee=I=>{const k=U(I.payload),L=k.vehicle||{},ne=[L.company,L.model,L.variant].filter(Boolean).join(" "),le=N(k.mobileNumber||k.mobile||""),K=k.branch||"-",Y=k.ts?He(k.ts).format("DD-MM-YYYY HH:mm"):"-";return t.jsx(wr.Item,{actions:[t.jsx(Ee,{type:"link",onClick:()=>xe(I.payload),children:"Use"})],children:t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",width:"100%"},children:[t.jsxs("div",{children:[t.jsx("b",{children:"Name:"})," ",k.customerName||k.name||"-"," ",t.jsx("b",{children:"Mobile:"})," ",le||"-"]}),t.jsxs("div",{children:[t.jsx("b",{children:"Vehicle:"})," ",ne||"-"," ",t.jsx("b",{children:"Branch:"})," ",K]}),t.jsxs("div",{style:{gridColumn:"1 / span 2",color:"#999"},children:[t.jsx("b",{children:"Mode:"})," ",String(k.purchaseMode||k.purchaseType||"cash").toUpperCase()," "," ",t.jsx("b",{children:"Date:"})," ",Y]})]})})};return t.jsxs(t.Fragment,{children:[t.jsx(Ee,{onClick:()=>{h(""),u(!0)},style:{background:"#2ECC71",borderColor:"#2ECC71",color:"#fff"},children:"Fetch Details"}),t.jsx(xn,{title:"Fetch Booking",open:m,onCancel:()=>{u(!1),E([]),h("")},footer:[t.jsx(Ee,{onClick:()=>{u(!1),E([]),h("")},children:"Close"},"close"),t.jsx(Ee,{type:"primary",loading:B,onClick:()=>re(),children:"Search"},"search")],children:t.jsxs(Gt,{direction:"vertical",style:{width:"100%"},children:[t.jsxs(bt.Group,{value:g,onChange:I=>{y(I.target.value),w("")},children:[t.jsx(bt.Button,{value:"mobile",children:"By Mobile"}),t.jsx(bt.Button,{value:"booking",children:"By Booking ID"}),t.jsx(bt.Button,{value:"vehicle",children:"By Vehicle"})]}),t.jsx(yt,{placeholder:g==="mobile"?"Enter 10-digit Mobile":g==="vehicle"?"Enter Vehicle No (KA03AB1234)":"Enter Booking ID",value:b,inputMode:g==="mobile"?"numeric":"text",onChange:I=>{const k=I.target.value||"";if(g==="mobile"){const L=k.replace(/\D/g,"").slice(0,10);w(L)}else if(g==="vehicle"){const L=k.toUpperCase().replace(/[^A-Z0-9]/g,"");if(!R(L))return;w(L)}else w(x(k))},onPressEnter:()=>re(),allowClear:!0}),C&&t.jsx(Ma,{type:"warning",showIcon:!0,message:C}),B&&t.jsx(po,{}),$.length>1&&t.jsx(wr,{size:"small",bordered:!0,dataSource:$,renderItem:ee})]})})]})}function Al({open:e,onClose:n,row:o,webhookUrl:r,secret:c}){const[i,m]=d.useState(!1),[u,g]=d.useState(!1),[y,b]=d.useState(null),w=d.useRef(null),B=d.useRef(!1),S=(N,x)=>String((x||[]).map(j=>N?.[j]??"").find(j=>j!=="")||"").trim(),$=N=>String(N||"").replace(/\D/g,"").slice(-10),E=N=>{if(!N)return null;if(typeof N=="object")return N;if(typeof N=="string")try{const x=JSON.parse(N);return x&&typeof x=="object"?x:null}catch{return null}return null},C=N=>{if(!N||typeof N!="object")return null;const x=N.values||N,j=E(N.payload)||E(N.Payload)||E(N.PAYLOAD)||E(x.payload)||E(x.Payload)||E(x.PAYLOAD)||{},M=E(N.rawPayload)||E(N["Raw Payload"])||E(x["Raw Payload"])||E(x.rawPayload)||E(j.rawPayload)||{},R={...M,...j},W={...M?.vehicle||{},...j?.vehicle||{}},ae=R.customerName||R.name||S(x,["Customer Name","Customer_Name","Customer","Name"])||N.name||"",U=$(R.mobileNumber||R.mobile||S(x,["Mobile Number","Mobile","Phone"])||N.mobile||""),xe=R.address||S(x,["Address","Address Line","AddressLine"])||"",re=R.branch||S(x,["Branch","Branch Name"])||N.branch||"",ee=R.executive||S(x,["Executive","Sales Executive"])||N.executive||"",I=R.rtoOffice||S(x,["RTO Office","RTO","RTO Code"])||"",k=R.purchaseMode||R.purchaseType||S(x,["Purchase Mode","Purchase Type","Payment Type","Mode"])||"",L=R.financier||S(x,["Financier","Financier Name","HP Financier","NOHP Financier"])||"",ne=R.addressProofMode||S(x,["Address Proof","Address Proof Mode"])||"",le=W.company||R.company||S(x,["Company","company"])||"",K=W.model||R.model||S(x,["Model","model"])||"",Y=W.variant||R.variant||S(x,["Variant","variant"])||"",te=W.color||R.color||S(x,["Color","Colour","Vehicle Color","Vehicle Colour"])||"",se=W.chassisNo||R.chassisNo||S(x,["Chassis No","Chassis Number","Chassis"])||"";let z=R.addressProofTypes||x?.["Address Proof Types"]||x?.["Proof Types"]||"";typeof z=="string"&&(z=z.split(",").map(Ce=>Ce.trim()).filter(Boolean));const ie=R.createdAt||R.savedAt||R.ts||S(x,["Submitted At","Timestamp","Created At","Date"])||new Date,me={bookingAmount1Cash:S(x,["Booking Amount 1 Cash","bookingAmount1Cash"]),bookingAmount1Online:S(x,["Booking Amount 1 Online","bookingAmount1Online"]),bookingAmount2Cash:S(x,["Booking Amount 2 Cash","bookingAmount2Cash"]),bookingAmount2Online:S(x,["Booking Amount 2 Online","bookingAmount2Online"]),bookingAmount3Cash:S(x,["Booking Amount 3 Cash","bookingAmount3Cash"]),bookingAmount3Online:S(x,["Booking Amount 3 Online","bookingAmount3Online"]),paymentReference1:S(x,["Payment Reference 1","paymentReference1","UTR 1","Ref 1"]),paymentReference2:S(x,["Payment Reference 2","paymentReference2","UTR 2","Ref 2"]),paymentReference3:S(x,["Payment Reference 3","paymentReference3","UTR 3","Ref 3"]),bookingAmount:S(x,["Booking Amount","bookingAmount"])};return{...R,customerName:ae,mobileNumber:U,address:xe,branch:re,executive:ee,rtoOffice:I,purchaseMode:k,financier:L,addressProofMode:ne,addressProofTypes:Array.isArray(z)?z:[],createdAt:ie,vehicle:{company:le,model:K,variant:Y,color:te,chassisNo:se,availability:se?"found":W.availability||R.availability||"allot"},bookingAmount1Cash:R.bookingAmount1Cash??me.bookingAmount1Cash,bookingAmount1Online:R.bookingAmount1Online??me.bookingAmount1Online,bookingAmount2Cash:R.bookingAmount2Cash??me.bookingAmount2Cash,bookingAmount2Online:R.bookingAmount2Online??me.bookingAmount2Online,bookingAmount3Cash:R.bookingAmount3Cash??me.bookingAmount3Cash,bookingAmount3Online:R.bookingAmount3Online??me.bookingAmount3Online,paymentReference1:R.paymentReference1??me.paymentReference1,paymentReference2:R.paymentReference2??me.paymentReference2,paymentReference3:R.paymentReference3??me.paymentReference3,bookingAmount:R.bookingAmount??me.bookingAmount}};d.useEffect(()=>{let N=!0;if(e)try{document.body.classList.add("print-host")}catch{}const x=()=>{try{document.body.classList.remove("print-host")}catch{}};return(async()=>{if(!(!e||!o)){m(!0);try{if(r&&o.bookingId){const M={action:"search",mode:"booking",query:o.bookingId};c&&(M.secret=c);const R=await nn({webhookUrl:r,method:"GET",payload:M}),W=R?.data||R,ae=(Array.isArray(W?.rows)&&W.rows.length?W.rows[0]:null)||(Array.isArray(W?.data)&&W.data.length?W.data[0]:null),U=ae?C(ae):null;if(N&&U)b(U);else{const xe=await nn({webhookUrl:r,method:"GET",payload:c?{action:"list",secret:c}:{action:"list"}}),re=xe?.data||xe,I=(Array.isArray(re?.data)?re.data:Array.isArray(re?.rows)?re.rows:[]).find(L=>String(L["Booking ID"]||"").trim()===String(o.bookingId).trim()),k=I?C(I):null;N&&k&&b(k),N&&!k&&je.error("Booking not found in Sheet by Booking ID")}}else N&&(je.error("Missing Booking ID or webhook URL for print"),b(null))}catch{N&&(je.error("Failed to fetch booking from Sheet"),b(null))}finally{N&&m(!1)}}})(),()=>{N=!1,x()}},[e,o,r]);const h=async()=>{g(!0);try{await new Promise(N=>setTimeout(N,0)),await sr(w.current)}catch{}finally{g(!1)}};d.useEffect(()=>{if(!e){B.current=!1;return}!i&&y&&!u&&!B.current&&(B.current=!0,h())},[e,i,y,u]);const T=t.jsx("div",{style:{display:e?"block":"none"},children:t.jsx(ga,{ref:w,active:!0,vals:y||{}})});return t.jsxs(xn,{open:e,title:"Print Booking",onCancel:n,footer:null,width:980,destroyOnClose:!0,children:[i?t.jsx("div",{style:{display:"grid",placeItems:"center",height:120},children:t.jsx(po,{})}):t.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[t.jsx(Ee,{onClick:n,disabled:u,children:"Close"}),t.jsx(Ee,{type:"primary",onClick:h,disabled:!y||u,loading:u,children:"Print"})]}),T]})}const ar="FollowUps:BookingFormPrefill",ya=()=>typeof window<"u"&&typeof window.sessionStorage<"u",Nl=e=>{if(!e||typeof e!="object")return e;const{rawPayload:n,files:o,documents:r,attachments:c,file:i,...m}=e,u={...m};return e.vehicle&&typeof e.vehicle=="object"&&(u.vehicle={...e.vehicle}),Array.isArray(e.payments)&&(u.payments=e.payments.map(g=>({amount:g?.amount,mode:g?.mode,reference:g?.reference||g?.utr||g?.ref||void 0,part:g?.part}))),u},kl=e=>{if(!e||typeof e!="object")return{};const n=o=>o.map(r=>e?.[r]).find(r=>r!=null);return{bookingAmount:n(["Booking Amount","Booking_Amount","bookingAmount"]),collectedAmount:n(["Collected Amount","Collected_Amount","CollectedAmount","Amount"])}},Pl=e=>{if(ya())try{const n=Nl(e?.payload),o=kl(e?.values),r={payload:n,values:o,metadata:{bookingId:e?.bookingId,mobile:e?.mobile,serialNo:e?.serialNo}};window.sessionStorage.setItem(ar,JSON.stringify(r))}catch{}},Ol=()=>{if(!ya())return null;try{const e=window.sessionStorage.getItem(ar);return e?(window.sessionStorage.removeItem(ar),JSON.parse(e)):null}catch{return null}},eo={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};class $l extends at.Component{constructor(n){super(n),this.state={hasError:!1,error:null}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,o){typeof window<"u"&&window.console&&console.error("FollowUps crashed",n,o)}render(){return this.state.hasError?t.jsxs("div",{style:{padding:16},children:[t.jsx("h3",{children:"Something went wrong in Follow-Ups."}),t.jsxs(Gt,{children:[t.jsx(Ee,{size:"small",type:"primary",onClick:()=>this.setState({hasError:!1,error:null}),children:"Try Again"}),t.jsx(Ee,{size:"small",onClick:()=>window.location.reload(),children:"Reload"})]}),this.state.error&&t.jsx("pre",{style:{marginTop:12,whiteSpace:"pre-wrap",color:"#a00"},children:String(this.state.error)})]}):this.props.children}}const to={pending:"orange",cancelled:"red",completed:"green",converted:"green",booked:"green",not_interested:"default",unreachable:"volcano",wrong_number:"magenta",purchased_elsewhere:"geekblue",no_response:"gold",seen:"blue",approved:"green",allotted:"purple"},no={pending:"Pending",cancelled:"Cancelled",completed:"Completed",converted:"Booked",booked:"Booked",not_interested:"Not Interested",unreachable:"Unreachable",wrong_number:"Wrong Number",purchased_elsewhere:"Purchased Elsewhere",no_response:"No Response",seen:"Seen",approved:"Approved",allotted:"Allotted"},{Title:Rl,Text:Ir}=ra,oo={height:32,padding:"0 14px",borderRadius:999,fontSize:12,fontWeight:600},El={borderRadius:18,border:"1px solid #eef2f7",boxShadow:"0 10px 34px rgba(15, 23, 42, 0.08)",background:"linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.92))"},Tl={borderRadius:16,border:"1px solid #eef2f7",background:"rgba(255,255,255,0.9)",boxShadow:"0 10px 26px rgba(15, 23, 42, 0.06)"},ro={borderRadius:16,border:"1px solid #eef2f7",background:"rgba(255,255,255,0.92)",boxShadow:"0 8px 22px rgba(15, 23, 42, 0.05)"},Br={fontSize:22,fontWeight:800,lineHeight:1},Dr={fontSize:11,color:"#64748b",marginTop:6},Lr=typeof Intl<"u"?new Intl.NumberFormat("en-IN",{minimumFractionDigits:0,maximumFractionDigits:2}):null,mo=e=>{if(e==null||Number.isNaN(Number(e)))return"";const n=Number(e),o=Lr?Lr.format(Math.abs(n)):String(Math.abs(n));return`${n<0?"-":""}${o}`},Fl=9,Ml=11,Il=8e3,Bl=(e,n)=>{const o=Number(e||0),r=Number(n||0);return(o>0?r/o:0)>=.3?Fl:Ml},Dl=(e,n,o)=>{const c=Math.max(Number(e||0)-Number(n||0),0)+Il,i=o/12,m=Bl(e,n),u=c*(m/100)*i,g=c+u;return o>0?g/o:0},Ll=e=>String(e)==="12"?[12,18,24,36]:[24,30,36,48],_l=(e,n,o)=>{const r=Ll(o);if(!Number(e||0))return"";const c=r.map(i=>`${i}:${mo(Dl(e,n,i))}`);return c.length?`EMI(${o}): ${c.join(" | ")}`:""},_r=(e=[])=>Array.from(new Set((Array.isArray(e)?e:[]).map(n=>String(n||"").trim()).filter(Boolean))),zr=e=>String(e||"").toLowerCase().replace(/[^a-z0-9]/g,""),vn=(e,n=[])=>{if(!e||typeof e!="object")return"";for(const c of n){const i=e[c];if(i!=null&&String(i).trim()!=="")return i}const o=n.map(zr).filter(Boolean);if(!o.length)return"";const r=Object.entries(e);for(const[c,i]of r)if(!(i==null||String(i).trim()==="")&&o.includes(zr(c)))return i;return""},zl=e=>String(e||"").trim().toLowerCase(),Vl=e=>["loan","nohp","hp","finance"].includes(zl(e)),Vr=e=>{if(!e)return{remarks:"",vehicles:[]};const n=e.payload||{},o=n.formValues||{},r=_r(n.fittings),c=o.mode??n.mode??n.purchaseMode??n.purchaseType??n.paymentType??e.mode??e.purchaseMode??e.purchaseType??e.paymentType??e.values?.mode??e.values?.Mode??e.values?.purchaseMode??e.values?.purchaseType??e.values?.paymentType??"cash",i=String(e.remarks||o.remarks||n.remarks||"").trim(),m=[],u=({label:y,company:b,model:w,variant:B,priceRaw:S,dpRaw:$,emiSetRaw:E,fittingsRaw:C,modeRaw:h})=>{const T=String(b||"").trim(),N=String(w||"").trim(),x=String(B||"").trim(),j=Number(S||0),M=Number($||0),R=_r(C||r),W=[T,N,x].filter(Boolean).join(" "),ae=!!(W||R.length||j||M),U=Vl(h??c);ae&&m.push({label:y,title:W||"Vehicle details not available",fittings:R,priceText:j?mo(j):"",dpText:M?mo(M):"",emiText:U&&j?_l(j,M,E||n.emiSet||"12"):"",showFinance:U})};return u({label:"Vehicle 1",company:o.company??n.company??e.company??vn(e.values,["Company","company","Company Name","Brand"]),model:o.bikeModel??o.model??n.model??e.model??vn(e.values,["Model","model","Bike Model","bikeModel"]),variant:o.variant??n.variant??e.variant??vn(e.values,["Variant","variant"]),priceRaw:o.onRoadPrice??n.onRoadPrice??e.price,dpRaw:o.downPayment??n.downPayment,emiSetRaw:n.emiSet,fittingsRaw:n.fittings,modeRaw:o.mode??n.mode??n.purchaseMode??n.purchaseType??n.paymentType}),(Array.isArray(n.extraVehicles)?n.extraVehicles:[]).forEach((y,b)=>{u({label:`Vehicle ${b+2}`,company:y.company,model:y.model,variant:y.variant,priceRaw:y.onRoadPrice,dpRaw:y.downPayment,emiSetRaw:y.emiSet||n.emiSet,fittingsRaw:y.fittings,modeRaw:y.mode??y.purchaseMode??y.purchaseType??y.paymentType})}),{remarks:i,vehicles:m}};function Ul({mode:e="quotation",webhookUrl:n,onClose:o}){const r=Ra(),i=!ir.useBreakpoint().md,[m,u]=d.useState(!1),[g,y]=d.useState(null),[b,w]=d.useState([]),[B,S]=d.useState(!1),[$,E]=d.useState("all"),[C]=d.useState(!1),[h,T]=d.useState("all"),N=1e4,[x,j]=d.useState("all"),[M,R]=d.useState({name:"",branch:""}),[W,ae]=d.useState(""),[U,xe]=d.useState([]),[re,ee]=d.useState({open:!1,serial:null,at:null,notes:""}),[I,k]=d.useState({open:!1,serial:null,status:"converted",details:"",boughtFrom:"",offer:""}),[L,ne]=d.useState({open:!1,row:null}),le=at.useRef(null),[K,Y]=d.useState(!1),[te,se]=d.useState(null),[z,ie]=d.useState(null),[me,Ce]=d.useState(""),[de,pe]=d.useState(null),[we,fe]=d.useState(1),[he,oe]=d.useState(50),[Te,Me]=d.useState(!1),qe=String(W||"").toLowerCase(),ce=["owner","admin","backend"].includes(qe),Ne=String(M.branch||U[0]||"").trim(),vt=ce?h&&h!=="all"?h:"":Ne,xt=ce?h||"all":Ne||"all",wt=ce?vt:Ne,It=!ce||!!vt,Bt=at.useMemo(()=>{const a=new Set,l=[],p=f=>{const A=String(f||"").trim();!A||a.has(A)||(a.add(A),l.push(A))};return U.forEach(p),p(Ne),[{value:"all",label:"All Branches"},...l.map(f=>({value:f,label:f===Ne?`${f} (My Branch)`:f}))]},[U,Ne]),Pt=eo?.VITE_BOOKING_GAS_SECRET||"";d.useEffect(()=>{(async()=>{let l=(()=>{try{const D=localStorage.getItem("user");return D?JSON.parse(D):null}catch{return null}})();if(!l||!l.formDefaults){const D=await Ea().catch(()=>null);if(D?.success&&D.data){l=D.data;try{localStorage.setItem("user",JSON.stringify(l))}catch{}}}const p=l?.formDefaults?.staffName||l?.name||"",f=l?.formDefaults?.branchName||l?.primaryBranch?.name||"",A=[];f&&A.push(f),Array.isArray(l?.branches)&&l.branches.forEach(D=>{const Z=typeof D=="string"?D:D?.name||D?.label||D?.title||"";Z&&A.push(Z)});const F=Array.from(new Set(A.filter(Boolean)));xe(F),ae(String(l?.role||"").toLowerCase()),R({name:p,branch:F[0]||f||""})})()},[]);const pt=String(e||"").toLowerCase(),_e=pt==="jobcard",$e=pt==="booking",Ge=!_e&&!$e,Ot=a=>{if($e){const l=Ln(a);if(l)return l;if(a.bookingPayment?.hasTarget)return a.bookingPayment.isPending?"pending":"completed"}return String(a.status||"").toLowerCase()},Dt=a=>Ot(a)==="pending";at.useEffect(()=>{_e&&$!=="all"&&E("all")},[_e]),at.useEffect(()=>{$e&&$!=="all"&&E("all")},[$e]),at.useEffect(()=>{Ge&&$==="overdue"&&E("all")},[Ge]);const Lt=async({method:a="GET",payload:l})=>_e?await yr({webhookUrl:n,method:a,payload:l}):await nn({webhookUrl:n,method:a,payload:l}),$t=at.useMemo(()=>`FollowUps:${JSON.stringify({mode:pt,filter:$,branch:xt,jobStatus:x})}`,[pt,$,xt,x]),_t=a=>{if(!a)return null;if(He.isDayjs(a))return a;const l=He(a);return l.isValid()?l:null},rn=(a=[])=>a.map(l=>{const p=_t(l.followUpAt),f=_t(l.dateAt);return{...l,followUpAt:p,dateAt:f,sortAtMs:l.sortAtMs||(f?f.valueOf():0)}});d.useEffect(()=>{try{const a=localStorage.getItem($t);if(!a){S(!1);return}const l=JSON.parse(a);l&&Array.isArray(l.rows)?(w(rn(l.rows)),l.at&&y(He(l.at)),S(!0)):S(!1)}catch{S(!1)}},[$t]);const Jt=a=>{try{const p=new URL(a);if(p.hostname.includes("drive.google.com")){const f=p.pathname.split("/"),A=f.indexOf("d");if(A>=0&&f[A+1])return f[A+1];const F=p.searchParams.get("id");if(F)return F}}catch{}const l=String(a||"").match(/[?&]id=([^&]+)/);return l?l[1]:null},zt=a=>{if(!a)return{view:"",download:"",embed:""};const l=Jt(a);return l?{view:`https://drive.google.com/uc?export=view&id=${l}`,download:`https://drive.google.com/uc?export=download&id=${l}`,embed:`https://drive.google.com/file/d/${l}/preview`}:{view:a,download:a,embed:a}},ue=({url:a})=>{if(!a)return t.jsx("span",{style:{color:"#999"},children:""});const{view:l,download:p,embed:f}=zt(a),A=t.jsxs("div",{style:{width:320},children:[t.jsx("div",{style:{height:220,border:"1px solid #e5e7eb",borderRadius:8,overflow:"hidden",marginBottom:8},children:t.jsx("iframe",{src:f,title:"preview",width:"100%",height:"100%",style:{display:"block",border:0},allow:"fullscreen"})}),t.jsxs(Gt,{children:[t.jsx("a",{href:l,target:"_blank",rel:"noopener",children:"Open"}),t.jsx("a",{href:p,children:"Download"})]})]});return t.jsxs(Gt,{size:6,children:[t.jsx(In,{content:A,title:"Preview",trigger:"click",children:t.jsx(Ee,{size:"small",title:"Preview","aria-label":"Preview",children:""})}),t.jsx("a",{href:p,title:"Download","aria-label":"Download",children:""})]})},X=a=>{if(a==null||a==="")return 0;const l=String(a).replace(/[^0-9.-]/g,""),p=Number(l);return Number.isFinite(p)?p:0},ke=(a={},l=[])=>l.reduce((p,f)=>p+X(a?.[f]),0),ge=a=>(Array.isArray(a)?a:[]).reduce((l,p)=>l+X(p?.amount),0),Pe=({payload:a={},values:l={},collected:p=0})=>{const f=[a.bookingAmount,a.bookingTarget,l["Booking Amount"],l.Booking_Amount,l.bookingAmount,l["Total Booking Amount"]].map(X).find(Ve=>Ve>0),A=ke(a,["bookingAmount1","bookingAmount2","bookingAmount3"])||ke(l,["Booking Amount 1","Booking Amount 2","Booking Amount 3"]),F=f||A||0,D=[X(a.totalCollected),X(a.cashCollected)+X(a.onlineCollected),ge(a.payments),ke(a,["bookingAmount1Cash","bookingAmount1Online","bookingAmount2Cash","bookingAmount2Online","bookingAmount3Cash","bookingAmount3Online"]),ke(l,["Booking Amount 1 Cash","Booking Amount 1 Online","Booking Amount 2 Cash","Booking Amount 2 Online","Booking Amount 3 Cash","Booking Amount 3 Online"]),X(l["Collected Amount"]),X(l.Amount),X(p)],Z=Math.max(...D,0),Q=F>0,be=Q?Z+.01<F:null;return{target:F,paid:Z,hasTarget:Q,isPending:be}},Fe=.01,st=/balance/i,nt=a=>{if(a==null)return null;if(typeof a=="object")return a;if(typeof a!="string")return null;try{return JSON.parse(a)}catch{return null}},Ie=a=>{const l=Number(a);return Number.isFinite(l)&&l>=0?l:null},an=(...a)=>{for(const l of a){if(!l&&l!==0)continue;if(typeof l=="object")return l;const p=nt(l);if(p)return p}return null},wn=a=>{if(a==null)return{found:!1};const l=typeof a;if(l==="object"||l==="boolean")return{found:!1};if((l==="string"?a.trim():String(a).trim())==="")return{found:!1};const f=X(a);return Number.isFinite(f)?{found:!0,value:f}:{found:!1}},Rt=a=>{const l=wn(a);return l.found?l.value:null},it=(a,l,p=3,f=new WeakSet)=>{if(!a||typeof a!="object"||p<0)return[];if(f.has(a))return[];f.add(a);const A=Array.isArray(a)?a.map((D,Z)=>[String(Z),D]):Object.entries(a),F=[];for(const[D,Z]of A){if(l.test(String(D||""))){const Q=wn(Z);Q.found&&F.push(Q.value)}if(Z&&typeof Z=="object")F.push(...it(Z,l,p-1,f));else if(typeof Z=="string"){const Q=nt(Z);Q&&typeof Q=="object"&&F.push(...it(Q,l,p-1,f))}}return F};function Ln(a){if(!$e)return null;const l=typeof a?.balanceValue=="number"?a.balanceValue:null;if(l!==null)return l>Fe?"pending":"completed";const p=it(a.payload,st,3),f=it(a.values,st,2),A=[...p,...f];return A.length?A.some(D=>D>Fe)?"pending":"completed":null}const sn=({payload:a,values:l,rawPayload:p,fallback:f})=>{const A=[];if(a&&typeof a=="object"&&A.push(a),l&&typeof l=="object"&&A.push(l),p){const F=nt(p);F&&typeof F=="object"&&A.push(F)}return f&&typeof f=="object"&&A.push(f),A},Vt=(a,l=[])=>{if(!Array.isArray(a))return[];const p=[];for(const f of a)if(!(!f||typeof f!="object"))for(const A of l){const F=ln(f,A);if(F==null)continue;const D=wn(F);D.found&&p.push(D.value)}return p},ln=(a,l=[])=>{if(!(!a||!l.length))return l.reduce((p,f)=>{if(!(!p||typeof p!="object"))return p[f]},a)},Sn=a=>{const l=a?.payload||{},p=a?.values||{},f=["purchaseMode","purchase_mode","purchase type","Purchase Mode","Purchase_Mode","Purchase Type","paymentMode","payment_mode","Payment Mode","Payment Type","paymentType","payment_type"],F=[l.purchaseMode,l.purchaseType,l.paymentType,...f.map(D=>p[D])].find(D=>typeof D=="string"&&D.trim());return String(F||"cash").trim().toLowerCase()},xo=a=>{if(!a)return!1;const l=String(a).trim().toLowerCase();return["loan","nohp","hp","finance"].includes(l)},wo=({payload:a={},values:l={},rawPayload:p=null,purchaseType:f}={})=>{if(!a||typeof a!="object")return{pendingAmount:null,pendingLabel:""};const A=an(p,l?.rawPayload,l?.["Raw Payload"],a?.rawPayload,a?.["Raw Payload"])||{},F=[X(a?.bookingAmount),X(l?.["Booking Amount"]),X(l?.bookingAmount),X(l?.Booking_Amount),X(A?.bookingAmount)].find(H=>H>0)??0,D=[X(A?.totalVehicleCost),X(A?.cash?.totalVehicleCost),X(A?.cash?.onRoadPrice),X(a?.totalVehicleCost),X(a?.onRoadPrice),X(l?.["Total Vehicle Cost"]),X(l?.["On Road Price"])].find(H=>H>0)??0,Z=[X(A?.totalDp),X(A?.dp?.totalDp),X(a?.totalDp),X(a?.dp?.totalDp),X(l?.["Total DP"])].find(H=>H>0)??0,Q=X(A?.downPayment||a?.downPayment||l?.["Down Payment"])+X(A?.extraFittingAmount||a?.extraFittingAmount||l?.["Extra Fitting Amount"])+X(A?.affidavitCharges||a?.affidavitCharges||l?.["Affidavit Charges"]),Ae=Z||Q||0,be=String(f||a?.purchaseMode||l?.["Purchase Mode"]||A?.purchaseMode||"cash").trim().toLowerCase(),Ve=["loan","nohp","hp","finance"].includes(be),Ze=Ve?"Balanced DP":"Balance Amount",lt=Ve?Ae-F:D-F,Ct=Math.max(0,Number.isFinite(lt)?lt:0);return a.pendingBalance=Ct,a.pendingType=Ze,{pendingAmount:Ct,pendingLabel:Ze}},So=(...a)=>{const l=[],p=f=>{if(!(!f||typeof f!="object")){if(Array.isArray(f)){f.forEach(p);return}"payments"in f&&Array.isArray(f.payments)&&p(f.payments),"paymentSplit"in f&&Array.isArray(f.paymentSplit)&&f.paymentSplit.forEach(A=>{A&&typeof A=="object"&&l.push(A)}),"paymentDetails"in f&&Array.isArray(f.paymentDetails)&&p(f.paymentDetails),!("payments"in f)&&!("paymentSplit"in f)&&!("paymentDetails"in f)&&l.push(f)}};return a.forEach(f=>{if(f){if(Array.isArray(f)){f.forEach(p);return}if(typeof f=="string"){try{const A=JSON.parse(f);p(A)}catch{return}return}p(f)}}),l},_n=({payload:a,values:l,rawPayload:p})=>{const f=l||{},A=So(a?.payments,f.payments,f.paymentDetails,a?.paymentSplit,f.paymentSplit,p?.payments,p?.paymentSplit,p?.paymentDetails),F={cash:0,online:0,total:0};A.forEach(be=>{const Ve=Ie(be?.amount);if(Ve===null)return;const Ze=String(be?.mode||"").trim().toLowerCase();Ze==="cash"?F.cash+=Ve:Ze==="online"&&(F.online+=Ve),F.total+=Ve});const D=Ie(a?.dp?.totalDp)??Ie(a?.totalDp)??Ie(a?.downPayment)??Ie(f.totalDp)??Ie(f.downPayment)??Ie(p?.dp?.totalDp)??Ie(p?.totalDp)??Ie(p?.downPayment),Z=D!==null,Q=Z?D:0,Ae=Math.max(0,Q-F.total);return{cashCollected:F.cash,onlineCollected:F.online,totalCollected:F.total,totalDp:Q,balancedDp:Ae,hasTotals:Z,hasPayments:A.length>0}},Et=[["dp","balancedDp"],["dp","balanceTP"],["dp","balanceTPIC"],["balanceTP"],["balancedDp"],["balance"]],jn=[["balancedAmount"],["balanceAmount"],["cash","balancedAmount"],["balance"],["dp","balancedDp"]],jo=[["cash","totalVehicleCost"],["cash","onRoadPrice"],["cash","price"],["vehicle","totalVehicleCost"],["vehicle","onRoadPrice"],["vehicle","price"],["totalVehicleCost"],["onRoadPrice"],["price"]],cn=a=>{const l=a?.target;return!l||typeof l.closest!="function"?!1:!!l.closest("button, a, input, textarea, [role='button']")},zn=a=>String(a||"").replace(/\D/g,"").slice(-10),Co=a=>{if(!a)return;Me(!0),Pl({payload:a.payload,values:a.values,bookingId:a.bookingId,mobile:a.mobile,serialNo:a.serialNo});const l=zn(a.mobile||a.values?.Mobile||a.values?.mobile);typeof o=="function"&&o(),r("/bookingform",{state:l?{autoFetch:{mode:"mobile",query:l}}:void 0}),Me(!1)};d.useEffect(()=>()=>{Me(!1)},[]);const Cn=(a,l)=>{const p=l||{},f=a||{},A=["File URL","File","Document URL","Document","Doc URL","Doc","Drive URL","Drive","fileUrl","file","documentUrl","document","driveUrl"];for(const Z of A){const Q=p[Z]??f[Z];if(typeof Q=="string"&&Q.trim())return Q.trim()}const F=[f.files,f.documents,f.attachments,f.docs];for(const Z of F)if(Array.isArray(Z)){const Q=Z.find(be=>typeof be=="string"&&be.trim());if(Q)return Q.trim();const Ae=Z.find(be=>be&&typeof be.url=="string"&&be.url.trim());if(Ae)return Ae.url.trim()}const D=Z=>{try{for(const Q of Object.keys(Z||{})){const Ae=Z[Q];if(typeof Ae=="string"&&/^https?:\/\//i.test(Ae))return Ae}}catch{}return""};return D(p)||D(f)||""},dn=a=>String(a||"").trim().toLowerCase(),St=async()=>{u(!0);try{if(!n){w([]),u(!1),je.info("Follow-ups webhook not configured.");return}const a=eo?.VITE_BOOKING_GAS_SECRET||"",l=eo?.VITE_JOBCARD_GAS_SECRET||"",p=wt,f=$e?(()=>{const H=a?{action:"list",page:1,pageSize:N,secret:a}:{action:"list",page:1,pageSize:N};return p?{...H,branch:p}:H})():{action:"list",branch:p||"",page:1,pageSize:N};let A=await Lt({method:"GET",payload:f}).catch(()=>null),F=A?.data||A||{},D=Array.isArray(F?.rows)?F.rows:Array.isArray(F?.data)?F.data:[];const Z=H=>{if(!H)return null;if(H.payload&&typeof H.payload=="object")return H.payload;if(typeof H.payload=="string")try{return JSON.parse(H.payload)}catch{}const Se=H.values&&(H.values.Payload||H.values.payload||H.values.PAYLOAD)||H.Payload||H.PAYLOAD;if(typeof Se=="string")try{return JSON.parse(Se)}catch{}return H.formValues&&(H.followUp||H.savedAt||H.postServiceAt)?H:null},Q=H=>{if(H==null||H==="")return null;try{if(He.isDayjs(H))return H.isValid()?H:null;if(H instanceof Date){const Re=He(H);return Re.isValid()?Re:null}if(typeof H=="number"){const Re=He(H);return Re.isValid()?Re:null}const Se=String(H).trim();if(!Se)return null;const V=Number(Se);if(!Number.isNaN(V)&&Se.length>=10){const Re=He(V);if(Re.isValid())return Re}const q=new Date(Se);if(!Number.isNaN(q.getTime()))return He(q);const v=Se.match(/^(\d{1,2})([/-])(\d{1,2})\2(\d{2,4})(?:\s+(\d{1,2}):(\d{2})(?::(\d{2}))?\s*(AM|PM)?)?$/i);if(v){const Re=v[2];let ht=parseInt(v[1],10),pn=parseInt(v[3],10),fn=parseInt(v[4],10);fn<100&&(fn+=2e3);let en,hn;Re==="-"||ht>12?(hn=ht,en=pn-1):(en=ht-1,hn=pn);let tn=v[5]?parseInt(v[5],10):0;const $o=v[6]?parseInt(v[6],10):0,Xn=v[7]?parseInt(v[7],10):0,Qe=(v[8]||"").toUpperCase();Qe==="PM"&&tn<12&&(tn+=12),Qe==="AM"&&tn===12&&(tn=0);const Rn=new Date(fn,en,hn,tn,$o,Xn);if(!Number.isNaN(Rn.getTime()))return He(Rn)}const ct=He(Se);return ct.isValid()?ct:null}catch{return null}},Ae=(...H)=>H.find(Se=>typeof Se=="string"?Se.trim():Se)||null,be=D.map((H,Se)=>{const V=Z(H)||{},q=V.formValues||{},v=H&&H.values?H.values:H||{},ct=an(V.rawPayload,v?.["Raw Payload"],v?.rawPayload,v?.RawPayload,v?.rawpayload,H.rawPayload,H.payload?.rawPayload),Re=V.followUp||V.followup||V.follow_up||{},ht=_e?q.jcNo||q.JCNo||V.jcNo||V.JCNo||q.serialNo||V.serialNo||"-":$e?q.bookingId||V.bookingId||v["Booking ID"]||v.Booking_Id||v["Booking Id"]||"-":q.serialNo||V.serialNo||v["Quotation No."]||v["Quotation No"]||v.Serial||"-",pn=V.company||q.company||vn(v,["Company","company","Company Name","Brand"])||"",fn=V.model||V.vehicle?.model||q.bikeModel||q.model||vn(v,["Model","model","Bike Model","bikeModel"])||"",en=V.variant||V.vehicle?.variant||q.variant||vn(v,["Variant","variant"])||"",hn=V.color||V.vehicle?.color||q.color||v.Color||v.Colour||v["Vehicle Color"]||v["Vehicle Colour"]||"",tn=[pn,fn,en].filter(Boolean).join(" "),$o=q.branch||V.branch||v.Branch||v["Branch Name"]||"-",Xn=(()=>{if(V.postServiceAt||Array.isArray(V.payments)&&V.payments.some(Io=>Number(Io?.amount||0)>0)||v["Post Service At"]||v.PostServiceAt||v.Post_Service_At)return!0;const Jn=Io=>String(v[Io]||"").trim().toLowerCase();return!!["yes","done","completed","true"].includes(Jn("Post Service"))})();let Qe=Ae(V.postServiceAt,V.savedAt,V.ts,V.tsMs,V.createdAt,ct?.ts,ct?.createdAt,v["Post Service At"],v.PostServiceAt,v.Post_Service_At,v["Saved At"],v.savedAt,v.Timestamp,v.timestamp,v.TS,v.DateTime,v["Date Time"],v.Date_Time,v["Submitted At"],v.SubmittedAt,v.submittedAt,v["Created At"],v.CreatedAt,v.createdAt,v.Time,v.Date,H?.tsMs,H?.ts,H?.dateTimeIso);(Qe==null||Qe==="")&&v.Date&&v.Time&&(Qe=`${v.Date} ${v.Time}`);const Rn=(()=>{if(Qe==null||Qe==="")return null;if(typeof Qe=="number")return Q(Qe);const gt=Number(Qe);return!Number.isNaN(gt)&&String(Qe).trim()!==""&&gt>1e7?Q(gt):Q(Qe)})();let Ro=Re.at??Re.followUpAt??Re.followupAt??Re.date??Re.datetime??V.followUpAt??V.followupAt??V.followUpDate??V.followupDate??v["Follow-up At"]??v["Follow Up At"]??v["Followup At"]??v["Follow-up Date"]??v["Follow Up Date"]??v["Followup Date"]??v["Next Follow-up"]??v["Next Follow Up"]??v["Next Followup"]??v["Follow-up"]??v["Follow Up"]??v.Followup;if(!Ro){const gt=v["Follow-up Date"]||v["Follow Up Date"]||v["Followup Date"]||"",Jn=v["Follow-up Time"]||v["Follow Up Time"]||v["Followup Time"]||"";gt&&Jn&&(Ro=`${gt} ${Jn}`)}const Eo=Q(Ro),To=Rn||Eo,va=To&&typeof To.valueOf=="function"?To.valueOf():0,xa=Rn||null,wa=q.amount||v["Collected Amount"]||v.Amount||0,Sa=$e?Pe({payload:V,values:v,collected:wa}):null,ja=ct||V.rawPayload||v?.rawPayload||v?.["Raw Payload"]||v?.RawPayload||H.rawPayload,gn={payload:V,values:v,rawPayload:ja},Fo=sn({payload:V,values:v,rawPayload:gn.rawPayload,fallback:ct||nt(gn.rawPayload)}),lr=xo(Sn(gn)),dt=_n({payload:V,values:v,rawPayload:ct||gn.rawPayload}),Ca=Sn(gn),Mo=wo({payload:V,values:v,rawPayload:gn.rawPayload,purchaseType:Ca}),Aa=$e&&dt.hasTotals?dt.balancedDp>Fe?"pending":"completed":null,cr=Vt(Fo,jn),dr=Vt(Fo,Et),ur=Vt(Fo,jo),Na=Number.isFinite(dt.totalCollected)?dt.totalCollected:0,mr=ur.length?Math.max(...ur):null,pr=mr!==null?Math.max(0,mr-Na):null,ka=Rt(V?.cash?.balancedAmount)??Rt(V?.balancedAmount)??Rt(v?.balancedAmount)??Rt(v?.balanceAmount)??(cr.length?Math.max(...cr):null)??(pr!==null?pr:null),fr=Rt(V?.dp?.balancedDp)??Rt(V?.balancedDp)??Rt(v?.balancedDp)??(dr.length?Math.max(...dr):null)??(dt.hasTotals?dt.balancedDp:null),hr=Number.isFinite(Mo?.pendingAmount)?Mo.pendingAmount:null,Pa=Mo?.pendingLabel||"",gr=hr!==null?hr:lr&&fr!==null?fr:ka,Oa=Pa||(lr&&gr!==null?"Balanced DP":"Balanced Amount");return{key:ht||Se,serialNo:ht||"-",bookingId:$e&&ht&&ht!=="-"?ht:"",name:q.custName||q.name||v.Customer_Name||v["Customer Name"]||v.Customer||v.Name||"-",mobile:q.custMobile||q.mobile||v.Mobile||v["Mobile Number"]||v.Phone||"-",company:pn,vehicle:tn,branch:String($o||"-").trim(),executive:q.executive||Re.assignedTo||v.Executive||"-",followUpAt:Eo,dateAt:xa||Eo||null,sortAtMs:va,followUpNotes:Re.notes??V.followupNotes??V.followUpNotes??v["Follow-up Notes"]??v["Follow Up Notes"]??v["Followup Notes"]??"",closeReason:Re.closeReason||V.closeReason||q.closeReason||"",status:_e?Xn?"completed":"pending":$e?Aa||(()=>{const gt=Re.status||V.status||q.status||v.Status||v["Booking Status"]||"";return String(gt||"pending").toLowerCase()})():(()=>{const gt=Re.status||V.status||q.status||v.Status||v["Booking Status"]||"";return String(gt||"pending").toLowerCase()})(),price:Number((q.onRoadPrice??V.onRoadPrice??q.price??V.price)||0),brand:(V.brand||"").toUpperCase()||"SHANTHA",remarks:q.remarks||V.remarks||v.Remarks||v.remarks||"",jcNo:q.jcNo||V.jcNo||v["JC No"]||v["JC No."]||v["Job Card No"]||ht||"-",regNo:q.regNo||v["Vehicle No"]||v.Vehicle_No||"",model:fn,variant:en,color:hn,amount:q.amount||v["Collected Amount"]||v.Amount||0,availability:v["Chassis Availability"]||v.Availability||v.Stock||v["Stock Status"]||V?.vehicle?.availability||q?.vehicle?.availability||"",fileUrl:Cn(V,v),postServiced:Xn,payload:V,values:v,bookingPayment:Sa,balanceValue:gr,balanceLabel:Oa,cashCollected:dt.cashCollected,onlineCollected:dt.onlineCollected,totalCollected:dt.totalCollected,totalDp:dt.hasTotals?dt.totalDp:void 0,balancedDp:dt.balancedDp}}),Ve=He().startOf("day"),Ze=He().endOf("day"),lt=_e?(()=>{let H=be;if(x!=="all"){const Se=String(x).toLowerCase();H=H.filter(V=>String(V.status||"").toLowerCase()===Se)}return H})():be.filter(H=>{const Se=dn(H.branch),V=dn(Ne),q=vt?dn(vt):"";if(ce){if(q&&Se!==q)return!1}else if(!V||Se!==V)return!1;if($==="all")return!0;const v=H.followUpAt&&H.followUpAt.isValid&&H.followUpAt.isValid()?H.followUpAt:H.dateAt;return!v||!v.isValid()?!1:$==="today"?!v.isBefore(Ve)&&!v.isAfter(Ze):$==="overdue"?v.isBefore(Ve):$==="upcoming"?v.isAfter(Ze):!0}),Ct=H=>Dt(H)?0:1;lt.sort((H,Se)=>{const V=Ct(H),q=Ct(Se);if(V!==q)return V-q;const v=Number(Se.sortAtMs||0),ct=Number(H.sortAtMs||0);return v-ct}),w(lt),y(He());try{localStorage.setItem($t,JSON.stringify({at:Date.now(),rows:lt}))}catch{}}catch(a){console.warn("followups fetch failed",a),je.error("Could not fetch follow-ups. Check the Apps Script.")}finally{u(!1)}};d.useEffect(()=>{!n||It&&!wt||St()},[n,$,C,h,Ne,e,qe,U.length,x,It,wt,ce]);const An=async(a,l,p={})=>{const{refreshOnSuccess:f=!0,showSuccessMessage:A=!0,showErrorMessage:F=!0}=p||{};try{const Z={branch:ce?vt||l?.branch||Ne:Ne||l?.branch||U[0]||"",...l};if(Z?.followUp?.notes){const be=Z.followUp.notes;Z.notes=Z.notes??be,Z.followupNotes=Z.followupNotes??be}if(Z?.closeNotes){const be=Z.closeNotes;Z.notes=Z.notes??be,Z.followupNotes=Z.followupNotes??be}const Q=await Lt({method:"POST",payload:{action:"updateFollowup",serialNo:a,patch:Z}});if(!(Q?.data||Q)?.success)throw new Error("Failed");return A&&je.success("Updated"),f&&await St(),!0}catch{return F&&je.error("Update failed"),!1}},Nn=(a,l)=>{let p=null;const f=String(a||"").trim();return w(A=>(A||[]).map(F=>{if(String(F?.serialNo||"").trim()!==f)return F;p={...F};const D={...F};Object.prototype.hasOwnProperty.call(l||{},"status")&&(D.status=String(l?.status||"").toLowerCase()),Object.prototype.hasOwnProperty.call(l||{},"closeReason")&&(D.closeReason=l?.closeReason||""),Object.prototype.hasOwnProperty.call(l||{},"closeNotes")&&(D.closeNotes=l?.closeNotes||"");const Z=l?.followUp?.notes??l?.followupNotes??l?.notes??l?.closeNotes;if((Object.prototype.hasOwnProperty.call(l||{},"followUp")||Object.prototype.hasOwnProperty.call(l||{},"closeNotes")||Object.prototype.hasOwnProperty.call(l||{},"notes"))&&(D.followUpNotes=String(Z||"").trim()),l?.followUp&&Object.prototype.hasOwnProperty.call(l.followUp,"at")){const Q=l.followUp.at;if(!Q)D.followUpAt=null;else{const Ae=He(Q);Ae.isValid()&&(D.followUpAt=Ae,D.sortAtMs=Ae.valueOf())}}return D})),p},Vn=(a,l)=>{if(!l)return;const p=String(a||"").trim();w(f=>(f||[]).map(A=>String(A?.serialNo||"").trim()===p?l:A))},Yt=a=>{const l=He().format("DD-MM-YYYY HH:mm"),p=String(a||"").trim();return p?`${l} - ${p}`:l},Ut=a=>a&&a.isValid&&a.isValid()?a.format("DD-MM-YYYY HH:mm"):"",ze={display:"flex",flexDirection:"column",gap:2,lineHeight:1.2},Ue={whiteSpace:i?"normal":"nowrap",overflow:"hidden",textOverflow:i?"clip":"ellipsis"},Be={...Ue,fontSize:i?12:11},Je={display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:i?4:3,overflow:"hidden",whiteSpace:"normal",fontSize:i?11:10,lineHeight:1.25},ft={...Je,WebkitLineClamp:2,fontSize:i?11:10.5,fontWeight:600,color:"#1f2937"},ot=at.useMemo(()=>{let a=Array.isArray(b)?b.slice():[];if(de&&de[0]&&de[1]){const p=de[0].startOf("day"),f=de[1].endOf("day");a=a.filter(A=>{const F=A.followUpAt||A.dateAt;return!F||!F.isValid||!F.isValid()?!1:!F.isBefore(p)&&!F.isAfter(f)})}const l=String(me||"").trim().toLowerCase();return l&&(a=a.filter(p=>[p.serialNo,p.bookingId,p.jcNo,p.name,p.mobile,p.branch,p.executive,p.vehicle,p.model,p.variant,p.color,p.regNo,p.status,p.remarks,p.followUpNotes,p.closeReason].filter(Boolean).join(" ").toLowerCase().includes(l))),a},[b,de,me]),Ye=at.useMemo(()=>{const a=Array.isArray(ot)?ot:[],l=a.length,p=a.filter(A=>Ot(A)==="pending").length,f=a.filter(A=>Ot(A)!=="pending").length;return{total:l,pending:p,completed:f,other:0}},[ot,$e]);d.useEffect(()=>{fe(1)},[me,de,$,x,h,e]),d.useEffect(()=>{const a=Math.max(1,Math.ceil(ot.length/he));we>a&&fe(1)},[ot.length,we,he]);const Zt=i?"100%":void 0,Qt=i?10:12,Tt=i?110:120,Ao=i?160:180,un=i?{...Br,fontSize:18}:Br,jt=i?{...Dr,fontSize:10}:Dr,Un=a=>{const l=String(a?.mobile||"").replace(/\D/g,"").slice(-10),p=String(a?.jcNo||a?.serialNo||"").trim(),f=new URLSearchParams;f.set("autoFetch","1"),l?(f.set("mode","mobile"),f.set("query",l)):p&&(f.set("mode","jc"),f.set("query",p)),p&&f.set("jcNo",p);const A=f.toString();r(A?`/jobcard?${A}`:"/jobcard")},kn=a=>{if(!a)return null;if(a.payload&&typeof a.payload=="object")return a.payload;const l=a.payload||a.Payload||a.PAYLOAD||a?.values?.Payload||a?.values?.payload||a?.values?.PAYLOAD||a?._raw?.payload||a?._raw?.Payload||a?._raw?.PAYLOAD||a?._raw?.values?.Payload||a?._raw?.values?.payload||a?._raw?.values?.PAYLOAD||"";if(l&&typeof l=="object")return l;if(l&&typeof l=="string")try{return JSON.parse(l)}catch{return null}return a.formValues||a.values?a:null},Wn=(a,l)=>{if(!a)return null;const p=a.formValues||a.values||{},f=Array.isArray(a.labourRows)?a.labourRows:Array.isArray(p.labourRows)?p.labourRows:[],A=a.totals||p.totals||{},F=f.reduce((Q,Ae)=>Q+Number(Ae?.qty||0)*Number(Ae?.rate||0),0),D={labourSub:A.labourSub??F,labourGST:A.labourGST??0,labourDisc:A.labourDisc??0,grand:A.grand??F},Z=a.postServiceAt||a.createdAt||a.savedAt||l?.postAt||l?.ts||new Date;return{vals:{jcNo:l?.jcNo||p.jcNo||"",regNo:l?.regNo||p.regNo||"",custName:l?.name||p.custName||p.name||"",custMobile:l?.mobile||p.custMobile||p.mobile||"",km:l?.km||p.km||"",model:l?.model||p.model||"",colour:p.colour||l?.colour||"",branch:l?.branch||p.branch||"",executive:l?.executive||p.executive||"",createdAt:Z,labourRows:f,gstLabour:A.gstLabour||A.labourGST||0},totals:D}},No=async a=>{if(!a)return;if(String(a.status||"").toLowerCase()!=="completed"){je.warning("Complete post-service to generate the service invoice.");return}if(!n){je.error("Jobcard webhook is not configured.");return}const p=a.jcNo||a.key||a.mobile||"";ie(p);try{let f=kn(a),A=f?Wn(f,a):null;const F=Array.isArray(A?.vals?.labourRows)&&A.vals.labourRows.length>0;if(!A||!F){const D=String(a.mobile||"").replace(/\D/g,"").slice(-10);if(D.length===10){const Z=eo?.VITE_JOBCARD_GAS_SECRET||"",Q={action:"search",mode:"mobile",query:D},Ae=Z?{...Q,secret:Z}:Q,be=await yr({webhookUrl:n,method:"GET",payload:Ae}),Ve=be?.data||be,Ze=Array.isArray(Ve?.rows)?Ve.rows:Array.isArray(Ve?.data)?Ve.data:[];if(Ze.length){let lt=Ze[0];if(a.jcNo){const H=Ze.find(Se=>{const V=kn(Se),v=(V?.formValues||V?.values||{}).jcNo||Se?.jcNo||Se?.values?.["JC No"]||Se?.values?.["JC No."]||Se?.values?.["Job Card No"]||"";return String(v||"").trim()===String(a.jcNo||"").trim()});H&&(lt=H)}const Ct=kn(lt);A=Ct?Wn(Ct,a):A}}}if(!A){je.error("Could not load service invoice data.");return}se(A),Y(!0),setTimeout(()=>{try{sr(le.current)}catch{}setTimeout(()=>Y(!1),500)},50)}catch{je.error("Could not generate service invoice.")}finally{ie(null)}},mn={fontSize:i?Ge?10:9:Ge?11:10,lineHeight:"1.1",marginRight:0},Pn={height:i?22:26,padding:i?"0 8px":"0 10px",borderRadius:999,fontSize:i?11:12,fontWeight:700},Hn={height:i?22:26,padding:i?"0 8px":"0 10px",borderRadius:999,fontSize:i?11:12},ko={height:i?24:26,padding:i?"0 8px":"0 10px",borderRadius:999,fontSize:i?11:12,fontWeight:700},qn={height:i?24:26,padding:i?"0 8px":"0 10px",borderRadius:999,fontSize:i?11:12},Po={height:i?20:18,padding:"0 6px",fontSize:i?11:10},Gn=a=>{const l=String(a.status||"").toLowerCase(),p=l==="pending",f=l==="completed",A=z===(a.jcNo||a.key||a.mobile||""),F={display:"flex",flexDirection:"column",gap:2,lineHeight:1.1},D=String(a?.mobile||"").replace(/[^\d+]/g,"");return t.jsxs("div",{style:F,children:[t.jsx(Nt,{title:a.closeReason||a.followUpNotes||"",children:t.jsx(tt,{color:to[a.status]||"default",style:mn,children:no[a.status]||a.status})}),t.jsxs("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:[t.jsx(Ee,{size:"small",icon:t.jsx(Vo,{}),style:Hn,onClick:()=>{if(!D){je.warning("Mobile number not available");return}window.location.href=`tel:${D}`},children:"Call"}),p?t.jsx(Ee,{size:"small",type:"primary",icon:t.jsx(Vo,{}),style:Pn,onClick:()=>Un(a),children:"Post Service"}):f?t.jsx(Ee,{size:"small",type:"default",icon:t.jsx(Tr,{}),loading:A,style:Hn,onClick:()=>No(a),children:"Service Invoice"}):null]})]})},Oo=a=>{const l=String(a?.mobile||"").replace(/[^\d+]/g,"");if(!l){je.warning("Mobile number not available");return}window.location.href=`tel:${l}`},On=a=>{const l=String(a?.status||"pending").toLowerCase();return l==="pending"?t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,lineHeight:1.1},children:[t.jsx(Nt,{title:a.closeReason||a.followUpNotes||"",children:t.jsx(tt,{color:to[l]||"default",style:mn,children:no[l]||l})}),t.jsxs("div",{style:{display:"flex",gap:4,flexWrap:"wrap"},children:[t.jsx(Nt,{title:"Call customer",children:t.jsx(Ee,{size:"small",icon:t.jsx(Vo,{}),style:qn,onClick:()=>Oo(a),children:"Call"})}),t.jsx(Nt,{title:"Mark done/booked with reason",children:t.jsx(Ee,{size:"small",type:"primary",icon:t.jsx(Ar,{}),style:ko,onClick:()=>k({open:!0,serial:a.serialNo,status:"converted",reason:"",notes:""}),children:"Done"})}),t.jsx(Ee,{size:"small",style:qn,onClick:()=>ee({open:!0,serial:a.serialNo,at:a.followUpAt||He(),notes:a.followUpNotes||""}),children:"Reschedule"})]})]}):t.jsx("div",{style:{display:"flex",lineHeight:1.1},children:t.jsx(Nt,{title:a.closeReason||a.followUpNotes||"",children:t.jsx(tt,{color:to[l]||"default",style:mn,children:no[l]||l})})})},Kn=a=>{const l=a.values||{},p=l["Invoice Status"]||l.Invoice_Status||l.invoiceStatus||a.payload?.invoiceStatus||"",f=l["Invoice File URL"]||l.Invoice_File_URL||l.invoiceFileUrl||a.payload?.invoiceFileUrl||"",A=l["Insurance Status"]||l.Insurance_Status||l.insuranceStatus||a.payload?.insuranceStatus||"",F=l["Insurance File URL"]||l.Insurance_File_URL||l.insuranceFileUrl||a.payload?.insuranceFileUrl||"";return t.jsxs("div",{style:ze,children:[t.jsxs("div",{style:Ue,children:[t.jsx(tt,{color:"geekblue",children:String(p||"-").replace(/_/g," ")}),f?t.jsx("a",{href:f,target:"_blank",rel:"noopener noreferrer",children:""}):null]}),t.jsxs("div",{style:Ue,children:[t.jsx(tt,{color:"cyan",children:String(A||"-").replace(/_/g," ")}),F?t.jsx("a",{href:F,target:"_blank",rel:"noopener noreferrer",children:""}):null]})]})},$n=a=>{const l=a.values||{},p=l["RTO Status"]||l.RTO_Status||l.rtoStatus||a.payload?.rtoStatus||"",f=a.regNo||l["Vehicle No"]||l.Vehicle_No||l.vehicleNo||a.payload?.vehicleNo||"";return t.jsxs("div",{style:ze,children:[t.jsx("div",{style:Ue,children:t.jsx(tt,{children:String(p||"-").replace(/_/g," ")})}),t.jsx("div",{style:Ue,children:t.jsx(tt,{children:f||"-"})})]})},s=a=>t.jsxs("div",{style:ze,children:[t.jsx("div",{style:Ue,children:t.jsx(Nt,{title:a.followUpNotes||"",children:t.jsx(tt,{color:to[a.status]||"default",style:mn,children:no[a.status]||a.status})})}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,flexWrap:"wrap"},children:[t.jsx(ue,{url:a.fileUrl}),t.jsx(Ee,{size:"small",style:Po,title:"Print booking","aria-label":"Print booking",onClick:l=>{if(l.stopPropagation(),!a.bookingId){je.warning("Booking ID missing for print");return}ne({open:!0,row:a})},children:""})]})]}),O=a=>t.jsxs("div",{style:ze,children:[t.jsx("div",{style:Ue,children:mo(a.balanceValue)}),t.jsx("div",{style:Be,children:a.balanceLabel||"Balance"})]}),J=i?_e?[{title:"Details",key:"details",render:(a,l)=>{const p=[Ut(l.dateAt),l.branch||""].filter(Boolean).join(" | "),f=[l.name||"",l.mobile||""].filter(Boolean).join(" | "),A=[l.model||"",l.regNo||""].filter(Boolean).join(" || ");return t.jsxs("div",{style:ze,children:[t.jsx("div",{style:Ue,children:p||""}),t.jsx("div",{style:Be,children:f||""}),t.jsx("div",{style:Be,children:A||""})]})}},{title:"Status",key:"statusActions",render:(a,l)=>Gn(l)}]:$e?[{title:"Details",key:"details",render:(a,l)=>{const p=[Ut(l.dateAt),l.branch||""].filter(Boolean).join(" | "),f=[l.name||"",l.mobile||""].filter(Boolean).join(" | "),A=String(l.model||"").trim(),F=String(l.variant||"").trim(),D=String(l.color||"").trim();return t.jsxs("div",{style:ze,children:[t.jsx("div",{style:Ue,children:p||""}),t.jsx("div",{style:Be,children:f||""}),t.jsx("div",{style:Be,children:[A,F].filter(Boolean).join(" || ")||""}),t.jsx("div",{style:Be,children:D||""})]})}},{title:"Docs / Status",key:"docsStatus",render:(a,l)=>t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[Kn(l),$n(l),s(l),O(l)]})}]:[{title:"Details",key:"details",render:(a,l)=>{const p=[Ut(l.dateAt),l.branch||""].filter(Boolean).join(" | "),f=[l.name||"",l.mobile||""].filter(Boolean).join(" | "),A=Vr(l),F=A.vehicles.length,D=String(l.followUpNotes||"").trim(),Z=t.jsxs("div",{className:"fu-offering-pop",children:[t.jsx("div",{className:"fu-offering-head",children:t.jsx("span",{children:F?`${F} Vehicle Offer${F>1?"s":""}`:"Offer Details"})}),A.vehicles.length?A.vehicles.map(Q=>t.jsxs("div",{className:"fu-offering-vehicle",children:[t.jsx("div",{className:"fu-offering-vehicle-title",children:Q.label}),t.jsx("div",{className:"fu-offering-vehicle-model",children:Q.title}),t.jsxs("div",{className:"fu-offering-metrics",children:[t.jsxs("span",{children:[t.jsx("b",{children:"Price"}),": ",Q.priceText]}),Q.showFinance?t.jsxs("span",{children:[t.jsx("b",{children:"DP"}),": ",Q.dpText]}):null]}),Q.showFinance&&Q.emiText?t.jsx("div",{className:"fu-offering-emi",children:Q.emiText}):null,Q.fittings.length?t.jsxs("div",{className:"fu-offering-fit",children:[t.jsx("b",{children:"Fittings"}),": ",Q.fittings.join(", ")]}):null]},Q.label)):t.jsx("div",{className:"fu-offering-empty",children:"No vehicle-wise offer added."})]});return t.jsxs("div",{style:ze,children:[t.jsx("div",{style:Ue,children:p||""}),t.jsx("div",{style:Be,children:f||""}),F?t.jsx(In,{content:Z,trigger:["click"],placement:"topLeft",overlayClassName:"fu-offering-popover",children:t.jsx("div",{className:"fu-offering-list",children:A.vehicles.map(Q=>t.jsxs("div",{className:"fu-offering-list-item",children:[t.jsxs("span",{className:"fu-offering-list-label",children:[Q.label,":"]})," ",Q.title]},Q.label))})}):t.jsx("div",{style:ft,children:"No offering details"}),D?t.jsxs("div",{style:Je,children:[t.jsx("span",{style:{color:"#64748b"},children:"Notes: "}),D]}):t.jsx("div",{style:Je})]})}},{title:"Status",key:"statusActions",render:(a,l)=>On(l)}]:_e?[{title:"Date / Branch",key:"dateBranch",width:130,render:(a,l)=>t.jsxs("div",{style:ze,children:[t.jsx("div",{style:Ue,children:Ut(l.dateAt)}),t.jsx("div",{style:Be,children:l.branch||""})]})},{title:"Customer / Mobile",key:"customerMobile",width:140,render:(a,l)=>t.jsxs("div",{style:ze,children:[t.jsx("div",{style:Ue,children:l.name||""}),t.jsx("div",{style:Be,children:l.mobile||""})]})},{title:"Model / Vehicle No",key:"modelVehicle",width:140,render:(a,l)=>t.jsxs("div",{style:ze,children:[t.jsx("div",{style:Ue,children:l.model||""}),t.jsx("div",{style:Be,children:l.regNo||""})]})},{title:"Status + Actions",key:"statusActions",width:150,render:(a,l)=>Gn(l)}]:$e?[{title:"Date / Branch",key:"dateBranch",width:130,render:(a,l)=>t.jsxs("div",{style:ze,children:[t.jsx("div",{style:Ue,children:Ut(l.dateAt)}),t.jsx("div",{style:Be,children:l.branch||""})]})},{title:"Customer / Mobile",key:"customerMobile",width:140,render:(a,l)=>t.jsxs("div",{style:ze,children:[t.jsx("div",{style:Ue,children:l.name||""}),t.jsx("div",{style:Be,children:l.mobile||""})]})},{title:"Model / Variant || Color",key:"modelVariantColor",width:160,render:(a,l)=>{const p=String(l.model||"").trim(),f=String(l.variant||"").trim(),F=[String(l.color||"").trim()].filter(Boolean),D=F.length?F.join(" | "):"";return t.jsxs("div",{style:ze,children:[t.jsx("div",{style:Be,children:[p,f].filter(Boolean).join(" || ")||""}),t.jsx("div",{style:Be,children:D})]})}},{title:"Invoice + Insurance",key:"invoiceInsurance",width:140,render:(a,l)=>Kn(l)},{title:"RTO + Vehicle No",key:"rtoVehicle",width:140,render:(a,l)=>$n(l)},{title:"Status + File",key:"statusFile",width:170,render:(a,l)=>s(l)},{title:"Balance",key:"balance",width:140,render:(a,l)=>O(l)}]:[{title:"Date / Branch",key:"dateBranch",width:145,render:(a,l)=>t.jsxs("div",{style:ze,children:[t.jsx("div",{style:{...Be,fontWeight:700},children:Ut(l.dateAt)}),t.jsx("div",{style:{...Be,color:"#475569"},children:l.branch||""})]})},{title:"Customer / Mobile",key:"customerMobile",width:165,render:(a,l)=>t.jsxs("div",{style:ze,children:[t.jsx("div",{style:{...Be,fontWeight:700},children:l.name||""}),t.jsx("div",{style:{...Be,color:"#334155"},children:l.mobile||""})]})},{title:"Offerings",key:"remarks",width:265,render:(a,l)=>{const p=Vr(l),f=p.vehicles.length,A=t.jsxs("div",{className:"fu-offering-pop",children:[t.jsx("div",{className:"fu-offering-head",children:t.jsx("span",{children:f?`${f} Vehicle Offer${f>1?"s":""}`:"Offer Details"})}),p.vehicles.length?p.vehicles.map(F=>t.jsxs("div",{className:"fu-offering-vehicle",children:[t.jsx("div",{className:"fu-offering-vehicle-title",children:F.label}),t.jsx("div",{className:"fu-offering-vehicle-model",children:F.title}),t.jsxs("div",{className:"fu-offering-metrics",children:[t.jsxs("span",{children:[t.jsx("b",{children:"Price"}),": ",F.priceText]}),F.showFinance?t.jsxs("span",{children:[t.jsx("b",{children:"DP"}),": ",F.dpText]}):null]}),F.showFinance&&F.emiText?t.jsx("div",{className:"fu-offering-emi",children:F.emiText}):null,F.fittings.length?t.jsxs("div",{className:"fu-offering-fit",children:[t.jsx("b",{children:"Fittings"}),": ",F.fittings.join(", ")]}):null]},F.label)):t.jsx("div",{className:"fu-offering-empty",children:"No vehicle-wise offer added."})]});return t.jsx(In,{content:A,trigger:["hover","click"],placement:"topLeft",overlayClassName:"fu-offering-popover",children:t.jsx("div",{className:"fu-offering-list",children:f?p.vehicles.map(F=>t.jsxs("div",{className:"fu-offering-list-item",children:[t.jsxs("span",{className:"fu-offering-list-label",children:[F.label,":"]})," ",F.title]},F.label)):t.jsx("div",{style:ft,children:"No offering details"})})})}},{title:"Status + Actions",key:"statusActions",width:160,render:(a,l)=>On(l)},{title:"Follow-up Notes",key:"followUpNotes",width:190,render:(a,l)=>{const p=String(l.followUpNotes||"").trim();return p?t.jsx(Nt,{title:p,children:t.jsx("div",{style:Je,children:p})}):t.jsx("div",{style:Je})}}];return t.jsx($l,{children:t.jsxs("div",{className:`fu-bg ${Ge?"fu-mode-quotation":""}`,children:[t.jsx("style",{children:`
          .fu-bg {
            background:
              radial-gradient(1200px 600px at 10% 0%, rgba(99, 102, 241, 0.14), transparent 55%),
              radial-gradient(1000px 520px at 90% 5%, rgba(34, 197, 94, 0.12), transparent 55%),
              radial-gradient(900px 480px at 50% 100%, rgba(250, 140, 22, 0.10), transparent 60%),
              linear-gradient(180deg, rgba(248,250,252,0.95), rgba(255,255,255,0.86));
            border-radius: 18px;
            padding: 14px;
          }
          .fu-mode-quotation {
            background:
              radial-gradient(1200px 620px at 2% 0%, rgba(29, 78, 216, 0.18), transparent 58%),
              radial-gradient(980px 540px at 96% 0%, rgba(14, 165, 233, 0.12), transparent 56%),
              radial-gradient(820px 420px at 50% 100%, rgba(34, 197, 94, 0.10), transparent 62%),
              linear-gradient(180deg, rgba(248, 250, 252, 0.96), rgba(255, 255, 255, 0.88));
          }
          .fu-mode-quotation .fu-card-quotation {
            border: 1px solid #dbeafe;
            box-shadow: 0 14px 36px rgba(30, 64, 175, 0.12);
          }
          .fu-head-grid {
            display: flex;
            gap: 14px;
            flex-wrap: wrap;
            align-items: flex-start;
            justify-content: space-between;
          }
          .fu-head-controls-wrap {
            border: 1px solid #dbeafe;
            border-radius: 14px;
            background: linear-gradient(180deg, rgba(255,255,255,0.94), rgba(248,250,252,0.92));
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
            padding: 10px;
          }
          .fu-mode-quotation .compact-table-quotation .ant-table-thead > tr > th {
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.35px;
            color: #0f172a;
          }
          .fu-mode-quotation .compact-table-quotation .ant-table-tbody > tr:nth-child(even) > td {
            background: rgba(248, 250, 252, 0.78);
          }
          .fu-mode-quotation .compact-table-quotation .ant-table-tbody > tr > td {
            padding-top: 10px;
            padding-bottom: 10px;
          }
          .fu-mode-quotation .compact-table-quotation .ant-table-tbody > tr:hover > td {
            background: rgba(30, 64, 175, 0.08) !important;
          }
          .row-pending td { background: rgba(250, 140, 22, 0.09) !important; }
          .compact-table { border-radius: 16px; overflow: hidden; }
          .compact-table .ant-table { border-radius: 16px; }
          .compact-table .ant-table-thead > tr > th {
            background: rgba(255,255,255,0.92);
            backdrop-filter: blur(8px);
            position: sticky;
            top: 0;
            z-index: 2;
            font-weight: 700;
            color: #0f172a;
            border-bottom: 1px solid #eef2f7;
          }
          .compact-table .ant-table-tbody > tr:hover > td {
            background: rgba(99, 102, 241, 0.06) !important;
          }
          .compact-table .ant-pagination {
            padding: 10px 12px;
            margin: 0;
            background: rgba(255,255,255,0.88);
            border-top: 1px solid #eef2f7;
          }
          .fu-pill-input .ant-input-affix-wrapper {
            border-radius: 999px !important;
            box-shadow: 0 6px 16px rgba(15, 23, 42, 0.06);
          }
          .fu-seg .ant-segmented {
            border-radius: 999px;
            padding: 4px;
            background: rgba(255,255,255,0.86);
            box-shadow: 0 6px 16px rgba(15, 23, 42, 0.05);
          }
          .fu-seg .ant-segmented-item {
            border-radius: 999px !important;
            font-weight: 600;
          }
          .fu-offering-popover .ant-popover-inner {
            border-radius: 14px;
            border: 1px solid #dbeafe;
            box-shadow: 0 18px 40px rgba(15, 23, 42, 0.2);
            padding: 10px;
            min-width: 360px;
            max-width: 520px;
            background: linear-gradient(180deg, #f8fbff 0%, #ffffff 100%);
          }
          .fu-offering-pop { display: flex; flex-direction: column; gap: 8px; }
          .fu-offering-head {
            font-size: 13px;
            font-weight: 800;
            color: #1d4ed8;
            letter-spacing: 0.2px;
          }
          .fu-offering-remarks {
            border-left: 3px solid #93c5fd;
            padding-left: 8px;
            color: #0f172a;
            font-size: 12px;
            line-height: 1.35;
          }
          .fu-offering-vehicle {
            border: 1px solid #dbeafe;
            border-radius: 10px;
            padding: 8px;
            background: #f8fbff;
          }
          .fu-offering-vehicle-title {
            font-size: 11px;
            font-weight: 800;
            color: #1e3a8a;
            text-transform: uppercase;
            margin-bottom: 4px;
          }
          .fu-offering-vehicle-model {
            font-size: 12px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 4px;
          }
          .fu-offering-metrics {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            font-size: 12px;
            color: #1f2937;
          }
          .fu-offering-emi {
            margin-top: 4px;
            font-size: 11px;
            color: #334155;
            line-height: 1.3;
          }
          .fu-offering-fit {
            margin-top: 4px;
            font-size: 11px;
            color: #334155;
            line-height: 1.3;
          }
          .fu-offering-empty {
            font-size: 12px;
            color: #64748b;
          }
          .fu-offering-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
          }
          .fu-offering-list-item {
            font-size: 10.5px;
            line-height: 1.3;
            color: #1f2937;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 1;
            overflow: hidden;
            white-space: normal;
          }
          .fu-offering-list-label {
            font-weight: 800;
            color: #1d4ed8;
          }
          @media (max-width: 640px) {
            .fu-head-grid {
              flex-direction: column;
            }
            .fu-head-controls-wrap {
              padding: 8px;
            }
            .fu-offering-popover .ant-popover-inner {
              min-width: 280px;
              max-width: calc(100vw - 24px);
            }
          }
        `}),t.jsx(qt,{className:Ge?"fu-card-quotation":"",style:El,bodyStyle:{padding:i?12:16},children:t.jsxs("div",{className:"fu-head-grid",style:{alignItems:i?"stretch":"flex-start",flexDirection:i?"column":"row"},children:[t.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center",minWidth:i?"100%":260,width:i?"100%":void 0},children:[t.jsx(ca,{size:i?36:44,style:{background:"#111827"},children:(String(M?.name||"S").trim()[0]||"S").toUpperCase()}),t.jsxs("div",{children:[t.jsx(Rl,{level:i?5:4,style:{margin:0,lineHeight:1.15},children:_e?"Job Card Follow-Ups":$e?"Booking Follow-Ups":"Quotation Follow-Ups"}),t.jsxs("div",{style:{marginTop:6,display:"flex",gap:10,alignItems:"center",flexWrap:"wrap"},children:[t.jsx(tt,{icon:t.jsx(yl,{}),style:{borderRadius:999,marginRight:0},children:M?.branch||U?.[0]||""}),t.jsxs(Ir,{type:"secondary",style:{fontSize:12},children:[t.jsx(al,{})," ","Last refresh: ",t.jsx("b",{children:g?g.format("DD-MM-YYYY HH:mm"):""})]})]})]})]}),t.jsxs("div",{style:{display:"flex",gap:10,alignItems:"stretch",flexWrap:"wrap",width:i?"100%":void 0},children:[t.jsxs(qt,{size:"small",style:ro,bodyStyle:{padding:Qt,minWidth:Tt},children:[t.jsx("div",{style:un,children:Ye.total}),t.jsxs("div",{style:jt,children:[t.jsx(Tr,{})," Total"]})]}),t.jsxs(qt,{size:"small",style:ro,bodyStyle:{padding:Qt,minWidth:Tt},children:[t.jsx("div",{style:{...un,color:"#fa8c16"},children:Ye.pending}),t.jsxs("div",{style:jt,children:[t.jsx(ps,{})," Pending"]})]}),_e?t.jsxs(qt,{size:"small",style:ro,bodyStyle:{padding:Qt,minWidth:Tt},children:[t.jsx("div",{style:{...un,color:"#52c41a"},children:Ye.completed}),t.jsxs("div",{style:jt,children:[t.jsx(Ar,{})," Completed"]})]}):null,t.jsxs(qt,{size:"small",style:ro,bodyStyle:{padding:Qt,minWidth:Ao},children:[t.jsx(Ir,{type:"secondary",style:{fontSize:i?10:11},children:"Completion"}),t.jsx(ua,{percent:Ye.total?Math.round(Ye.completed/Ye.total*100):0,size:"small",status:"active",showInfo:!0})]})]}),t.jsx("div",{style:{flex:1,minWidth:i?"100%":320},children:t.jsx("div",{style:{display:"flex",justifyContent:i?"flex-start":"flex-end"},children:t.jsx("div",{className:Ge?"fu-head-controls-wrap":"",style:{width:"100%"},children:t.jsxs(Gt,{wrap:!i,direction:i?"vertical":"horizontal",style:{width:"100%"},children:[_e?t.jsx(rt,{value:x,onChange:j,style:{minWidth:i?"100%":180,width:Zt},options:[{value:"all",label:"All statuses"},{value:"pending",label:"Pending"},{value:"completed",label:"Completed"}]}):$e?null:t.jsxs("div",{className:"fu-seg",style:{display:"flex",alignItems:"center",gap:8,width:Zt,flexWrap:"wrap"},children:[t.jsx(cl,{style:{color:"#64748b"}}),t.jsx(Da,{value:$,onChange:E,block:i,size:i?"small":"middle",options:Ge?[{label:"All",value:"all"},{label:"Due Today",value:"today"}]:[{label:"All",value:"all"},{label:"Due Today",value:"today"}]})]}),t.jsx(br.RangePicker,{value:de,onChange:a=>pe(a),allowClear:!0,size:i?"small":"middle",style:{width:Zt}}),t.jsx("div",{className:"fu-pill-input",style:{width:Zt},children:t.jsx(yt,{allowClear:!0,prefix:t.jsx(gl,{}),placeholder:"Search name / mobile / model / notes",value:me,onChange:a=>Ce(a.target.value),size:i?"small":"middle",style:{width:i?"100%":280}})}),ce&&t.jsx(rt,{value:h,onChange:a=>T(a),options:Bt,placeholder:"Filter branch",style:{minWidth:i?"100%":150,width:Zt}}),Ge?t.jsx(Ee,{onClick:()=>{E("all"),pe(null),Ce(""),ce&&T("all")},style:i?{...oo,width:"100%"}:oo,children:"Reset"}):null,t.jsx(Ee,{onClick:St,loading:m,icon:t.jsx(ys,{}),type:"primary",style:i?{...oo,width:"100%"}:oo,children:"Refresh"})]})})})})]})}),t.jsx("div",{style:{height:12}}),t.jsx(qt,{style:Tl,bodyStyle:{padding:0},children:t.jsx(xs,{rowKey:a=>String(a.key),dataSource:ot,columns:J,loading:m&&!B,size:"small",sticky:!i,tableLayout:i?"auto":"fixed",className:`compact-table ${Ge?"compact-table-quotation":""}`,rowClassName:a=>Dt(a)?"row-pending":"",onRow:a=>({onClick:l=>{$e&&(cn(l)||Co(a))},style:$e?{cursor:"pointer"}:void 0}),locale:{emptyText:t.jsxs("div",{style:{padding:26,textAlign:"center"},children:[t.jsx("div",{style:{fontSize:18,marginBottom:6},children:"No follow-ups found"}),t.jsx("div",{style:{color:"#64748b"},children:"Try changing filters, date range, or search."})]})},pagination:{current:we,pageSize:he,total:ot.length,showSizeChanger:!i,simple:i,size:i?"small":"default",pageSizeOptions:["10","20","50","100","200"],onChange:(a,l)=>{fe(a),oe(l)}}})}),t.jsx(xn,{title:`Reschedule ${re.serial||""}`,open:re.open,onCancel:()=>ee({open:!1,serial:null,at:null,notes:""}),onOk:()=>{const a=re.serial,l=Yt(re.notes),p={followUp:{at:re.at?.toISOString?.()||null,notes:l},status:"pending"},f=Nn(a,p);ee({open:!1,serial:null,at:null,notes:""}),(async()=>{if(!await An(a,p,{refreshOnSuccess:!1,showSuccessMessage:!1,showErrorMessage:!0})){Vn(a,f),await St();return}St()})()},children:t.jsxs(Gt,{direction:"vertical",style:{width:"100%"},children:[t.jsx(br,{showTime:!0,style:{width:"100%"},value:re.at,onChange:a=>ee(l=>({...l,at:a}))}),t.jsx(yt.TextArea,{rows:2,placeholder:"Notes",value:re.notes,onChange:a=>ee(l=>({...l,notes:a.target.value}))})]})}),t.jsx(xn,{title:`Mark Done  ${I.serial||""}`,open:I.open,onCancel:()=>k({open:!1,serial:null,status:"converted",details:"",boughtFrom:"",offer:""}),onOk:()=>{const a=I.serial,l=Yt(I.details),p={status:I.status||"converted",closeReason:I.status||"converted",closeNotes:I.details||"",closedAt:new Date().toISOString(),followUp:{notes:l}};I.status==="purchased_elsewhere"&&(p.purchasedElsewhere={boughtFrom:I.boughtFrom||"",offer:I.offer||""});const f=Nn(a,p);k({open:!1,serial:null,status:"converted",details:"",boughtFrom:"",offer:""}),(async()=>{if(!await An(a,p,{refreshOnSuccess:!1,showSuccessMessage:!1,showErrorMessage:!0})){Vn(a,f),await St();return}St()})()},children:t.jsxs(Gt,{direction:"vertical",style:{width:"100%"},children:[t.jsx(rt,{style:{width:"100%"},value:I.status,onChange:a=>k(l=>({...l,status:a})),options:[{value:"converted",label:"Booked"},{value:"not_interested",label:"Not Interested"},{value:"unreachable",label:"Unreachable"},{value:"purchased_elsewhere",label:"Purchased SomeWhereElse"}]}),t.jsx(yt.TextArea,{rows:2,placeholder:"Notes",value:I.details,onChange:a=>k(l=>({...l,details:a.target.value}))})]})}),$e&&t.jsx(Al,{open:L.open,onClose:()=>ne({open:!1,row:null}),row:L.row,webhookUrl:n,secret:Pt}),_e&&t.jsx(La,{ref:le,active:K,vals:te?.vals||{},totals:te?.totals||{}}),Te&&t.jsx("div",{style:{position:"fixed",inset:0,zIndex:1900,background:"rgba(255,255,255,0.9)",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"all"},children:t.jsxs("div",{style:{textAlign:"center",color:"#111"},children:[t.jsx(po,{tip:"Preparing booking form...",size:"large"}),t.jsx("div",{style:{marginTop:12,fontWeight:600},children:"Redirecting to booking form..."})]})})]})})}const Wl=e=>String(e||"").replace(/\D/g,"").slice(-10),Hl=e=>String(e||"").toUpperCase().replace(/\s+/g,"");function ql({form:e,webhookUrl:n,bookingId:o,mobile:r}){const i=!ir.useBreakpoint().md,[m,u]=d.useState(!1),g=d.useMemo(()=>{if(!m)return"";const y=Hl(o);return y||Wl(r||e?.getFieldValue?.("mobileNumber")||"")||""},[m,o,r,e]);return t.jsxs(t.Fragment,{children:[t.jsx(Ee,{icon:t.jsx(ul,{}),onClick:()=>u(!0),children:"Booking History"}),t.jsx(xn,{open:m,title:"",footer:null,onCancel:()=>u(!1),destroyOnClose:!0,width:i?"100%":"92vw",bodyStyle:{padding:0},children:m?t.jsx(Ul,{mode:"booking",webhookUrl:n,prefillQuery:g}):null})]})}const{Title:Gl,Text:Ur}=ra,{Dragger:Kl}=Bn,{useBreakpoint:Xl}=ir,{Option:Ht}=rt,bn=e=>String(e||"").trim().toUpperCase(),Jl=!1,Yl=["IDFC","L&T FINANCE LIMITED","JANA SMALL FINANCE BANK","SHRIRAM FINANCE","TVS CREDIT","INDUSIND BANK","AXIS BANK","HINDHUJA FINANCE","BAJAJ FINANCE","OTHER"],Wo=e=>Number(String(e??0).replace(/[,\s]/g,""))||0,Zl=(e,n)=>{const o=b=>{try{return typeof e=="function"?e(b):e?.[b]}catch{return}};let r=Wo(o(`bookingAmount${n}Cash`)),c=Wo(o(`bookingAmount${n}Online`));const i=Wo(o(`bookingAmount${n}`)),m=String(o(`paymentMode${n}`)||"").toLowerCase(),u=o(`paymentReference${n}`)||o(`paymentRef${n}`)||o(`utr${n}`)||o("utr");!r&&!c&&i&&(m==="online"?c=i:r=i);const g=r+c;return{part:n,cash:r,online:c,total:g,mode:r&&c?"cash+online":c?"online":r?"cash":"",reference:c>0&&u||void 0}},ao=e=>[1,2,3].map(n=>Zl(e,n)),Ql=[{required:!0,message:"Mobile number is required"},{pattern:/^[6-9]\d{9}$/,message:"Enter a valid 10-digit Indian mobile number"}],ec=e=>String(e||"").toUpperCase().replace(/[^A-Z\s]/g,"").replace(/\s+/g," ").trimStart(),tc={validator:async(e,n)=>{const o=String(n||"").trim();if(!o)return Promise.resolve();if(o.startsWith("="))throw new Error("Name cannot start with =");if(/[^A-Z\s]/.test(o))throw new Error("Name can contain only letters and spaces")}},nc="https://docs.google.com/spreadsheets/d/e/2PACX-1vQYGuNPY_2ivfS7MTX4bWiu1DWdF2mrHSCnmTznZVEHxNmsrgcGWjVZN4UDUTOzQQdXTnbeM-ylCJbB/pub?gid=408799621&single=true&output=csv",so="https://script.google.com/macros/s/AKfycbwSn5hp1cSWlJMGhe2cYUtid2Ruqh9H13mZbq0PwBpYB0lMLufZbIjZ5zioqtKgE_0sNA/exec",oc=e=>{const n=[];let o=[],r="",c=!1;for(let i=0;i<e.length;i++){const m=e[i],u=e[i+1];if(m==='"'&&!c){c=!0;continue}if(m==='"'&&c){if(u==='"'){r+='"',i++;continue}c=!1;continue}if(m===","&&!c){o.push(r),r="";continue}if((m===`
`||m==="\r")&&!c){(r!==""||o.length)&&(o.push(r),n.push(o),o=[],r=""),m==="\r"&&u===`
`&&i++;continue}r+=m}return(r!==""||o.length)&&(o.push(r),n.push(o)),n},En={company:["Company","Company Name"],model:["Model","Model Name"],variant:["Variant"],price:["On-Road Price","On Road Price","OnRoadPrice","Price"],color:["Color","Colours","Colors","Colour","Available Colors"]},Tn=(e,n)=>String(n.map(o=>e[o]??"").find(o=>o!=="")||"").trim(),rc=(e={})=>({company:Tn(e,En.company),model:Tn(e,En.model),variant:Tn(e,En.variant),color:Tn(e,En.color),onRoadPrice:Number(String(Tn(e,En.price)||"0").replace(/[,\s]/g,""))||0}),Wr=(e={})=>({company:String(e["Company Name"]||e.company||"").trim(),model:String(e["Model Name"]||e.model||"").trim(),variant:String(e.Variant||e.variant||"").trim(),color:String(e.Color||e.Colours||e.Colors||e.Colour||e["Available Colors"]||e.color||"").trim(),onRoadPrice:Number(String(e["On-Road Price"]||e.onRoadPrice||"0").replace(/[,\s]/g,""))||0});function ac({asModal:e=!1,initialValues:n=null,onSuccess:o,autoUpdateStockOnSave:r=!0,startPaymentsOnly:c=!1,editRefDefault:i=null,allowBranchSelect:m=!1,allowExecutiveSelect:u=!1,branchOptions:g=[],executiveOptions:y=[],branchOptionsLoading:b=!1,executiveOptionsLoading:w=!1}={}){const B=d.useRef(null),S=Xl(),$=!S.md,E=S.md&&!S.lg,C=$?"middle":"large",[h]=G.useForm(),[T,N]=d.useState([]),[x,j]=d.useState([]),[M,R]=d.useState(!!c),[W,ae]=d.useState(()=>i||{bookingId:null,mobile:null}),[U,xe]=d.useState(!1),[re,ee]=d.useState([]),[I,k]=d.useState([]),[L,ne]=d.useState(!1),[le,K]=d.useState(!1),[Y,te]=d.useState(null),se=Ta(),z=se.state?.autoFetch,[ie,me]=d.useState(!!z),Ce=d.useRef(!1),de=d.useMemo(()=>{try{return JSON.parse(localStorage.getItem("user")||"null")}catch{return null}},[]),pe=d.useMemo(()=>{const s=de?.formDefaults?.staffName||de?.name||de?.displayName||de?.email||"";return bn(s)},[de]),we=d.useMemo(()=>{const s=Array.isArray(de?.branches)?de.branches[0]?.name||de.branches[0]:void 0,O=de?.formDefaults?.branchName||de?.primaryBranch?.name||s||"";return bn(O)},[de]),[fe,he]=d.useState(""),[oe,Te]=d.useState(""),Me=G.useWatch("variant",h),qe=G.useWatch("color",h),ce=G.useWatch("purchaseType",h),Ne=G.useWatch("addressProofMode",h),vt=G.useWatch("paymentMode",h),xt=G.useWatch("bookingAmount1Cash",h),wt=G.useWatch("bookingAmount2Cash",h),It=G.useWatch("bookingAmount3Cash",h),Bt=G.useWatch("bookingAmount1Online",h),Pt=G.useWatch("bookingAmount2Online",h),pt=G.useWatch("bookingAmount3Online",h),_e=G.useWatch("bookingAmount1",h),$e=G.useWatch("bookingAmount2",h),Ge=G.useWatch("bookingAmount3",h),Ot=G.useWatch("paymentMode1",h),Dt=G.useWatch("paymentMode2",h),Lt=G.useWatch("paymentMode3",h),$t=G.useWatch("paymentReference1",h),_t=G.useWatch("paymentReference2",h),rn=G.useWatch("paymentReference3",h),Jt=G.useWatch("chassisNo",h),zt=d.useCallback(({bookingId:s,mobile:O,vehicle:P})=>{R(!0),ae({bookingId:s||null,mobile:O||null}),xe(!0);const _=String(P?.availability||"").toLowerCase(),J=P?.chassisNo||h.getFieldValue("chassisNo"),a=_==="allot"||String(J||"")==="__ALLOT__",l=!!(J&&String(J)!=="__ALLOT__");K(!!(l&&!a)),je.info("Payments-only update mode enabled")},[h]),ue=G.useWatch("customerName",h),X=G.useWatch("mobileNumber",h),ke=G.useWatch("address",h),ge=G.useWatch("executive",h),Pe=G.useWatch("branch",h),Fe=G.useWatch("rtoOffice",h),st=G.useWatch("financier",h),nt=G.useWatch("nohpFinancier",h),Ie=d.useMemo(()=>{const s=[...g,...re],O=new Set,P=_=>{if(!_)return;const J=bn(typeof _=="string"?_:_?.name||_?.label||_?.value);J&&O.add(J)};return we&&P(we),(s||[]).forEach(P),Array.from(O).map(_=>({label:_,value:_}))},[g,re,we]),an=d.useMemo(()=>{const s=[...y,...I],O=new Set,P=_=>{if(!_)return;const J=bn(typeof _=="string"?_:_?.name||_?.label||_?.value);J&&O.add(J)};return pe&&P(pe),(s||[]).forEach(P),Array.from(O).map(_=>({label:_,value:_}))},[y,I,pe]),wn=m&&Ie.length>0,Rt=u&&an.length>0,it=d.useMemo(()=>ao({bookingAmount1Cash:xt,bookingAmount2Cash:wt,bookingAmount3Cash:It,bookingAmount1Online:Bt,bookingAmount2Online:Pt,bookingAmount3Online:pt,bookingAmount1:_e,bookingAmount2:$e,bookingAmount3:Ge,paymentMode1:Ot,paymentMode2:Dt,paymentMode3:Lt}).reduce((O,P)=>O+P.total,0),[xt,wt,It,Bt,Pt,pt,_e,$e,Ge,Ot,Dt,Lt]),Ln=G.useWatch("downPayment",h),sn=G.useWatch("extraFittingAmount",h),Vt=G.useWatch("discountAmount",h),ln=G.useWatch("affidavitCharges",h),Sn=d.useMemo(()=>{const s=P=>String(P||"").trim().toLowerCase(),O=x.find(P=>s(P.company)===s(fe)&&s(P.model)===s(oe)&&s(P.variant)===s(Me));return Number(O?.onRoadPrice||0)||0},[x,fe,oe,Me]),[xo,wo]=d.useState(!1),[So,_n]=d.useState(null);d.useEffect(()=>{wo(!1),_n(null)},[Sn]);const Et=Number(So??Sn??0)||0,jn=d.useMemo(()=>{const s=Number(Ln||0)||0,O=Number(sn||0)||0,P=Number(Vt||0)||0,_=Ne==="additional"&&Number(ln||0)||0;return s+O+_-P},[Ln,sn,Vt,ln,Ne]),jo=d.useMemo(()=>{const s=Number(it||0)||0;return jn-s},[jn,it]),cn=d.useMemo(()=>{const s=Number(sn||0)||0,O=Number(Vt||0)||0,P=Ne==="additional"&&Number(ln||0)||0;return(Number(Et)||0)+s+P-O},[Et,sn,Vt,ln,Ne]),zn=d.useMemo(()=>{const s=Number(it||0)||0;return cn-s},[cn,it]),[Co,Cn]=d.useState(!1),[dn,St]=d.useState(!1),[An,Nn]=d.useState(0),Vn=(s=6e3)=>{const O=Date.now()+s;Nn(O),setTimeout(()=>Nn(0),s+50)},Yt=d.useMemo(()=>!!(U||W?.bookingId||W?.mobile),[U,W]),Ut=async()=>{if(!Yt){je.warning("Save the booking, fetch it, then print.");return}St(!0);try{await new Promise(s=>setTimeout(s,0)),await sr(B.current)}catch{}finally{St(!1)}},ze="Booking:draft:v1",Ue=(s,O)=>{try{localStorage.setItem(s,JSON.stringify(O))}catch{}};d.useEffect(()=>{{try{localStorage.removeItem(ze)}catch{}h.resetFields();return}},[]);const Be=async s=>await nn({webhookUrl:so,method:"POST",payload:s}),[Je,ft]=d.useState("idle"),[ot,Ye]=d.useState(null),Zt=d.useMemo(()=>{const s=h.getFieldsValue(!0),O=ao(J=>s[J]),P=[];return O.forEach(J=>{J.cash>0&&P.push({part:J.part,amount:J.cash,mode:"cash"}),J.online>0&&P.push({part:J.part,amount:J.online,mode:"online",reference:J.reference})}),{customerName:s.customerName,mobileNumber:s.mobileNumber,address:s.address,branch:s.branch||we||"",executive:s.executive||pe||"",rtoOffice:s.rtoOffice,purchaseMode:s.purchaseType,bookingAmount:it,payments:P,paymentSplit:O,addressProofMode:s.addressProofMode,addressProofTypes:s.addressProofTypes||[],fileName:T&&T[0]?.name||void 0,vehicle:{company:s.company,model:s.bikeModel,variant:s.variant,color:s.color,chassisNo:s.chassisNo==="__ALLOT__"?void 0:s.chassisNo,availability:s.chassisNo==="__ALLOT__"?"allot":Je},financier:s.financier||s.nohpFinancier,createdAt:new Date}},[h,we,pe,Je,ce,vt,Ne,fe,oe,Me,qe,Jt,xt,wt,It,Bt,Pt,pt,$t,_t,rn,ue,X,ke,ge,Pe,Fe,st,nt,T,it]),[Qt,Tt]=d.useState([]),[Ao,un]=d.useState(!1);d.useEffect(()=>{let s=!1;return(async()=>{try{const P=await vr({status:"active",limit:500});if(s)return;if(P?.success){const _=(P.data?.items||[]).map(J=>String(J?.name||"").trim().toLowerCase()).filter(Boolean);te(new Set(_))}else te(new Set)}catch{s||te(new Set)}})(),()=>{s=!0}},[]);const jt=d.useCallback(s=>{if(!Y||Y.size===0)return!0;const O=String(s?.branch||s?.sourceBranch||"").trim().toLowerCase();return O?Y.has(O):!1},[Y]),Un=async s=>{const O=String(s||"").trim().toUpperCase();if(O==="__ALLOT__"){ft("allot"),Ye(null);return}if(!O||O.length<6){ft("idle"),Ye(null);return}ft("checking"),Ye(null);try{const P=await Fr({limit:1500}),J=(Array.isArray(P?.data)?P.data:[]).find(a=>String(a.chassisNo||a.chassis||"").toUpperCase()===O);if(J&&!jt(J)){ft("not_found"),Ye(null);return}J?(ft("found"),Ye({chassis:J.chassisNo||J.chassis||O,company:J.company||"",model:J.model||"",variant:J.variant||"",branch:J.branch||J.sourceBranch||"",color:J.color||""})):(ft("not_found"),Ye(null))}catch{ft("idle"),Ye(null),je.error("Could not verify chassis availability.")}};d.useEffect(()=>{const s=setTimeout(()=>{Un(Jt)},600);return()=>clearTimeout(s)},[Jt,Y]),d.useEffect(()=>{if(Ne!=="additional"){const s=h.getFieldValue("affidavitCharges");(Number(s)||0)!==0&&h.setFieldsValue({affidavitCharges:0})}},[Ne,h]),d.useEffect(()=>{try{if(M||Ne!=="additional")return;const s=String(fe||h.getFieldValue("company")||"").trim();if(!s)return;const P=/bajaj/i.test(s)?350:250,_=Number(h.getFieldValue("affidavitCharges"))||0;(_===0||_===250||_===350)&&_!==P&&h.setFieldsValue({affidavitCharges:P})}catch{}},[Ne,fe,M,h]),d.useEffect(()=>{const s=m&&!g.length,O=u&&!y.length;if(!s&&!O)return;let P=!1;return(async()=>{ne(!0);try{const J=await Promise.allSettled([s?vr({status:"active",limit:500}):Promise.resolve(null),O?Ia({role:"staff",status:"active",limit:1e5}):Promise.resolve(null)]);if(!P){const[a,l]=J;if(s&&a.status==="fulfilled"&&a.value?.success){const p=(a.value.data?.items||[]).filter(f=>String(f?.status||"").toLowerCase()==="active");ee(p.map(f=>f.name).filter(Boolean))}O&&l.status==="fulfilled"&&l.value?.success&&k((l.value.data?.items||[]).filter(p=>String(p.role||"").toLowerCase()==="staff").map(p=>p.name||p.email||"").filter(Boolean))}}catch{P||je.error("Could not load dropdown options")}finally{P||ne(!1)}})(),()=>{P=!0}},[m,u,g.length,y.length]),d.useEffect(()=>{const s={};ao(P=>h.getFieldValue(P)).forEach(P=>{const _=`paymentReference${P.part}`;P.online<=0&&h.getFieldValue(_)&&(s[_]=void 0)}),Object.keys(s).length&&h.setFieldsValue(s)},[Bt,Pt,pt,_e,$e,Ge,Ot,Dt,Lt,h]),d.useEffect(()=>{if(n&&typeof n=="object")try{const s={...n};s.model&&!s.bikeModel&&(s.bikeModel=s.model),s.chassis&&!s.chassisNo&&(s.chassisNo=s.chassis),h.setFieldsValue(s),s.company&&he(s.company),s.bikeModel&&Te(s.bikeModel)}catch{}},[n]),d.useEffect(()=>{const s=h.getFieldsValue(["executive","branch"]),O={};!s.executive&&pe&&(O.executive=pe),!s.branch&&we&&(O.branch=we),Object.keys(O).length&&h.setFieldsValue(O)},[h,pe,we]),d.useEffect(()=>{if(!z)return;const s=()=>me(!1);return window.addEventListener("bookingPrefillComplete",s),()=>window.removeEventListener("bookingPrefillComplete",s)},[z]),d.useEffect(()=>{z&&(Ce.current=!1)},[z?.mode,z?.query]),d.useEffect(()=>{Ce.current=!1},[se.key]),d.useEffect(()=>{if(Ce.current)return;Ce.current=!0;const s=()=>{typeof window>"u"||window.dispatchEvent(new CustomEvent("bookingPrefillComplete"))},O=Ol();if(!O?.payload){s();return}try{const{patch:P,metadata:_}=ba(O.payload);h.setFieldsValue(P),P.company&&he?.(P.company),P.bikeModel&&Te?.(P.bikeModel),je.success("Booking details filled."),zt(_)}catch(P){console.warn("Follow-up auto-prefill failed",P)}finally{s()}},[h,zt,he,Te]),d.useEffect(()=>{let s=!1;return(async()=>{try{const P=await fetch(nc,{cache:"no-store"});if(!P.ok)throw new Error("sheet fetch failed");const _=await P.text();if(_.trim().startsWith("<"))throw new Error("expected CSV, got HTML");const J=oc(_);if(!J.length)throw new Error("empty sheet");const a=J[0].map(f=>(f||"").trim()),p=J.slice(1).map(f=>{const A={};return a.forEach((F,D)=>A[F]=f[D]??""),A}).map(rc).filter(f=>f.company&&f.model&&f.variant);s||j(p)}catch{try{const P=await fetch("/bikeData.json",{cache:"no-store"});if(!P.ok)throw new Error("fallback missing");const _=await P.json(),J=(Array.isArray(_)?_:[]).map(Wr).filter(a=>a.company&&a.model&&a.variant);s||j(J),Array.isArray(_)||je.warning("Loaded fallback bikeData.json")}catch{try{const P=["bajaj","honda","tvs","suzuki","yamaha","royalEnfield"],a=(await Promise.all(P.map(async l=>{try{const p=await fetch(`/${l}.json`,{cache:"no-store"});if(!p.ok)return[];const f=await p.json();return Array.isArray(f)?f:[]}catch{return[]}}))).flat().map(Wr).filter(l=>l.company&&l.model&&l.variant);if(s||j(a),!a.length)throw new Error("no data")}catch{je.error("Could not load vehicle data. Please try again later.")}}}})(),()=>{s=!0}},[]);const kn=d.useMemo(()=>Yn(x.map(s=>s.company)),[x]),Wn=d.useMemo(()=>{const s=ut(fe),O=s?x.filter(P=>ut(P.company)===s):x;return Yn(O.map(P=>P.model))},[x,fe]),No=d.useMemo(()=>{const s=ut(fe),O=ut(oe),P=x.filter(_=>!(s&&ut(_.company)!==s||O&&ut(_.model)!==O));return Yn(P.map(_=>_.variant))},[x,fe,oe]),mn=s=>s?String(s).split(/[|,/;\n]+/).map(O=>O.trim()).filter(Boolean):[],Pn=d.useMemo(()=>{const s=ut(fe),O=ut(oe),P=ut(Me);if(!s||!O||!P)return[];const J=x.filter(a=>ut(a.company)===s&&ut(a.model)===O&&ut(a.variant)===P).flatMap(a=>mn(a.color));return Yn(J)},[x,fe,oe,Me]);d.useEffect(()=>{let s=!1;return(async()=>{if(!fe||!oe||!Me){Tt([]);return}un(!0);try{const P=await Fr({limit:2e3}),J=(Array.isArray(P?.data)?P.data:[]).filter(a=>jt(a));s||Tt(J)}catch{s||Tt([])}finally{s||un(!1)}})(),()=>{s=!0}},[fe,oe,Me,jt]),d.useEffect(()=>{!Y||Y.size===0||Tt(s=>s.filter(O=>jt(O)))},[Y,jt]);const Hn=d.useMemo(()=>{const s=P=>String(P||"").trim().toLowerCase(),O=[];return Qt.forEach(P=>{if(jt(P)&&s(P.company)===s(fe)&&s(P.model)===s(oe)&&s(P.variant)===s(Me)&&(!qe||s(P.color)===s(qe))){const _=String(P.chassisNo||P.chassis||"").trim().toUpperCase();_&&!O.includes(_)&&O.push(_)}}),O},[Qt,fe,oe,Me,qe]),ko=s=>s.type==="application/pdf"||(s.name||"").toLowerCase().endsWith(".pdf")?s.size<=5*1024*1024?!1:(je.error("Each file must be 5MB or smaller."),Bn.LIST_IGNORE):(je.error("Only PDF files are allowed."),Bn.LIST_IGNORE),qn=async s=>{const O=new FormData;O.append("action","upload");const P=s?.originFileObj||s;O.append("file",P,s?.name||P?.name||"document.pdf");const _=await fetch(so,{method:"POST",body:O,credentials:"omit"});let J=null;try{J=await _.json()}catch{J=null}if(J&&(J.ok||J.success))return J;throw new Error("Upload failed")},Po=s=>new Promise((O,P)=>{try{const _=new FileReader,J=s?.originFileObj||s;_.onload=()=>{const a=String(_.result||""),l=a.indexOf(",");O(l>=0?a.slice(l+1):a)},_.onerror=P,_.readAsDataURL(J)}catch(_){P(_)}}),Gn=async(s,O={})=>{const{skipReset:P=!1,silent:_=!1,skipCooldown:J=!1,skipSubmittingState:a=!1,fromPrint:l=!1}=O;try{if(!J){if(Date.now()<An)return;Vn(6e3)}a||Cn(!0);let p;const f=(T||[])[0];if(f){p={name:f.name,mimeType:f.type||"application/pdf",size:f.size};try{const q=await qn(f);q&&(q.url||q.fileId)&&(p={...p,...q})}catch{try{if((f.size||0)<=3*1024*1024){const q=await Po(f);p.base64=q}}catch{}}}const A=s.addressProofMode==="additional"&&Number(s.affidavitCharges)||0,F=(Number(s.downPayment)||0)+(Number(s.extraFittingAmount)||0)+A-(Number(s.discountAmount)||0),D=ao(q=>s[q]),Z=D.reduce((q,v)=>q+v.total,0);if(Z<=0){je.error("Please enter at least one partial booking payment"),Cn(!1);return}const Q=F-Z,Ae=[];D.forEach(q=>{q.cash>0&&Ae.push({part:q.part,amount:q.cash,mode:"cash"}),q.online>0&&Ae.push({part:q.part,amount:q.online,mode:"online",reference:q.reference||void 0})});const be=D.map(q=>({amount:q.total||void 0,mode:q.mode?q.mode.toUpperCase():void 0,reference:q.reference})),Ve={customerName:s.customerName,mobileNumber:s.mobileNumber,vehicle:{company:s.company,model:s.bikeModel,variant:s.variant,color:s.color||void 0,chassisNo:s.chassisNo==="__ALLOT__"?void 0:s.chassisNo},rtoOffice:s.rtoOffice,purchaseMode:s.purchaseType,payments:Ae,paymentSplit:D,addressProofMode:s.addressProofMode,addressProofTypes:s.addressProofTypes||[],address:s.address||void 0,bookingAmount:Z||void 0,bookingAmount1:be[0]?.amount,bookingAmount2:be[1]?.amount,bookingAmount3:be[2]?.amount,paymentMode1:be[0]?.mode,paymentMode2:be[1]?.mode,paymentMode3:be[2]?.mode,paymentReference1:(D[0]?.online||0)>0&&D[0]?.reference||void 0,paymentReference2:(D[1]?.online||0)>0&&D[1]?.reference||void 0,paymentReference3:(D[2]?.online||0)>0&&D[2]?.reference||void 0,bookingAmount1Cash:s.bookingAmount1Cash??void 0,bookingAmount1Online:s.bookingAmount1Online??void 0,bookingAmount2Cash:s.bookingAmount2Cash??void 0,bookingAmount2Online:s.bookingAmount2Online??void 0,bookingAmount3Cash:s.bookingAmount3Cash??void 0,bookingAmount3Online:s.bookingAmount3Online??void 0,disbursementAmount:s.purchaseType==="loan"||s.purchaseType==="nohp"?s.disbursementAmount??void 0:void 0,emiAmount:s.purchaseType==="loan"||s.purchaseType==="nohp"?s.emiAmount??void 0:void 0,tenure:(s.purchaseType==="loan"||s.purchaseType==="nohp")&&Number(s.tenure)||void 0,dp:{downPayment:s.downPayment??void 0,extraFittingAmount:s.extraFittingAmount??0,discountAmount:s.discountAmount??0,affidavitCharges:s.addressProofMode==="additional"?s.affidavitCharges??0:0,totalDp:F,balancedDp:Q},cash:{onRoadPrice:Et,totalVehicleCost:ce==="cash"?(Number(Et)||0)+(Number(s.extraFittingAmount)||0)+-(Number(s.discountAmount)||0)+(s.addressProofMode==="additional"&&Number(s.affidavitCharges)||0):void 0,balancedAmount:ce==="cash"?(Number(Et)||0)+(Number(s.extraFittingAmount)||0)+-(Number(s.discountAmount)||0)+(s.addressProofMode==="additional"&&Number(s.affidavitCharges)||0)-Z:void 0},executive:s.executive||pe||void 0,branch:s.branch||we||void 0,file:p?{name:p.name,mimeType:p.mimeType,size:p.size}:void 0,chassis:{status:Je,info:ot},ts:new Date().toISOString(),v:1},Ze=Ae.filter(q=>String(q.mode).toLowerCase()==="cash").reduce((q,v)=>q+(Number(v.amount)||0),0),lt=Ae.filter(q=>String(q.mode).toLowerCase()==="online").reduce((q,v)=>q+(Number(v.amount)||0),0),Ct=Ze+lt,H={customerName:s.customerName,mobileNumber:s.mobileNumber,vehicle:{company:s.company,model:s.bikeModel,variant:s.variant,color:s.color||void 0,chassisNo:s.chassisNo==="__ALLOT__"?void 0:s.chassisNo,availability:s.chassisNo==="__ALLOT__"?"allot":Je,availabilityInfo:ot||void 0},onRoadPrice:Et,rtoOffice:s.rtoOffice,purchaseMode:s.purchaseType,disbursementAmount:s.purchaseType==="loan"||s.purchaseType==="nohp"?s.disbursementAmount??void 0:void 0,emiAmount:s.purchaseType==="loan"||s.purchaseType==="nohp"?s.emiAmount??void 0:void 0,tenure:(s.purchaseType==="loan"||s.purchaseType==="nohp")&&Number(s.tenure)||void 0,financier:s.financier||s.nohpFinancier||void 0,addressProofMode:s.addressProofMode,addressProofTypes:s.addressProofTypes||[],address:s.address||void 0,payments:Ae,paymentSplit:D,discountAmount:s.discountAmount??0,source:"booking",cashCollected:Ze,onlineCollected:lt,totalCollected:Ct,bookingAmount:Z||void 0,bookingAmount1:be[0]?.amount,bookingAmount2:be[1]?.amount,bookingAmount3:be[2]?.amount,paymentMode1:be[0]?.mode,paymentMode2:be[1]?.mode,paymentMode3:be[2]?.mode,paymentReference1:(D[0]?.online||0)>0&&D[0]?.reference||void 0,paymentReference2:(D[1]?.online||0)>0&&D[1]?.reference||void 0,paymentReference3:(D[2]?.online||0)>0&&D[2]?.reference||void 0,bookingAmount1Cash:s.bookingAmount1Cash??void 0,bookingAmount1Online:s.bookingAmount1Online??void 0,bookingAmount2Cash:s.bookingAmount2Cash??void 0,bookingAmount2Online:s.bookingAmount2Online??void 0,bookingAmount3Cash:s.bookingAmount3Cash??void 0,bookingAmount3Online:s.bookingAmount3Online??void 0,downPayment:s.downPayment??void 0,extraFittingAmount:s.extraFittingAmount??0,affidavitCharges:s.addressProofMode==="additional"?s.affidavitCharges??0:0,totalDp:F,balancedDp:Q,totalVehicleCost:s.purchaseType==="cash"?cn:void 0,balancedAmount:s.purchaseType==="cash"?zn:void 0,rawPayload:JSON.stringify(Ve),executive:s.executive||pe||void 0,branch:s.branch||we||void 0,...p?{file:p}:{},...W?.bookingId?{bookingId:W.bookingId}:{},...W?.mobile?{editMobile:W.mobile}:{},...M?{action:"update"}:{}};let Se=!1,V;try{V=await Be(H),Se=(V?.data||V)?.success!==!1}catch{Se=!1}if(!Se)throw new Error(String((V?.data||V)?.message||"Submission failed"));if(r&&!M){const q=String(s.chassisNo||"").trim().toUpperCase();if(q&&q!=="__ALLOT__"){const v={Chassis_No:q,Company:s.company||"",Model:s.bikeModel||"",Variant:s.variant||"",Color:s.color||"",Action:"invoice",Customer_Name:s.customerName||"",Source_Branch:s.branch||we||ot?.branch||"",Notes:(V?.data||V)?.bookingId?`Book via Booking ID ${(V?.data||V)?.bookingId}`:"Book via Booking form"},ct=de?.name||de?.email||s.executive||"user",Re=await xl({data:v,createdBy:ct});if(!(Re?.success??Re?.ok))throw new Error(Re?.message||"Booking saved, but failed to mark stock as booked.")}}if(_||je.success("Booking saved successfully"),!l&&typeof o=="function")try{o({response:V?.data||V,payload:H})}catch{}if(!P){h.resetFields(),Ue(ze,null),h.setFieldsValue({executive:pe||"",branch:we||""}),R(!1),ae({bookingId:null,mobile:null}),K(!1),N([]),he(""),Te(""),ft("idle"),Ye(null),Tt([]);try{window.dispatchEvent(new Event("reload-bookings"))}catch{}}}catch(p){if(je.error(String(p?.message||p||"Submission failed")),l)throw p}finally{a||Cn(!1)}},Oo=({errorFields:s})=>{s?.length&&h.scrollToField(s[0].name,{behavior:"smooth",block:"center"})},On=s=>typeof s=="string"?s.toUpperCase():s&&typeof s=="object"&&typeof s.target?.value=="string"?s.target.value.toUpperCase():s,Kn=t.jsx("div",{style:{height:$?40:44,width:$?40:44,borderRadius:12,display:"grid",placeItems:"center",color:"white",background:"linear-gradient(135deg, #2563eb 0%, #4f46e5 100%)",boxShadow:"0 8px 20px rgba(37, 99, 235, 0.35)",fontSize:$?20:22},children:""}),$n=t.jsxs(G,{layout:"vertical",form:h,onFinish:Gn,onFinishFailed:Oo,onValuesChange:(s,O)=>{try{if(!Jl)return;const P={...O};[1,2,3].forEach(_=>{(Number(P[`bookingAmount${_}Online`]||0)||0)<=0&&delete P[`paymentReference${_}`]}),Ue(ze,P)}catch{}},requiredMark:"optional",encType:"multipart/form-data",children:[t.jsxs(De,{gutter:[16,0],children:[t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"Executive",name:"executive",rules:[{required:!0,message:"Executive is required"}],getValueFromEvent:On,children:Rt?t.jsx(rt,{size:C,showSearch:!0,optionFilterProp:"label",placeholder:"Select executive",disabled:M,loading:w||L,options:an,allowClear:!pe,style:{textTransform:"uppercase"}}):t.jsx(yt,{size:C,placeholder:"Executive name",readOnly:!!pe,disabled:M,style:{textTransform:"uppercase"}})})}),t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"Branch",name:"branch",rules:[{required:!0,message:"Branch is required"}],getValueFromEvent:On,children:wn?t.jsx(rt,{size:C,showSearch:!0,optionFilterProp:"label",placeholder:"Select branch",disabled:M,loading:b||L,options:Ie,allowClear:!we,style:{textTransform:"uppercase"}}):t.jsx(yt,{size:C,placeholder:"Branch name",readOnly:!!we,disabled:M,style:{textTransform:"uppercase"}})})})]}),t.jsxs(De,{gutter:[16,0],children:[t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"Customer Name",name:"customerName",rules:[{required:!0,message:"Please enter customer name"},tc],getValueFromEvent:s=>{const O=s?.target?.value??s;return typeof O=="string"?ec(O):O},children:t.jsx(yt,{size:C,placeholder:"e.g., RAHUL SHARMA",allowClear:!0,style:{textTransform:"uppercase"},disabled:M})})}),t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"Mobile Number",name:"mobileNumber",rules:Ql,normalize:s=>s&&s.replace(/\D/g,"").slice(0,10),getValueFromEvent:s=>s?.target?.value?.toUpperCase?.(),children:t.jsx(yt,{size:C,placeholder:"10-digit number",maxLength:10,inputMode:"numeric",allowClear:!0,disabled:M,style:{textTransform:"uppercase"}})})})]}),t.jsxs(De,{gutter:[16,0],children:[t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Company",name:"company",rules:[{required:!0,message:"Select a company"}],children:t.jsx(rt,{size:C,placeholder:"Select Company",disabled:M,onChange:s=>{he(s),Te(""),h.setFieldsValue({bikeModel:void 0,variant:void 0,color:void 0,chassisNo:void 0}),h.setFieldsValue({company:String(s).toUpperCase()})},style:{textTransform:"uppercase"},dropdownRender:void 0,children:kn.map((s,O)=>t.jsx(Ht,{value:s,children:s},O))})})}),t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Bike Model",name:"bikeModel",rules:[{required:!0,message:"Select a model"}],children:t.jsx(rt,{size:C,placeholder:"Select Model",disabled:M||!fe,onChange:s=>{Te(s),h.setFieldsValue({variant:void 0,color:void 0,chassisNo:void 0}),h.setFieldsValue({bikeModel:String(s).toUpperCase()})},style:{textTransform:"uppercase"},dropdownRender:void 0,children:Wn.map((s,O)=>t.jsx(Ht,{value:s,children:s},O))})})}),t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Variant",name:"variant",rules:[{required:!0,message:"Select a variant"}],children:t.jsx(rt,{size:C,placeholder:"Select Variant",disabled:M||!oe,onChange:s=>{h.setFieldsValue({color:void 0,chassisNo:void 0}),h.setFieldsValue({variant:String(s).toUpperCase()})},style:{textTransform:"uppercase"},dropdownRender:void 0,children:No.map((s,O)=>t.jsx(Ht,{value:s,children:s},O))})})})]}),t.jsxs(De,{gutter:[16,0],children:[t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"Color",name:"color",rules:[{required:!0,message:"Select color"}],children:t.jsx(rt,{size:C,disabled:M||!Me||!Pn.length,placeholder:Me?Pn.length?"Select color":"No colors in vehicle catalog":"Select variant first",options:Pn.map(s=>({value:s,label:s})),onChange:s=>h.setFieldsValue({color:String(s||"").toUpperCase(),chassisNo:void 0}),style:{textTransform:"uppercase"},showSearch:!1,dropdownRender:void 0})})}),t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"On-Road Price ()",children:t.jsx("div",{style:{display:"flex",gap:8},children:t.jsx(We,{size:C,style:{width:"100%"},value:Et,disabled:!xo,min:0,onChange:s=>{const O=Number(s||0)||0;_n(O)}})})})})]}),t.jsxs(De,{gutter:[16,0],children:[t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"Chassis Number",name:"chassisNo",rules:[{required:!0,message:"Select chassis or choose Allot Vehicle"}],children:t.jsxs(rt,{size:C,placeholder:qe?"Select Chassis":"Select color first",disabled:le||!qe,loading:Ao,showSearch:!0,optionFilterProp:"children",onChange:s=>{K(!1),h.setFieldsValue({chassisNo:String(s).toUpperCase()}),Un(s)},allowClear:!0,style:{textTransform:"uppercase"},dropdownRender:void 0,children:[Hn.map(s=>t.jsx(Ht,{value:s,children:s},s)),t.jsx(Ht,{value:"__ALLOT__",children:"Allot Vehicle (assign later)"})]})})}),t.jsx(ye,{xs:24,md:12,style:{display:"flex",alignItems:"center"},children:t.jsxs("div",{children:[t.jsx("div",{style:{marginBottom:6},children:"Availability"}),Je==="found"&&t.jsxs(tt,{color:"green",children:["In Stock",ot?.branch?` @ ${ot.branch}`:""]}),Je==="allot"&&t.jsx(tt,{color:"blue",children:"To be allotted"}),Je==="not_found"&&t.jsx(tt,{color:"red",children:"Not Found"}),Je==="checking"&&t.jsx(tt,{children:"Checking"}),Je==="idle"&&t.jsx(tt,{children:"Select chassis to check"})]})})]}),t.jsx(De,{gutter:[16,0],children:t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"RTO (Office)",name:"rtoOffice",initialValue:"KA",rules:[{required:!0,message:"Enter RTO code (KA + 2 digits)"},{pattern:/^KA\d{2}$/,message:"Use format KA01, KA13, KA05"}],normalize:s=>{const O=String(s||"").toUpperCase().replace(/\s+/g,"");if(!O)return"KA";const P=O.startsWith("KA")?O.slice(2):O.replace(/[^0-9]/g,""),_=String(P||"").replace(/\D/g,"").slice(0,2);return _?`KA${_}`:"KA"},getValueFromEvent:s=>s?.target?.value?.toUpperCase?.(),children:t.jsx(yt,{size:C,placeholder:"e.g., KA02",maxLength:4,disabled:M,style:{textTransform:"uppercase"}})})})}),t.jsx(De,{gutter:[16,0],children:t.jsx(ye,{xs:24,md:18,children:t.jsx(G.Item,{label:"Purchase Mode",name:"purchaseType",initialValue:"cash",rules:[{required:!0,message:"Choose purchase mode"}],children:t.jsxs(bt.Group,{disabled:M,children:[t.jsx(bt.Button,{value:"cash",children:"Cash"}),t.jsx(bt.Button,{value:"loan",children:"Loan"}),t.jsx(bt.Button,{value:"nohp",children:"No HP"})]})})})}),ce==="loan"&&t.jsx(De,{gutter:[16,0],children:t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"Financier",name:"financier",rules:[{required:!0,message:"Select financier"}],children:t.jsx(rt,{size:C,placeholder:"Select Financier",showSearch:!0,optionFilterProp:"children",disabled:M,onChange:s=>h.setFieldsValue({financier:String(s).toUpperCase()}),style:{textTransform:"uppercase"},dropdownRender:void 0,children:Yl.map(s=>t.jsx(Ht,{value:s,children:s},s))})})})}),ce==="nohp"&&t.jsx(De,{gutter:[16,0],children:t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"No HP Options",name:"nohpFinancier",rules:[{required:!0,message:"Select option"}],children:t.jsxs(rt,{size:C,placeholder:"Select",disabled:M,onChange:s=>h.setFieldsValue({nohpFinancier:String(s).toUpperCase()}),style:{textTransform:"uppercase"},dropdownRender:void 0,children:[t.jsx(Ht,{value:"IDFC",children:"IDFC"}),t.jsx(Ht,{value:"L&T",children:"L&T FINANCE LIMITED"})]})})})}),(ce==="loan"||ce==="nohp")&&t.jsx(De,{gutter:[16,0],children:t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"Disbursement Amount ()",name:"disbursementAmount",rules:[{required:!0,message:"Enter disbursement amount"}],children:t.jsx(We,{size:C,style:{width:"100%"},min:1,step:500,prefix:t.jsx(At,{}),placeholder:"Enter amount",disabled:M||Yt})})})}),t.jsx(De,{gutter:[16,0],children:t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"Address Proof",name:"addressProofMode",initialValue:"aadhaar",rules:[{required:!0}],children:t.jsxs(bt.Group,{children:[t.jsx(bt.Button,{value:"aadhaar",children:"As per Aadhaar / Voter ID"}),t.jsx(bt.Button,{value:"additional",children:"Additional"})]})})})}),Ne==="additional"&&t.jsx(qt,{size:"small",title:t.jsx(Ur,{strong:!0,children:"Additional Address Proof"}),style:{marginTop:8,marginBottom:12,borderRadius:12},headStyle:{background:"#f8fafc",borderRadius:12},children:t.jsx(De,{gutter:[16,16],children:t.jsx(ye,{xs:24,children:t.jsx(G.Item,{label:"Select proof types",name:"addressProofTypes",rules:[{required:!0,message:"Select at least one type"}],children:t.jsx(ws.Group,{options:[{label:"Driving License",value:"DL"},{label:"Gas Bill",value:"GasBill"},{label:"Rental Agreement",value:"RentalAgreement"},{label:"Others",value:"Others"}]})})})})}),t.jsx(De,{gutter:[16,16],children:t.jsx(ye,{xs:24,children:t.jsx(G.Item,{label:"Upload Document (PDF only)",children:t.jsxs(Kl,{multiple:!1,beforeUpload:ko,fileList:T,onChange:({fileList:s})=>N(s.slice(0,1)),maxCount:1,accept:".pdf",itemRender:s=>s,disabled:!1,children:[t.jsx("p",{className:"ant-upload-drag-icon",children:t.jsx(pl,{})}),t.jsx("p",{className:"ant-upload-text",children:"Upload the document in PDF format."}),t.jsx("p",{className:"ant-upload-hint",children:"Maximum size 5MB. PDFs only."})]})})})}),(ce==="loan"||ce==="nohp")&&t.jsxs(De,{gutter:[16,0],children:[t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"EMI Amount ()",name:"emiAmount",children:t.jsx(We,{size:C,style:{width:"100%"},min:0,step:100,placeholder:"Enter EMI amount",disabled:M})})}),t.jsx(ye,{xs:24,md:12,children:t.jsx(G.Item,{label:"Tenure (Months)",name:"tenure",children:t.jsx(We,{size:C,style:{width:"100%"},min:1,step:1,precision:0,placeholder:"Enter months (e.g., 36)",disabled:M})})})]}),t.jsx(De,{gutter:[16,0],children:t.jsx(ye,{xs:24,children:t.jsx(G.Item,{label:"Address",name:"address",rules:[{required:!0,message:"Please enter address"}],getValueFromEvent:s=>s?.target?.value?.toUpperCase?.(),children:t.jsx(yt.TextArea,{rows:3,placeholder:"House No, Street, Area, City, PIN",allowClear:!0,disabled:M,style:{textTransform:"uppercase"}})})})}),(ce==="loan"||ce==="nohp")&&t.jsxs(De,{gutter:[16,0],children:[t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Down Payment ()",name:"downPayment",rules:[{required:!0,message:"Enter down payment"}],children:t.jsx(We,{size:C,style:{width:"100%"},min:0,step:500,prefix:t.jsx(At,{}),placeholder:"Enter amount",disabled:M})})}),t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Extra Fitting Amount ()",name:"extraFittingAmount",initialValue:0,children:t.jsx(We,{size:C,style:{width:"100%"},min:0,step:100,prefix:t.jsx(At,{}),placeholder:"Enter amount",disabled:M})})}),t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Discount ()",name:"discountAmount",initialValue:0,children:t.jsx(We,{size:C,style:{width:"100%"},min:0,step:100,prefix:t.jsx(At,{}),placeholder:"Enter amount",disabled:M})})}),Ne==="additional"&&t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Affidavit Charges ()",name:"affidavitCharges",rules:[{required:!0,message:"Enter affidavit charges"}],children:t.jsx(We,{size:C,style:{width:"100%"},min:0,step:100,prefix:t.jsx(At,{}),placeholder:"Enter amount",disabled:M})})})]}),ce==="cash"&&t.jsxs(De,{gutter:[16,0],children:[t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Extra Fitting Amount ()",name:"extraFittingAmount",initialValue:0,children:t.jsx(We,{size:C,style:{width:"100%"},min:0,step:100,prefix:t.jsx(At,{}),placeholder:"Enter amount",disabled:M})})}),t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Discount ()",name:"discountAmount",initialValue:0,children:t.jsx(We,{size:C,style:{width:"100%"},min:0,step:100,prefix:t.jsx(At,{}),placeholder:"Enter amount",disabled:M})})}),Ne==="additional"&&t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Affidavit Charges ()",name:"affidavitCharges",rules:[{required:!0,message:"Enter affidavit charges"}],children:t.jsx(We,{size:C,style:{width:"100%"},min:0,step:100,prefix:t.jsx(At,{}),placeholder:"Enter amount",disabled:M})})})]}),(ce==="loan"||ce==="nohp")&&t.jsxs(De,{gutter:[16,0],children:[t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Total DP ()",children:t.jsx(We,{size:C,style:{width:"100%"},value:jn,disabled:!0})})}),t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Balanced DP ()",children:t.jsx(We,{size:C,style:{width:"100%"},value:jo,disabled:!0})})})]}),ce==="cash"&&t.jsxs(De,{gutter:[16,0],children:[t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Total Vehicle Cost ()",children:t.jsx(We,{size:C,style:{width:"100%"},value:cn,disabled:!0})})}),t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Balanced Amount ()",children:t.jsx(We,{size:C,style:{width:"100%"},value:zn,disabled:!0})})})]}),t.jsxs(De,{gutter:[16,0],children:[t.jsx(ye,{xs:24,children:t.jsx("div",{style:{fontWeight:600,marginBottom:6},children:"Booking Payments (split Cash + Online inside each partial)"})}),[1,2,3].map(s=>t.jsxs(at.Fragment,{children:[t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:`Amount ${s} - Cash ()`,name:`bookingAmount${s}Cash`,dependencies:s===1?[`bookingAmount${s}Online`]:void 0,rules:s===1?[{validator:(O,P)=>{const _=Number(P||0)||0,J=Number(h.getFieldValue(`bookingAmount${s}Online`)||0)||0;return _>0||J>0?Promise.resolve():Promise.reject(new Error("Enter Amount 1 (cash or online)"))}}]:[],children:t.jsx(We,{size:C,style:{width:"100%"},min:0,step:500,prefix:t.jsx(At,{}),placeholder:"0"})})}),t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:`Amount ${s} - Online ()`,name:`bookingAmount${s}Online`,children:t.jsx(We,{size:C,style:{width:"100%"},min:0,step:500,prefix:t.jsx(At,{}),placeholder:"0"})})}),t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{shouldUpdate:!0,noStyle:!0,children:()=>{const O=Number(h.getFieldValue(`bookingAmount${s}Online`)||0)||0;return t.jsx(G.Item,{label:`UTR / Ref No.${s}`,name:`paymentReference${s}`,rules:O>0?[{required:!0,message:"Enter UTR / reference number"}]:[],getValueFromEvent:P=>{const _=P&&P.target?P.target.value:P;return typeof _=="string"?_.toUpperCase():_},children:t.jsx(yt,{size:C,placeholder:"e.g., 23XXXXUTR123",allowClear:!0,disabled:O<=0,style:{textTransform:"uppercase"}})})}})})]},`p-${s}`)),t.jsx(ye,{xs:24,md:8,children:t.jsx(G.Item,{label:"Total Booking Amount ()",children:t.jsx(We,{size:C,style:{width:"100%"},value:it,disabled:!0})})})]}),t.jsxs(G.Item,{style:{marginTop:8,marginBottom:0},children:[t.jsxs("div",{style:{display:"grid",gridTemplateColumns:$?"1fr":"1fr auto",gap:8},children:[t.jsx(Ee,{type:"primary",htmlType:"submit",size:$?"middle":"large",loading:Co,disabled:An>Date.now(),children:"Save Booking"}),Yt&&t.jsx(Ee,{className:"no-print",icon:t.jsx(vs,{}),size:$?"middle":"large",onClick:Ut,disabled:dn,loading:dn,children:"Print Booking Slip"})]}),!Yt&&t.jsxs("div",{style:{marginTop:6,color:"#b91c1c",fontSize:12},children:["Save first, then fetch booking to enable printing."," ","  ,   ."]})]})]});return e?t.jsx("div",{style:{paddingTop:4},children:$n}):t.jsxs("div",{style:{padding:$?12:E?18:24,background:$?"transparent":"linear-gradient(180deg,#f8fbff 0%,#ffffff 100%)",minHeight:"100dvh",display:"grid",alignItems:"start",position:"relative"},children:[ie&&t.jsx("div",{style:{position:"fixed",inset:0,zIndex:2e3,background:"rgba(255,255,255,0.88)",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx(po,{tip:"Fetching booking details...",size:"large"})}),t.jsx(qt,{bordered:!1,style:{width:"100%",maxWidth:920,margin:$?"8px auto 24dvh":"16px auto",borderRadius:16,boxShadow:"0 10px 30px rgba(37, 99, 235, 0.10), 0 2px 8px rgba(0,0,0,0.06)"},bodyStyle:{padding:$?16:28},headStyle:{borderBottom:"none",padding:$?"12px 16px 0":"16px 28px 0"},title:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:$?"wrap":"nowrap"},children:[Kn,t.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[t.jsx(Gl,{level:$?4:3,style:{margin:0},children:"Two Wheeler Booking"}),t.jsx(Ur,{type:"secondary",children:"Fill the details below to reserve your ride."})]}),t.jsx("div",{style:{flex:1}}),t.jsxs(Gt,{size:8,wrap:!0,children:[t.jsx(Cl,{form:h,webhookUrl:so,setSelectedCompany:he,setSelectedModel:Te,onApplied:zt,autoSearch:z}),t.jsx(ql,{form:h,webhookUrl:so,bookingId:W?.bookingId,mobile:W?.mobile})]})]}),children:$n}),t.jsx(ga,{ref:B,active:!0,vals:Zt})]})}const Bc=Object.freeze(Object.defineProperty({__proto__:null,default:ac},Symbol.toStringTag,{value:"Module"}));export{ac as B,Ul as F,ua as P,Tr as R,Bn as U,ql as a,ba as b,Al as c,xl as d,In as e,Ec as f,lo as g,Fs as h,Tc as i,Rc as j,Mc as k,Fr as l,Bc as m,Ic as r,Fc as u};

import{r as l,j as e,G as Vn,R as Bn}from"./index-Cpnbu_hS.js";import{L as ct,d as Z}from"./index-6X0CyMNZ.js";import{A as Wn,s as dt,l as Hn,b as qn,g as zn,u as Ye,n as F,D as Ln,r as Un}from"./caseInsensitive-DUicqe8X.js";import{W as _n,B as re}from"./button-BatQfFEZ.js";import{M as Mt}from"./index-_eB-6_5d.js";import{S as Qn}from"./index-Bh1aWF1p.js";import{I as J,s as Ee}from"./index-LPdCTC9Y.js";import{a as rn,R as G,S as Ae}from"./index-D-dakd2l.js";import{F as C}from"./index-DNb1SccI.js";import{l as Gn,p as sn,o as Yn,f as ln,e as nn,c as Kn,K as an,m as Xn,q as Jn,r as Zn,u as ke,F as ea,G as ta,C as na,D as aa,H as oa,R as ia,z as on,A as P}from"./TextArea-R_tc8-o2.js";import{E as ra}from"./EyeOutlined-o0bG0SND.js";import{I as cn}from"./AntdIcon--TaEBwyy.js";import{D as sa,R as la,a as ca}from"./ReloadOutlined-C95AnQMC.js";import{D as Pt}from"./index-btmmUnu2.js";import{T as ot}from"./index-Hb-OJ-YF.js";import{C as it}from"./index-BEdwHSAw.js";import{R as da}from"./PlusOutlined-D7Vln2_P.js";import"./useClosable-DbzGHYuW.js";import"./pickAttrs-BVAqgOfw.js";import"./PurePanel-ez_1tkJB.js";import"./PlusOutlined-7xIATISe.js";import"./index-B6oJeA1C.js";import"./Skeleton-CGp8jJhE.js";import"./useBubbleLock-Bs98J1M0.js";import"./LeftOutlined-BhX26yVi.js";import"./CheckOutlined-DFU0j46T.js";import"./DownOutlined-Crw_Sawk.js";import"./index-CUWDS_la.js";var ma=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],dn=l.forwardRef(function(a,o){var m,d=a.prefixCls,b=d===void 0?"rc-switch":d,x=a.className,N=a.checked,u=a.defaultChecked,p=a.disabled,A=a.loadingIcon,T=a.checkedChildren,Y=a.unCheckedChildren,fe=a.onClick,K=a.onChange,de=a.onKeyDown,Se=Gn(a,ma),X=sn(!1,{value:N,defaultValue:u}),ee=Yn(X,2),R=ee[0],M=ee[1];function me(E,te){var oe=R;return p||(oe=E,M(oe),K?.(oe,te)),oe}function ye(E){E.which===an.LEFT?me(!1,E):E.which===an.RIGHT&&me(!0,E),de?.(E)}function O(E){var te=me(!R,E);fe?.(te,E)}var ae=ln(b,x,(m={},nn(m,"".concat(b,"-checked"),R),nn(m,"".concat(b,"-disabled"),p),m));return l.createElement("button",Kn({},Se,{type:"button",role:"switch","aria-checked":R,disabled:p,className:ae,ref:o,onKeyDown:ye,onClick:O}),A,l.createElement("span",{className:"".concat(b,"-inner")},l.createElement("span",{className:"".concat(b,"-inner-checked")},T),l.createElement("span",{className:"".concat(b,"-inner-unchecked")},Y)))});dn.displayName="Switch";const ha=a=>{const{componentCls:o,trackHeightSM:m,trackPadding:d,trackMinWidthSM:b,innerMinMarginSM:x,innerMaxMarginSM:N,handleSizeSM:u,calc:p}=a,A=`${o}-inner`,T=ke(p(u).add(p(d).mul(2)).equal()),Y=ke(p(N).mul(2).equal());return{[o]:{[`&${o}-small`]:{minWidth:b,height:m,lineHeight:ke(m),[`${o}-inner`]:{paddingInlineStart:N,paddingInlineEnd:x,[`${A}-checked, ${A}-unchecked`]:{minHeight:m},[`${A}-checked`]:{marginInlineStart:`calc(-100% + ${T} - ${Y})`,marginInlineEnd:`calc(100% - ${T} + ${Y})`},[`${A}-unchecked`]:{marginTop:p(m).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${o}-handle`]:{width:u,height:u},[`${o}-loading-icon`]:{top:p(p(u).sub(a.switchLoadingIconSize)).div(2).equal(),fontSize:a.switchLoadingIconSize},[`&${o}-checked`]:{[`${o}-inner`]:{paddingInlineStart:x,paddingInlineEnd:N,[`${A}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${A}-unchecked`]:{marginInlineStart:`calc(100% - ${T} + ${Y})`,marginInlineEnd:`calc(-100% + ${T} - ${Y})`}},[`${o}-handle`]:{insetInlineStart:`calc(100% - ${ke(p(u).add(d).equal())})`}},[`&:not(${o}-disabled):active`]:{[`&:not(${o}-checked) ${A}`]:{[`${A}-unchecked`]:{marginInlineStart:p(a.marginXXS).div(2).equal(),marginInlineEnd:p(a.marginXXS).mul(-1).div(2).equal()}},[`&${o}-checked ${A}`]:{[`${A}-checked`]:{marginInlineStart:p(a.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:p(a.marginXXS).div(2).equal()}}}}}}},ua=a=>{const{componentCls:o,handleSize:m,calc:d}=a;return{[o]:{[`${o}-loading-icon${a.iconCls}`]:{position:"relative",top:d(d(m).sub(a.fontSize)).div(2).equal(),color:a.switchLoadingIconColor,verticalAlign:"top"},[`&${o}-checked ${o}-loading-icon`]:{color:a.switchColor}}}},pa=a=>{const{componentCls:o,trackPadding:m,handleBg:d,handleShadow:b,handleSize:x,calc:N}=a,u=`${o}-handle`;return{[o]:{[u]:{position:"absolute",top:m,insetInlineStart:m,width:x,height:x,transition:`all ${a.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:d,borderRadius:N(x).div(2).equal(),boxShadow:b,transition:`all ${a.switchDuration} ease-in-out`,content:'""'}},[`&${o}-checked ${u}`]:{insetInlineStart:`calc(100% - ${ke(N(x).add(m).equal())})`},[`&:not(${o}-disabled):active`]:{[`${u}::before`]:{insetInlineEnd:a.switchHandleActiveInset,insetInlineStart:0},[`&${o}-checked ${u}::before`]:{insetInlineEnd:0,insetInlineStart:a.switchHandleActiveInset}}}}},ga=a=>{const{componentCls:o,trackHeight:m,trackPadding:d,innerMinMargin:b,innerMaxMargin:x,handleSize:N,calc:u}=a,p=`${o}-inner`,A=ke(u(N).add(u(d).mul(2)).equal()),T=ke(u(x).mul(2).equal());return{[o]:{[p]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:x,paddingInlineEnd:b,transition:`padding-inline-start ${a.switchDuration} ease-in-out, padding-inline-end ${a.switchDuration} ease-in-out`,[`${p}-checked, ${p}-unchecked`]:{display:"block",color:a.colorTextLightSolid,fontSize:a.fontSizeSM,transition:`margin-inline-start ${a.switchDuration} ease-in-out, margin-inline-end ${a.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:m},[`${p}-checked`]:{marginInlineStart:`calc(-100% + ${A} - ${T})`,marginInlineEnd:`calc(100% - ${A} + ${T})`},[`${p}-unchecked`]:{marginTop:u(m).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${o}-checked ${p}`]:{paddingInlineStart:b,paddingInlineEnd:x,[`${p}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${p}-unchecked`]:{marginInlineStart:`calc(100% - ${A} + ${T})`,marginInlineEnd:`calc(-100% + ${A} - ${T})`}},[`&:not(${o}-disabled):active`]:{[`&:not(${o}-checked) ${p}`]:{[`${p}-unchecked`]:{marginInlineStart:u(d).mul(2).equal(),marginInlineEnd:u(d).mul(-1).mul(2).equal()}},[`&${o}-checked ${p}`]:{[`${p}-checked`]:{marginInlineStart:u(d).mul(-1).mul(2).equal(),marginInlineEnd:u(d).mul(2).equal()}}}}}},fa=a=>{const{componentCls:o,trackHeight:m,trackMinWidth:d}=a;return{[o]:Object.assign(Object.assign(Object.assign(Object.assign({},Zn(a)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:d,height:m,lineHeight:ke(m),verticalAlign:"middle",background:a.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${a.motionDurationMid}`,userSelect:"none",[`&:hover:not(${o}-disabled)`]:{background:a.colorTextTertiary}}),ea(a)),{[`&${o}-checked`]:{background:a.switchColor,[`&:hover:not(${o}-disabled)`]:{background:a.colorPrimaryHover}},[`&${o}-loading, &${o}-disabled`]:{cursor:"not-allowed",opacity:a.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${o}-rtl`]:{direction:"rtl"}})}},ya=a=>{const{fontSize:o,lineHeight:m,controlHeight:d,colorWhite:b}=a,x=o*m,N=d/2,u=2,p=x-u*2,A=N-u*2;return{trackHeight:x,trackHeightSM:N,trackMinWidth:p*2+u*4,trackMinWidthSM:A*2+u*2,trackPadding:u,handleBg:b,handleSize:p,handleSizeSM:A,handleShadow:`0 2px 4px 0 ${new ta("#00230b").setA(.2).toRgbString()}`,innerMinMargin:p/2,innerMaxMargin:p+u+u*2,innerMinMarginSM:A/2,innerMaxMarginSM:A+u+u*2}},xa=Xn("Switch",a=>{const o=Jn(a,{switchDuration:a.motionDurationMid,switchColor:a.colorPrimary,switchDisabledOpacity:a.opacityLoading,switchLoadingIconSize:a.calc(a.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${a.opacityLoading})`,switchHandleActiveInset:"-30%"});return[fa(o),ga(o),pa(o),ua(o),ha(o)]},ya);var ba=function(a,o){var m={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&o.indexOf(d)<0&&(m[d]=a[d]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var b=0,d=Object.getOwnPropertySymbols(a);b<d.length;b++)o.indexOf(d[b])<0&&Object.prototype.propertyIsEnumerable.call(a,d[b])&&(m[d[b]]=a[d[b]]);return m};const va=l.forwardRef((a,o)=>{const{prefixCls:m,size:d,disabled:b,loading:x,className:N,rootClassName:u,style:p,checked:A,value:T,defaultChecked:Y,defaultValue:fe,onChange:K}=a,de=ba(a,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[Se,X]=sn(!1,{value:A??T,defaultValue:Y??fe}),{getPrefixCls:ee,direction:R,switch:M}=l.useContext(na),me=l.useContext(aa),ye=(b??me)||x,O=ee("switch",m),ae=l.createElement("div",{className:`${O}-handle`},x&&l.createElement(ia,{className:`${O}-loading-icon`})),[E,te,oe]=xa(O),ie=oa(d),ne=ln(M?.className,{[`${O}-small`]:ie==="small",[`${O}-loading`]:x,[`${O}-rtl`]:R==="rtl"},N,u,te,oe),he=Object.assign(Object.assign({},M?.style),p),Ie=(...se)=>{X(se[0]),K?.apply(void 0,se)};return E(l.createElement(_n,{component:"Switch"},l.createElement(dn,Object.assign({},de,{checked:Se,onChange:Ie,prefixCls:O,className:ne,style:he,disabled:ye,ref:o,loadingIcon:ae}))))}),Rt=va;Rt.__ANT_SWITCH=!0;function Et(){return Et=Object.assign?Object.assign.bind():function(a){for(var o=1;o<arguments.length;o++){var m=arguments[o];for(var d in m)Object.prototype.hasOwnProperty.call(m,d)&&(a[d]=m[d])}return a},Et.apply(this,arguments)}const wa=(a,o)=>l.createElement(cn,Et({},a,{ref:o,icon:sa})),Sa=l.forwardRef(wa);function Dt(){return Dt=Object.assign?Object.assign.bind():function(a){for(var o=1;o<arguments.length;o++){var m=arguments[o];for(var d in m)Object.prototype.hasOwnProperty.call(m,d)&&(a[d]=m[d])}return a},Dt.apply(this,arguments)}const ja=(a,o)=>l.createElement(cn,Dt({},a,{ref:o,icon:ra})),Ca=l.forwardRef(ja);function Na({form:a,webhookUrl:o,EXECUTIVES:m=[],setBrand:d,setMode:b,setVehicleType:x,setFittings:N,setDocsReq:u,setEmiSet:p,setDownPayment:A,setOnRoadPrice:T,setCompany:Y,setModel:fe,setVariant:K,setExtraVehicles:de,setFollowUpEnabled:Se,setFollowUpAt:X,setFollowUpNotes:ee,onPayloadApplied:R,autoApply:M,buttonText:me="Fetch Details",buttonProps:ye={}}){const[O,ae]=l.useState(!1),[E,te]=l.useState(""),[oe,ie]=l.useState(!1),[ne,he]=l.useState([]),[Ie,se]=l.useState(""),Be=l.useRef(""),xe=w=>String(w||"").replace(/\D/g,"").replace(/^0+/,"").slice(-10),$e=()=>{const w=xe(E)||String(E||"").trim(),h=w?`The mobile number "${w}" is not in our quotation records.`:"No matching record found in our quotation records.";se(h),Mt.warning({centered:!0,title:"No quotation found",content:h,okText:"Got it"})},We=async()=>{if(!o)throw new Error("Quotation search webhook is not configured");const w=await dt({webhookUrl:o,method:"GET",payload:{action:"search",mode:"mobile",query:String(E||"")}}),h=w?.data||w;return{mode:"webhook",rows:Array.isArray(h?.rows)?h.rows:[]}},ue=w=>w&&w.formValues?w:{version:0,brand:"SHANTHA",mode:"cash",vehicleType:"scooter",fittings:[],docsReq:[],emiSet:"12",downPayment:0,onRoadPrice:0,company:"",model:"",variant:"",branch:"",followUp:{enabled:!1,at:null,notes:"",status:"pending"},formValues:{serialNo:"",name:"",mobile:"",address:"",company:"",bikeModel:"",variant:"",onRoadPrice:0,executive:m[0]?.name||"",remarks:"",branch:""},extraVehicles:[]},je=w=>{const h=w&&typeof w=="object"?w.payload:null,f=w&&typeof w=="object"?w.values||{}:{},k=pe=>Number(String(pe||0).replace(/[,â‚¹\s]/g,""))||0,D=(...pe)=>pe.find(ve=>ve!=null&&String(ve).trim()!=="")||"",U=(pe,ve)=>{for(const Je of ve){const Pe=pe?.[Je];if(Pe!=null&&String(Pe).trim()!=="")return Pe}return""},Ce=k(f.downPayment||f.DownPayment||f["Down Payment"]||f.DP||f.dp||f.Down_Payment),I=h&&typeof h=="object"?h:{},H=I.formValues||{},mt=D(U(f,["serialNo","Quotation_ID","Quotation ID","Quotation_Id","Serial","Quotation No","Quotation No."]),H.serialNo,I.serialNo),Me=D(U(f,["name","Customer_Name","Customer Name","Customer","Name"]),H.name),ht=D(U(f,["mobile","Mobile","Mobile Number","Phone"]),H.mobile),He=D(U(f,["company","Company"]),H.company,I.company),Fe=D(U(f,["bikeModel","Bike Model","Model"]),H.bikeModel,H.model,I.model),Xe=D(U(f,["variant","Variant"]),H.variant,I.variant),qe=D(U(f,["branch","Branch","Branch Name"]),H.branch,I.branch),Te=D(U(f,["executive","Executive_Name","Executive Name","Executive"]),H.executive,m[0]?.name||""),ut=D(U(f,["remarks","Remarks","Offerings"]),H.remarks,I.remarks),Ne=k(D(U(f,["onRoadPrice","OnRoadPrice","On-Road Price","On Road Price","Price"]),H.onRoadPrice,I.onRoadPrice)),Oe=k(D(U(f,["downPayment","DownPayment","Down Payment","DP","dp"]),H.downPayment,I.downPayment,Ce));return{version:I.version||0,brand:I.brand||"SHANTHA",mode:I.mode||"cash",vehicleType:I.vehicleType||"scooter",fittings:Array.isArray(I.fittings)?I.fittings:[],docsReq:Array.isArray(I.docsReq)?I.docsReq:[],emiSet:I.emiSet||"12",downPayment:Oe,onRoadPrice:Ne,company:He,model:Fe,variant:Xe,branch:qe,savedAt:I.savedAt||"",createdAt:I.createdAt||"",followUp:I.followUp||{enabled:!1,at:null,notes:"",status:"pending"},formValues:{serialNo:mt,name:Me,mobile:ht,address:D(f.address,f.Address,H.address,I.address),company:He,bikeModel:Fe,variant:Xe,onRoadPrice:Ne,downPayment:Oe,executive:Te,remarks:ut,branch:qe},extraVehicles:Array.isArray(I.extraVehicles)?I.extraVehicles:[]}},be=w=>{const h=ue(w);try{d?.(h.brand||"SHANTHA"),b?.(h.mode||"cash"),x?.(h.vehicleType||"scooter"),N?.(Array.isArray(h.fittings)?h.fittings:[]),u?.(Array.isArray(h.docsReq)?h.docsReq:[]),p?.(h.emiSet||"12"),A?.(Number(h.downPayment||0)),T?.(Number(h.onRoadPrice||0)),Y?.(h.company||""),fe?.(h.model||""),K?.(h.variant||""),de?.(Array.isArray(h.extraVehicles)?h.extraVehicles:[]);const f=h.followUp||{};Se?.(!!f.enabled),X?.(f.at?Z(f.at):null),ee?.(f.notes||"");const k=h.formValues||{};a.setFieldsValue({serialNo:k.serialNo||"",name:k.name||"",mobile:xe(k.mobile||""),address:k.address||"",company:k.company||h.company||"",bikeModel:k.bikeModel||h.model||"",variant:k.variant||h.variant||"",onRoadPrice:Number(k.onRoadPrice??h.onRoadPrice??0),downPayment:Number(k.downPayment??h.downPayment??0),executive:k.executive||m[0]?.name||"",remarks:k.remarks||"",branch:k.branch||h.branch||""}),T?.(Number(k.onRoadPrice??h.onRoadPrice??0)),R?.({serialNo:k.serialNo||h.serialNo||"",savedAt:h.savedAt||"",createdAt:h.createdAt||k.createdAt||""}),Ee.success("Quotation loaded."),ae(!1),he([]),te("")}catch(f){console.warn("applyToForm error:",f),Ee.error("Could not apply fetched details.")}};l.useEffect(()=>{if(!M?.payload&&!M?.values)return;const w=String(M?.token||"")+":"+String(M?.values?.serialNo||M?.payload?.formValues?.serialNo||M?.payload?.serialNo||M?.values?.mobile||M?.payload?.formValues?.mobile||"");if(Be.current===w)return;Be.current=w;const h=je({payload:M?.payload||{},values:M?.values||{}});be(h)},[M]);const De=async()=>{const w=String(E||"").trim(),h=xe(w);if(!h||h.length!==10){Ee.warning("Enter a valid 10-digit mobile number.");return}te(h),se(""),ie(!0);try{const f=await We();if(!f)throw new Error("No result");const k=(f.rows||[]).map(D=>({payload:je(D)}));if(!k.length){$e(),he([]);return}if(k.length===1){be(k[0].payload);return}he(k.slice(0,10)),Ee.info(`Found ${k.length} matches. Pick one.`)}catch(f){console.warn("FetchQuot search error:",f),Ee.error("Could not fetch quotations. Check the Apps Script/Webhook.")}finally{ie(!1)}},le=w=>{const h=w.payload||{},f=h.formValues||{},k=f.serialNo||"â€”",D=f.name||"â€”",U=xe(f.mobile)||"â€”",Ce=[f.company||h.company,f.bikeModel||h.model,f.variant||h.variant].filter(Boolean).join(" ")||"â€”",I=Number(f.onRoadPrice??h.onRoadPrice??0),H=f.branch||h.branch||"â€”";return e.jsx(ct.Item,{actions:[e.jsx(re,{type:"link",onClick:()=>be(w.payload),children:"Use"})],children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",width:"100%"},children:[e.jsxs("div",{children:[e.jsx("b",{children:"Quotation:"})," ",k," Â  ",e.jsx("b",{children:"Name:"})," ",D]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mobile:"})," ",U," Â  ",e.jsx("b",{children:"Vehicle:"})," ",Ce]}),e.jsxs("div",{style:{gridColumn:"1 / span 2",color:"#999"},children:[e.jsx("b",{children:"Branch:"})," ",H," Â  ",e.jsx("b",{children:"Price:"})," â‚¹",I.toLocaleString("en-IN")]})]})})};return e.jsxs(e.Fragment,{children:[e.jsx(re,{...ye,onClick:()=>{se(""),ae(!0)},children:me}),e.jsx(Mt,{title:"Fetch Quotation",open:O,onCancel:()=>{ae(!1),he([]),se("")},footer:[e.jsx(re,{onClick:()=>{ae(!1),he([]),se("")},children:"Close"},"close"),e.jsx(re,{type:"primary",loading:oe,onClick:De,children:"Search"},"search")],children:e.jsxs(Qn,{direction:"vertical",style:{width:"100%"},children:[e.jsx(J,{placeholder:"Enter Mobile (10-digit or last few digits)",value:E,inputMode:"numeric",onChange:w=>te(xe(w.target.value)),onPressEnter:De,allowClear:!0}),Ie&&e.jsx(Wn,{type:"warning",showIcon:!0,message:Ie}),oe&&e.jsx(rn,{}),ne.length>1&&e.jsx(ct,{size:"small",bordered:!0,dataSource:ne,renderItem:le})]})})]})}const Pa="https://script.google.com/macros/s/AKfycby0YV2E2Ryb4YehYRzBistMW4sWN3XDcqaEfgkfRvEjmaKNVKq2Ubi3ul50AbxO6TVPJA/exec",Ke=Pa,Aa="https://docs.google.com/spreadsheets/d/e/2PACX-1vQYGuNPY_2ivfS7MTX4bWiu1DWdF2mrHSCnmTznZVEHxNmsrgcGWjVZN4UDUTOzQQdXTnbeM-ylCJbB/pub?gid=408799621&single=true&output=csv",rt={company:["Company","Company Name"],model:["Model","Model Name"],variant:["Variant"],price:["On-Road Price","On Road Price","Price","OnRoadPrice"]},ka=a=>{const o=[];let m=[],d="",b=!1;for(let x=0;x<a.length;x++){const N=a[x],u=a[x+1];if(N==='"'&&!b){b=!0;continue}if(N==='"'&&b){if(u==='"'){d+='"',x++;continue}b=!1;continue}if(N===","&&!b){m.push(d),d="";continue}if((N===`
`||N==="\r")&&!b){(d!==""||m.length)&&(m.push(d),o.push(m),m=[],d=""),N==="\r"&&u===`
`&&x++;continue}d+=N}return(d!==""||m.length)&&(m.push(d),o.push(m)),o},Ia=async a=>{const o=await fetch(a,{cache:"no-store"});if(!o.ok)throw new Error("Sheet fetch failed");const m=await o.text();if(m.trim().startsWith("<"))throw new Error("Expected CSV, got HTML");const d=ka(m);if(!d.length)return[];const b=d[0].map(x=>(x||"").trim());return d.slice(1).map(x=>{const N={};return b.forEach((u,p)=>N[u]=x[p]??""),N})},st=(a,o)=>String(o.map(m=>a[m]??"").find(m=>m!=="")||"").trim(),$a=(a={})=>({company:st(a,rt.company),model:st(a,rt.model),variant:st(a,rt.variant),onRoadPrice:Number(String(st(a,rt.price)||"0").replace(/[",\sâ‚¹]/g,""))||0}),Ma=8e3,Ra=9,Ea=11,At=[{name:"Rukmini",phone:"9901678562"},{name:"Meghana",phone:"9741609799"},{name:"Shubha",phone:"8971585057"},{name:"Rani",phone:"9108970455"},{name:"Likhitha",phone:"9535190015"},{name:"Vanitha",phone:"9380729861"},{name:"Prakash",phone:"9740176476"},{name:"Swathi",phone:"6363116317"},{name:"Kumar",phone:"7975807667"},{name:"Sujay",phone:"7022878048"},{name:"Kavi",phone:"9108970455"},{name:"Narasimha",phone:"9900887666"},{name:"Kavya",phone:"8073165374"}];async function Da(a,o,m){try{const d=await Un(a,o,m);if(d?.success&&d?.serial)return String(d.serial)}catch(d){console.error("Failed to reserve quotation serial via API",d)}return Z().format("YYMMDDHHmmss")}const Fa=["All Round Guard","Side Stand","Ladies Foot Rest","Grip Cover","Seat Cover","Floor Mat","ISI Helmet"],Ta=["Crash Guard","Engine Guard","Tank Cover","Ladies Handle","Gripper","Seat Cover","ISI Helmet"],kt=["Aadhar Card","Pan Card","Bank Passbook","ATM Card","Local Address Proof"],Oa="Meghana",Va="Byadarahalli",Ba=[{required:!0,message:"Mobile number is required"},{pattern:/^[6-9]\d{9}$/,message:"Enter a valid 10-digit Indian mobile number"}],Wa=a=>String(a||"").toUpperCase().replace(/[^A-Z\s]/g,"").replace(/\s+/g," ").trimStart(),Ha={validator:async(a,o)=>{const m=String(o||"").trim();if(!m)return Promise.resolve();if(m.startsWith("="))throw new Error("Name cannot start with =");if(/[^A-Z\s]/.test(m))throw new Error("Name can contain only letters and spaces")}},ce=a=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(Math.max(0,Math.round(a||0))),qa=async a=>await dt({webhookUrl:Ke,method:"POST",payload:{action:"save",data:a}}),za=()=>({company:"",model:"",variant:"",onRoadPrice:0,downPayment:0,emiSet:"12"}),lt=["branch","executive","name","mobile","company","bikeModel","variant","onRoadPrice"],It=(a,o)=>{const m=o?.errorFields?.[0]?.name;m?.length&&a.scrollToField(m,{behavior:"smooth",block:"center"})},$t=async a=>{const o=await a.validateFields(lt);if(!(Number(o?.onRoadPrice||0)>0))throw new Error("On-Road Price must be greater than 0.");if(!/^[6-9]\d{9}$/.test(String(o?.mobile||"")))throw new Error("Enter a valid 10-digit Indian mobile number.");return o};function vo(){const[a]=C.useForm(),[o,m]=l.useState("SHANTHA"),[d,b]=l.useState([]),[x,N]=l.useState(""),[u,p]=l.useState(""),[A,T]=l.useState(""),[Y,fe]=l.useState(0),[K,de]=l.useState(0),Se=(t=6e3)=>{const n=Date.now()+t;de(n),setTimeout(()=>de(0),t+50)},[X,ee]=l.useState(0),[R,M]=l.useState(!1),[me,ye]=l.useState(!1),[O,ae]=l.useState("loan"),[E,te]=l.useState("12"),oe=l.useMemo(()=>E==="12"?[12,18,24,36]:[24,30,36,48],[E]),[ie,ne]=l.useState(0),[he,Ie]=l.useState(!1),[se,Be]=l.useState(!1),xe=l.useRef(!1),[$e,We]=l.useState("scooter"),[ue,je]=l.useState(["Side Stand","Floor Mat","ISI Helmet","Grip Cover"]),[be,De]=l.useState(kt),[le,w]=l.useState([]),[h,f]=l.useState(),[,k]=l.useState(""),[D,U]=l.useState(""),[Ce,I]=l.useState([]),[H,mt]=l.useState(!1),[Me,ht]=l.useState(""),[He,Fe]=l.useState(""),[Xe,qe]=l.useState(""),[Te,ut]=l.useState([]),[Ne,Oe]=l.useState(!0),[pe,ve]=l.useState(()=>Z().add(2,"day").hour(10).minute(0).second(0).millisecond(0)),[Je,Pe]=l.useState(""),[mn,Ze]=l.useState(!1),[hn,Ft]=l.useState(!1),[pt,Ve]=l.useState([]),[un,ze]=l.useState(!1),[pn,gn]=l.useState(null),[et,gt]=l.useState({serialNo:"",savedAt:"",createdAt:""}),Le="Quotation:outbox",ft=(t,n)=>{try{const s=localStorage.getItem(t);return s?JSON.parse(s):n}catch{return n}},Tt=(t,n)=>{try{localStorage.setItem(t,JSON.stringify(n))}catch{}},fn=t=>{const n=ft(Le,[]),s={id:Date.now()+":"+Math.random().toString(36).slice(2),job:t};return n.push(s),Tt(Le,n),s.id},Ot=t=>{const n=ft(Le,[]);Tt(Le,n.filter(s=>s.id!==t))},Vt=async()=>{try{const t=ft(Le,[]);if(!Array.isArray(t)||!t.length)return;for(const n of t){const s=n.job||{};try{if(s.type==="quot"&&Ke){const r=await dt({webhookUrl:Ke,method:"POST",payload:{action:"save",data:s.data}});if(!((r?.data||r)?.success!==!1))throw new Error("Webhook save failed");Ot(n.id)}}catch{}}}catch{}};l.useEffect(()=>{setTimeout(()=>{Vt()},0)},[]),l.useEffect(()=>{const t=()=>Vt();return window.addEventListener("online",t),()=>window.removeEventListener("online",t)},[]);const tt=C.useWatch("executive",a)||h||"",yt=l.useMemo(()=>{const t=i=>String(i||"").trim().toLowerCase(),n=t(tt);if(!n)return"";const s=i=>(i||[]).find(g=>t(g?.name)===n),r=s(Te)||s(At);if(r?.phone)return String(r.phone);try{const i=JSON.parse(localStorage.getItem("user")||"null"),g=t(i?.formDefaults?.staffName||i?.name||"");if(g&&g===n)return String(i?.phone||"")}catch{}return""},[tt,Te]),Ue=C.useWatch("branch",a),Bt=C.useWatch("executive",a);l.useEffect(()=>{const t={};!Ue&&D&&(t.branch=D),!Bt&&Me&&(t.executive=Me),Object.keys(t).length&&a.setFieldsValue(t)},[Ue,Bt,D,Me]);const[ge,yn]=Ee.useMessage(),Wt=async(t="Saved successfully")=>{ge.destroy("save"),ge.open({key:"save",type:"success",content:t,duration:1.5}),await new Promise(n=>setTimeout(n,300))},Ht=l.useRef(null),xn=l.useMemo(()=>Z().format("DD-MM-YYYY HH:mm"),[]),bn=t=>{const n=t?.startsWith("http")?t:`${window.location.origin}${t||""}`,s=Date.now();return n.includes("?")?`${n}&v=${s}`:`${n}?v=${s}`};l.useEffect(()=>{(async()=>{try{const t=i=>String(i||"").trim().toUpperCase(),n=()=>{try{const i=localStorage.getItem("user");return i?JSON.parse(i):null}catch{return null}},s=i=>i?typeof i=="string"?i:typeof i=="object"&&(i._id||i.id||i.$oid)||null:null;let r=n();if(!r||!r.formDefaults){const i=await Vn().catch(()=>null);if(i?.success&&i.data){r=i.data;try{localStorage.setItem("user",JSON.stringify(r))}catch{}}}if(r){const i=r?.formDefaults?.staffName||r?.name||void 0,g=i?t(i):void 0,c=r?.role?String(r.role).toLowerCase():void 0,B=!!r?.canSwitchBranch||["owner","admin","backend"].includes(String(c||"").toLowerCase());mt(B);try{const L=String(c||"").toLowerCase();if(["owner","admin","backend"].includes(L)){const q=await Hn({status:"active",limit:500});if(q?.success&&Array.isArray(q?.data?.items)){const z=q.data.items.filter(v=>String(v?.status||"").toLowerCase()==="active").map(v=>({id:String(v.id||v._id||""),name:t(v.name),code:v.code?String(v.code).toUpperCase():""}));I(z)}try{const W=await qn({role:"staff",status:"active",limit:1e5});if(W?.success&&Array.isArray(W?.data?.items)){const z=W.data.items.map(v=>({name:v.name,phone:v.phone||""}));ut(z)}}catch{}}else{const q=[],W=S=>{if(!S)return;const Q=typeof S=="string"?"":String(S?.status||"").toLowerCase();if(Q&&Q!=="active")return;const Re=S&&(S._id||S.id||S.$oid||S)||"",Ct=typeof S=="string"?"":S?.name||"",at=t(Ct),Ge=typeof S=="string"?"":S?.code||"";!Re||!at||q.push({id:String(Re),name:String(at),code:Ge?String(Ge).toUpperCase():""})};r?.primaryBranch&&W(r.primaryBranch),Array.isArray(r?.branches)&&r.branches.forEach(W);const z=new Set,v=[];q.forEach(S=>{z.has(S.id)||(z.add(S.id),v.push(S))}),I(v)}}catch{}let $=r?.formDefaults?.branchName?t(r.formDefaults.branchName):void 0;const j=r?.formDefaults?.branchCode&&String(r.formDefaults.branchCode).toUpperCase()||"";if(j){Fe(j);try{a.setFieldsValue({branchCode:j})}catch{}}const y=r?.formDefaults&&(r.formDefaults.branchId?._id||r.formDefaults.branchId||null)||r?.primaryBranch&&(r.primaryBranch?._id||r.primaryBranch||null)||Array.isArray(r?.branches)&&r.branches.length&&(r.branches[0]?._id||r.branches[0])||null;if(y)try{const L=await zn(String(y)).catch(()=>null);if(L?.success&&L?.data&&($||($=L.data.name),L?.data?.code&&!He)){const q=String(L.data.code).toUpperCase();Fe(q),qe(String(L.data.id||y));try{a.setFieldsValue({branchCode:q})}catch{}}}catch{}g&&f(g),c&&k(c);const _={};g&&(_.executive=g),$&&(_.branch=$),Object.keys(_).length&&a.setFieldsValue(_),$&&U($),g&&ht(g)}}catch{}try{const n=(await Ia(Aa)).map($a).filter(s=>s.company&&s.model&&s.variant);if(!n.length){ge.warning("Sheet loaded but no valid rows. Switching to manual entry."),M(!0),ye(!1);return}b(n),ye(!0),M(!1)}catch{ge.warning("Could not load vehicle sheet. Switched to manual entry."),M(!0),ye(!1)}})()},[ge]);const vn=Bn.useMemo(()=>{const t=new Map;return(Ce||[]).forEach(n=>t.set(String(n.name||"").toLowerCase(),n)),t},[Ce]),wn=t=>{try{const n=String(t||"").toLowerCase(),s=vn.get(n);if(s){qe(s.id),s.code&&Fe(String(s.code).toUpperCase());try{a.setFieldsValue({branch:s.name,branchCode:s.code?String(s.code).toUpperCase():void 0})}catch{}}}catch{}},_e=l.useMemo(()=>Ue||D||"",[Ue,D]),xt=l.useMemo(()=>!!String(_e||"").trim(),[_e]),nt=un?pt.length:null,qt=t=>{if(!t)return null;if(Z.isDayjs(t))return t.isValid()?t:null;if(t instanceof Date)return Number.isNaN(t.getTime())?null:Z(t);const n=String(t).trim();if(!n)return null;const s=Z(n);if(s.isValid())return s;const r=n.match(/^(\d{1,2})[-/](\d{1,2})[-/](\d{2,4})(?:\s+(\d{1,2}):(\d{2}))?$/);if(!r)return null;const i=Number(r[1]),g=Number(r[2]),c=Number(r[3].length===2?`20${r[3]}`:r[3]),B=Number(r[4]||0),$=Number(r[5]||0),j=`${String(c).padStart(4,"0")}-${String(g).padStart(2,"0")}-${String(i).padStart(2,"0")}T${String(B).padStart(2,"0")}:${String($).padStart(2,"0")}:00`,y=Z(j);return y.isValid()?y:null},bt=t=>{const n=qt(t);return n?n.format("DD-MM-YYYY HH:mm"):"-"},Sn=t=>{const n=qt(t);if(!n)return"";const s=Z(),r=n.diff(s,"minute"),i=Math.abs(r);if(i<60)return r>=0?`${i} min`:`${i} min ago`;const g=Math.round(i/60);if(g<24)return r>=0?`${g} hrs`:`${g} hrs ago`;const c=Math.round(g/24);return r>=0?`${c} days`:`${c} days ago`},jn=t=>{const n=t?.values||t||{},s=t?.payload||n.Payload||n.payload||n.PAYLOAD||t?.Payload||t?.PAYLOAD||"";let r={};try{r=typeof s=="object"?s:JSON.parse(String(s||"{}"))}catch{r={}}const i=r.formValues||r.values||{},g=r.followUp||r.followup||{},c=String(g.status||n.Status||n.status||"pending").toLowerCase(),B=(_,L)=>{for(const q of L){const W=_?.[q];if(W!=null&&String(W).trim()!=="")return String(W).trim()}return""},$=g.at||g.followUpAt||n["Follow-up At"]||n["Follow Up At"]||n["Followup At"]||n["Follow-up Date"]||n["Follow Up Date"]||n["Followup Date"]||"",j=r.createdAt||r.savedAt||n["Created At"]||n.CreatedAt||n["Saved At"]||n.SavedAt||n["Created Date"]||n.Date||"",y=r.updatedAt||n["Updated At"]||n.UpdatedAt||n["Last Updated"]||"";return{serial:i.serialNo||B(n,["Quotation No.","Quotation No","Quotation_ID","Quotation ID","Serial"])||"-",name:i.name||B(n,["Customer_Name","Customer Name","Name"])||"-",mobile:String(i.mobile||B(n,["Mobile","Mobile Number","Phone"])||"").replace(/\D/g,"").slice(-10),vehicle:[i.company||r.company||n.Company,i.bikeModel||r.model||n.Model,i.variant||r.variant||n.Variant].filter(Boolean).join(" ")||"-",branch:i.branch||r.branch||n.Branch||n["Branch Name"]||"-",followUpAt:bt($),followUpAtRaw:$,createdAt:bt(j),updatedAt:bt(y),dueLabel:Sn($),followUpNotes:g.notes||n["Follow-up Notes"]||n["Follow Up Notes"]||n["Followup Notes"]||"",status:c,payload:r,values:n}},vt=async({silent:t=!1}={})=>{if(!xt){Ve([]),ze(!1);return}t||Ft(!0);try{const r=await dt({webhookUrl:Ke,method:"GET",payload:{...{action:"list",page:1,pageSize:500},..._e?{branch:_e}:{}}}),i=r?.data||r,B=(Array.isArray(i?.data)?i.data:Array.isArray(i?.rows)?i.rows:[]).map(jn).filter($=>$&&$.serial!=="-").filter($=>!$.status||$.status==="pending");Ve(B),ze(!0)}catch{Ve([]),ze(!0)}finally{t||Ft(!1)}};l.useEffect(()=>{if(!xt){Ve([]),ze(!1);return}Ve([]),ze(!1),vt({silent:!0})},[xt,_e]),l.useEffect(()=>{o==="NH"&&(a.setFieldsValue({executive:Oa}),a.setFieldsValue({branch:Va}))},[o,a]),l.useEffect(()=>{je($e==="scooter"?["Side Stand","Floor Mat","ISI Helmet","Grip Cover"]:["Tank Cover","Gripper","Seat Cover","ISI Helmet"])},[$e]);const zt=l.useMemo(()=>Ye(d.map(t=>t.company)),[d]),Cn=l.useMemo(()=>{const t=F(x),n=t?d.filter(s=>F(s.company)===t):d;return Ye(n.map(s=>s.model))},[d,x]),Nn=l.useMemo(()=>{const t=F(x),n=F(u),s=d.filter(r=>!(t&&F(r.company)!==t||n&&F(r.model)!==n));return Ye(s.map(r=>r.variant))},[d,x,u]),Pn=t=>{if(T(t),!R){const n=F(x),s=F(u),r=F(t),g=d.find(c=>F(c.company)===n&&F(c.model)===s&&F(c.variant)===r)?.onRoadPrice||0;a.setFieldsValue({onRoadPrice:g}),ee(g),ne(0)}},An=(t,n)=>(t>0?(n||0)/t:0)>=.3?Ra:Ea,Qe=(t,n,s)=>{const i=Math.max(Number(t||0)-Number(n||0),0)+Ma,g=s/12,c=An(t,n),B=i*(c/100)*g,$=i+B;return s>0?$/s:0},kn=t=>t==="12"?[12,18,24,36]:[24,30,36,48],Lt=async()=>{if(xe.current)return null;xe.current=!0,Ie(!0);try{if(Date.now()-Y<6e3)return null;const n=await $n();return fe(Date.now()),n}finally{xe.current=!1,Ie(!1)}},wt=async()=>{try{if(Date.now()<K)return;Se(6e3),Be(!0),await new Promise(j=>setTimeout(j,0)),await $t(a),await Lt(),await Wt("Saved (background sync). Preparing printâ€¦");const t=Ht.current;if(!t){window.print();return}await new Promise(j=>setTimeout(j,0));const n=t.cloneNode(!0);n.querySelectorAll("canvas").forEach(j=>{try{const y=document.createElement("img");y.alt=j.getAttribute("aria-label")||"canvas",y.src=j.toDataURL("image/png"),y.style.maxWidth="100%",y.style.height="auto",j.parentNode&&j.parentNode.replaceChild(y,j)}catch{}}),n.querySelectorAll("img").forEach(j=>{const y=j.getAttribute("src");y&&!y.startsWith("data:")&&j.setAttribute("src",bn(y))});const s=`
        @page { size: A4 portrait; margin: 0; }
        html, body {
          margin: 0 !important; padding: 0 !important; background: #fff !important;
          -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important;
          font-family: Arial, sans-serif;
        }
        * { box-sizing: border-box; }
        .print-wrap { margin: 0 auto; }
        .page { width: 210mm; min-height: 297mm; padding: 12mm; background: #fff !important; }
        .sheet { width: 100%; font: 12pt/1.32 Arial, sans-serif; color: #111; page-break-inside: avoid; }
        .row2 { display: grid; grid-template-columns: 0.8fr 1.4fr; gap: 8px 16px; }
        .row3 { display: grid; grid-template-columns: 0.5fr 0.8fr 1fr; gap: 10px 16px; }
        .box { border: 2px solid #000; border-radius: 6px; padding: 8px 10px; background: #fff; }
        .plist { margin: 0; padding-left: 18px; } .plist li { margin: 0 0 2px; }
        .title-knhonda { font-size: 30pt; font-weight: 900; letter-spacing: .2px; }
        .title-kn { font-size: 32pt; font-weight: 500; letter-spacing: .2px; }
        .title-en { font-size: 18pt; font-weight: 600; margin-top: 2px; }
        .big-price { font-size: 16pt; font-weight: 900; }
        .addr-line { font-size: 11pt; } .addr-linehonda { font-size: 12pt; }
        .hdr-line { display:flex; align-items:center; border-bottom:2px solid #000; padding-bottom:6px; margin-bottom:8px; }
        .hdr-title { flex: 1; display: flex; justify-content: center; }
        .quo-box { font-size: 17pt; border: 2px solid #000; padding: 4px 10px; font-weight: 800; display: inline-block; }
        .hdr-right { text-align: right; font-weight: 600; }
        .emibox { border: 2px solid #000; border-radius: 8px; padding: 6px 10px; text-align: center; }
        .section-title { font-size: 14pt; font-weight: 900; margin-bottom: 4px; }
        img { max-width: 100%; height: auto; background: transparent; }
        @media print {
          * { transform: none !important; }
          .fixed, .sticky, [style*="position: sticky"], [style*="position: fixed"] { position: static !important; }
          .no-print { display: none !important; }
        }
      `;if(/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)){const j=window.open("","_blank");if(!j){ge.error("Please allow pop-ups to print.");return}const y=j.document;y.open(),y.write(`
          <!doctype html>
          <html>
          <head>
            <meta charset="utf-8"/>
            <meta name="viewport" content="width=device-width, initial-scale=1"/>
            <base href="${location.origin}${location.pathname}">
            <title>Quotation</title>
            <style>${s}</style>
          </head>
          <body>
            <div class="print-wrap"></div>
          </body>
          </html>
        `),y.close();const _=y.querySelector(".print-wrap"),L=y.importNode(n,!0);_.appendChild(L),await(async()=>{const W=Array.from(y.images||[]);if(await Promise.all(W.map(z=>z.complete&&z.naturalWidth?Promise.resolve():new Promise(v=>{z.onload=z.onerror=()=>v()}))),y.fonts&&y.fonts.ready)try{await y.fonts.ready}catch{}await new Promise(z=>setTimeout(z,200))})();try{j.focus()}catch{}j.print(),setTimeout(St,1e3);return}const i=document.createElement("iframe");i.style.position="fixed",i.style.right="0",i.style.bottom="0",i.style.width="0",i.style.height="0",i.style.border="0",i.setAttribute("aria-hidden","true"),document.body.appendChild(i);const g=i.contentWindow,c=g.document;c.open(),c.write(`
        <!doctype html>
        <html>
        <head>
          <meta charset="utf-8"/>
          <meta name="viewport" content="width=device-width, initial-scale=1"/>
          <base href="${location.origin}${location.pathname}">
          <title>Quotation</title>
          <style>${s}</style>
        </head>
        <body>
          <div class="print-wrap"></div>
        </body>
        </html>
      `),c.close(),c.querySelector(".print-wrap").appendChild(c.importNode(n,!0));const $=async()=>{const j=Array.from(c.images||[]);if(await Promise.all(j.map(y=>y.complete&&y.naturalWidth?Promise.resolve():new Promise(_=>{y.onload=y.onerror=()=>_()}))),c.fonts&&c.fonts.ready)try{await c.fonts.ready}catch{}await new Promise(y=>setTimeout(y,200))};try{await $();try{g.focus()}catch{}try{g.print()}catch{window.print()}setTimeout(St,1e3)}finally{setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},800)}}catch(t){ge.warning(t?.message||"Fix the highlighted fields before printing.");try{await a.validateFields(lt)}catch(n){It(a,n)}return}finally{Be(!1)}},Ut=l.useRef(wt);l.useEffect(()=>{Ut.current=wt}),l.useEffect(()=>{const t=n=>{(n.ctrlKey||n.metaKey)&&(n.key==="p"||n.key==="P")&&(n.preventDefault(),Ut.current?.())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]);const In=(t,n)=>{if(t&&typeof t=="object"){const s={};Object.keys(t).forEach(r=>{const i=t[r];s[r]=typeof i=="string"?i.toUpperCase():i}),Object.keys(s).length&&a.setFieldsValue(s)}if(typeof n?.onRoadPrice<"u"&&(ee(Number(n.onRoadPrice||0)),ie>Number(n.onRoadPrice||0)&&ne(Number(n.onRoadPrice||0))),typeof n?.downPayment<"u"){const s=Number(n.downPayment||0);ne(s)}},St=()=>{a.resetFields(),m("SHANTHA"),N(""),p(""),T(""),ee(0),M(!me),ae("loan"),te("12"),ne(0),We("scooter"),je(["Side Stand","Floor Mat","ISI Helmet","Grip Cover"]),De(kt),w([]),Oe(!0),ve(Z().add(2,"day").hour(10).minute(0).second(0).millisecond(0)),Pe(""),gt({serialNo:"",savedAt:"",createdAt:""});const t={};D&&(t.branch=D),Me&&(t.executive=Me),Object.keys(t).length&&a.setFieldsValue(t),ge.success("Form has been reset for a new quotation.")},_t=C.useWatch("branch",a),Qt=C.useWatch("executive",a),Gt=C.useWatch("name",a),Yt=C.useWatch("mobile",a),Kt=C.useWatch("company",a),Xt=C.useWatch("bikeModel",a),Jt=C.useWatch("variant",a),Zt=C.useWatch("onRoadPrice",a),jt=l.useMemo(()=>{const t=/^[6-9]\d{9}$/.test(String(Yt||"")),n=Number(Zt||0)>0;return!!(_t&&Qt&&Gt&&t&&Kt&&Xt&&Jt&&n)},[_t,Qt,Gt,Yt,Kt,Xt,Jt,Zt]),$n=async()=>{try{await $t(a)}catch(v){Ee.error(v?.message||"Please complete all required fields.");try{await a.validateFields(lt)}catch(S){It(a,S)}throw v}const t=await a.validateFields(["name","mobile","address","company","bikeModel","variant","onRoadPrice","executive","remarks","branch",...O==="loan"?["downPayment"]:[]]);for(let v=0;v<le.length;v++){const S=le[v];if(!S.company||!S.model||!S.variant||!S.onRoadPrice)throw new Error(`Please complete Vehicle ${v+2} before saving.`);if(O==="loan"){const Q=Number(S.downPayment||0);if(!(Q>0))throw new Error(`Enter down payment for Vehicle ${v+2} (loan)`);if(Q>Number(S.onRoadPrice||0))throw new Error(`Down payment for Vehicle ${v+2} cannot exceed its on-road price`)}}let n=String(a.getFieldValue("serialNo")||"").trim();if(!n||!/^Q-[A-Z]+-[A-Z0-9]{6}$/.test(n))try{n=await Da(t.mobile,He||(a.getFieldValue("branchCode")||"").toUpperCase(),Xe),a.setFieldsValue({serialNo:n})}catch{n=Z().format("YYMMDDHHmmss"),a.setFieldsValue({serialNo:n})}t.serialNo=n;const r=(v,S,Q)=>[v,S,Q].filter(Boolean).join(" "),i=[];{const v=t.company||"",S=t.bikeModel||"",Q=t.variant||"",Re=r(v,S,Q);Re&&i.push(`V1: ${Re}`)}le.forEach((v,S)=>{const Q=r(v.company||"",v.model||"",v.variant||"");Q&&i.push(`V${S+2}: ${Q}`)});const g=Array.isArray(ue)&&ue.length?`Fittings: ${Array.from(new Set(ue.filter(Boolean))).join(", ")}`:"",c=[String(t.remarks||"").trim(),...i,g].filter(Boolean).join(" | "),B=new Date().toISOString(),$=String(et?.serialNo||"").trim(),j=String(t.serialNo||"").trim(),y=$&&j&&$===j,_=y?String(et?.savedAt||"").trim():"",L=y?String(et?.createdAt||et?.savedAt||"").trim():"",q={version:2,savedAt:_||B,createdAt:L||_||B,updatedAt:B,brand:o,mode:O,vehicleType:$e,fittings:ue,docsReq:be,emiSet:E,downPayment:ie,onRoadPrice:X,address:t.address||"",followUp:{enabled:!!Ne,at:Ne&&pe&&Z(pe).isValid()?Z(pe).toISOString():null,notes:String(Je||""),updatedAt:B,status:"pending"},formValues:{address:t.address,onRoadPrice:t.onRoadPrice,downPayment:Number(t.downPayment||0)},extraVehicles:le};gt({serialNo:t.serialNo,savedAt:q.savedAt,createdAt:q.createdAt});const W={serialNo:t.serialNo,formValues:{name:t.name,mobile:t.mobile,address:t.address,company:t.company,bikeModel:t.bikeModel,variant:t.variant,executive:t.executive,remarks:c,branch:t.branch||""},payload:q},z=fn({type:"quot",data:W});return setTimeout(async()=>{try{const v=await qa(W);(v?.data||v)?.success!==!1&&Ot(z)}catch{}},0),{values:t,queued:!0}},Mn=t=>{const n=String(t||"").replace(/\D/g,"").replace(/^0+/,"");return n.length===10?`91${n}`:n.startsWith("91")&&n.length===12?n:""},Rn=async()=>{try{if(Date.now()<K)return;Se(6e3),await $t(a),await Lt(),await Wt("Saved (background sync). Opening WhatsAppâ€¦");const t=a.getFieldsValue(!0),n=Mn(t.mobile);if(!n){ge.error("Enter a valid 10-digit Indian mobile to open WhatsApp.");return}const s=o==="SHANTHA"?"Shantha Motors":"NH Motors",r=(a.getFieldValue("name")||"-").trim(),i=(x||a.getFieldValue("company")||"-").trim(),g=(u||a.getFieldValue("bikeModel")||"-").trim(),c=(A||a.getFieldValue("variant")||"-").trim(),B=a.getFieldValue("onRoadPrice")??X??0,j=[{title:"Vehicle 1",company:i,model:g,variant:c,price:B,dp:ie||0,emiSet:E},...le.map((V,Nt)=>({title:`Vehicle ${Nt+2}`,company:V.company,model:V.model,variant:V.variant,price:V.onRoadPrice,dp:V.downPayment||0,emiSet:V.emiSet||"12"}))],y=(()=>{try{return JSON.parse(localStorage.getItem("user")||"null")}catch{return null}})(),_=String(yt||"").replace(/\D/g,""),L=t.executive||tt||y?.formDefaults?.staffName||y?.name||"-",q=Z().format("DD-MM-YYYY HH:mm"),W=[`*Hi ${r}, Welcome to ${s}! ðŸï¸*`,"Multi-brand two-wheeler sales, service, spares, exchange, finance & insurance","*Mob No - 9731366921 / 8073283502*","",`â€¢ *Quotation Date:* ${q}`],z=V=>V==="12"?[12,18,24,36]:[24,30,36,48],v=j.map(V=>{const Nt=z(V.emiSet),On=O==="loan"?[`   â€“ Down Payment: ${ce(V.dp||0)}`,...Nt.map(tn=>`   â€“ ${tn} months: ${ce(Qe(V.price,V.dp||0,tn))}`)]:[];return["",`*${V.title}:*`,`â€¢ *Vehicle:* ${V.company} ${V.model} ${V.variant}`,`â€¢ *On-Road Price:* ${ce(V.price)}`,...O==="loan"?["â€¢ *EMI Options (approx.):*",...On]:[]].join(`
`)}),S=Array.isArray(ue)?ue.filter(Boolean):[],Q=Array.isArray(be)?be.filter(Boolean):[],Re=["",...S.length?["*Free Extra Fittings:*",...S.map(V=>`   âœ… ${V}`)]:[],...Q.length?["","*Documents Required:*",...Q.map(V=>`   ðŸ“„ ${V}`)]:[]],Ct=["",`â€¢ *Sales Executive:* ${L} (${_||"-"})`,"*Our Locations* ðŸ“","Muddinapalya â€¢ Hegganahalli â€¢ Nelagadrahalli â€¢ Andrahalli","Kadabagere â€¢ Channenahalli â€¢ Tavarekere ","","â€¢ *Note:* Prices are indicative and may change without prior notice.","",`âœ¨ *${s} â€” Ride with Pride, Drive with Confidence.* âœ¨`],at=[...W,...v,...Re,...Ct].join(`
`),Ge=`https://wa.me/${n}?text=${encodeURIComponent(at)}`;window.open(Ge,"_blank","noopener,noreferrer")||(window.location.href=Ge),setTimeout(St,1e3)}catch(t){ge.warning(t?.message||"Please fill all required fields before sending on WhatsApp.");try{await a.validateFields(lt)}catch(n){It(a,n)}}},en=({items:t})=>t?.length?e.jsx("ul",{className:"plist",children:t.map((n,s)=>e.jsx("li",{children:n},`${n}-${s}`))}):e.jsx("span",{children:"-"}),En=t=>Ye(d.filter(n=>F(n.company)===F(t)).map(n=>n.model)),Dn=(t,n)=>Ye(d.filter(s=>F(s.company)===F(t)&&F(s.model)===F(n)).map(s=>s.variant)),we=(t,n)=>{w(s=>{const r=[...s],i={...r[t],...n};if(!R&&n.variant){const g=d.find(c=>F(c.company)===F(i.company||"")&&F(c.model)===F(i.model||"")&&F(c.variant)===F(n.variant));g&&(i.onRoadPrice=g.onRoadPrice||0,i.downPayment=0)}return!R&&n.company&&(i.model="",i.variant="",i.onRoadPrice=0,i.downPayment=0),!R&&n.model&&(i.variant="",i.onRoadPrice=0,i.downPayment=0),r[t]=i,r})},Fn=()=>{w(t=>t.length>=3?t:[...t,za()])},Tn=t=>{w(n=>n.filter((s,r)=>r!==t))};return e.jsxs(e.Fragment,{children:[yn,e.jsx("style",{children:`
        .wrap { max-width: 1000px; margin: 12px auto; padding: 0 12px; }
        .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 10px; padding: 12px; }
        /* Make header actions stack on small screens */
        @media screen and (max-width: 600px) {
          .brand-actions-row { grid-template-columns: 1fr !important; row-gap: 8px; }
          .brand-actions { align-items: flex-start !important; }
        }
        .print-sheet { display: none; }
        @media print { .print-sheet { display: block; } .no-print { display: none !important; } }
      `}),e.jsx("div",{className:"wrap no-print",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8}}),e.jsx(C,{layout:"vertical",form:a,initialValues:{},onValuesChange:In,children:e.jsxs(on,{gutter:[12,8],children:[e.jsx(P,{span:24,children:e.jsxs("div",{className:"brand-actions-row",style:{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center",gap:12},children:[e.jsx(C.Item,{label:"Brand on Print",style:{marginBottom:0},children:e.jsxs(G.Group,{value:o,onChange:t=>m(t.target.value),children:[e.jsx(G,{value:"SHANTHA",children:"Shantha Motors"}),e.jsx(G,{value:"NH",children:"NH Motors (Honda)"})]})}),e.jsxs("div",{className:"brand-actions",style:{display:"flex",flexDirection:"row",gap:8,alignItems:"center"},children:[e.jsx(Na,{form:a,webhookUrl:Ke,EXECUTIVES:At,setBrand:m,setMode:ae,setVehicleType:We,setFittings:je,setDocsReq:De,setEmiSet:te,setDownPayment:ne,setOnRoadPrice:ee,setCompany:N,setModel:p,setVariant:T,setExtraVehicles:w,setFollowUpEnabled:Oe,setFollowUpAt:ve,setFollowUpNotes:Pe,onPayloadApplied:gt,autoApply:pn,buttonText:"Fetch Details",buttonProps:{style:{background:"#2ECC71",borderColor:"#2ECC71",color:"#fff"}}}),e.jsx(re,{type:"default",style:{borderColor:"#2f6de1",color:"#1e4ca1",fontWeight:600},onClick:async()=>{Ze(!0),await vt()},children:nt===null?"PendingCases":`PendingCases (${nt})`})]})]})}),e.jsx(Mt,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx("span",{style:{width:24,height:24,borderRadius:8,background:"#eef3ff",color:"#2f6de1",fontWeight:700,display:"inline-flex",alignItems:"center",justifyContent:"center"},children:"P"}),e.jsx("span",{style:{fontWeight:700},children:nt!==null?`PendingCases (${nt})`:"PendingCases"})]}),open:mn,onCancel:()=>Ze(!1),width:820,styles:{body:{paddingTop:8}},footer:[e.jsx(re,{icon:e.jsx(la,{}),onClick:()=>vt(),children:"Refresh"},"refresh"),e.jsx(re,{type:"primary",onClick:()=>Ze(!1),children:"Close"},"close")],children:hn?e.jsx("div",{style:{display:"flex",justifyContent:"center",padding:16},children:e.jsx(rn,{})}):pt.length?e.jsx(ct,{size:"small",dataSource:pt,renderItem:t=>{const n=String(t.name||"-").trim(),s=String(t.mobile||"-").trim()||"-",r=String(t.vehicle||"-").trim(),i=String(t.branch||"-").trim(),g=String(t.followUpAt||"-").trim(),c=String(t.createdAt||"-").trim(),B=[n,s,r,i].filter(Boolean).join(" | "),$=(n&&n!=="-"?n[0]:"P").toUpperCase();return e.jsx(ct.Item,{style:{paddingInline:0,paddingBlock:6},children:e.jsxs("div",{style:{width:"100%",display:"grid",gridTemplateColumns:"1fr auto",alignItems:"start",gap:10,padding:"10px 12px 12px",borderRadius:12,border:"1px solid #d5e5ff",background:"#ffffff"},children:[e.jsxs("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column",gap:10},title:B,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,flexWrap:"nowrap"},children:[e.jsx("div",{style:{width:34,height:34,borderRadius:"50%",background:"#2f6de1",color:"#fff",fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center"},children:$}),e.jsx("span",{style:{fontSize:24,lineHeight:1.1,fontWeight:800,color:"#111827",textTransform:"uppercase"},children:n}),e.jsx("span",{style:{fontSize:11,lineHeight:1.1,color:"#6b7280",fontWeight:600,whiteSpace:"nowrap"},children:`Created: ${c} | FU: ${g}`})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"nowrap",marginLeft:2,overflow:"hidden"},children:[e.jsx("span",{style:{padding:"2px 10px",borderRadius:999,background:"#eaf1ff",border:"1px solid #c9dbff",color:"#1e4ca1",fontWeight:700,letterSpacing:.2,fontSize:20},children:s}),e.jsx("span",{style:{color:"#9aa5bb",fontWeight:700,fontSize:18},children:"|"}),e.jsx("span",{style:{padding:"2px 10px",borderRadius:999,background:"#eef3ff",border:"1px solid #d2dcf5",color:"#2b4f92",fontWeight:700,fontSize:16,textTransform:"uppercase"},children:i}),e.jsx("span",{style:{color:"#9aa5bb",fontWeight:700,fontSize:18},children:"|"}),e.jsx("span",{style:{padding:"2px 10px",borderRadius:999,background:"#fff6e8",border:"1px solid #f2cf90",color:"#925f00",fontWeight:700,fontSize:14,textTransform:"uppercase",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:330},children:r})]})]}),e.jsx(re,{type:"primary",icon:e.jsx(Ca,{}),style:{minWidth:84,height:34,borderRadius:8,fontWeight:700,marginTop:2},onClick:()=>{t?.payload&&(gn({payload:t.payload,values:t.values||{},token:Date.now()}),Ze(!1),Ve(j=>j.filter(y=>y.serial!==t.serial)))},children:"Open"})]})})}}):e.jsx("div",{style:{color:"#666"},children:"No pending quotations."})}),e.jsx(P,{span:24,children:e.jsxs(C.Item,{label:"Type manually (no sheet)",valuePropName:"checked",children:[e.jsx(Rt,{checked:R,onChange:M}),e.jsx("span",{style:{marginLeft:8,color:"#666"},children:me?"You can still switch to manual if needed.":"Sheet unavailable â€” manual mode enabled."})]})}),e.jsx(P,{xs:24,sm:12,md:6,children:e.jsx(C.Item,{label:"Quotation No.",name:"serialNo",children:e.jsx(J,{placeholder:"Auto at save",readOnly:!0})})}),e.jsx(P,{xs:24,sm:12,md:6,children:e.jsx(C.Item,{label:"Branch",name:"branch",rules:[{required:!0,message:"Branch is required"}],children:H&&Ce.length?e.jsx(Ae,{placeholder:"Select branch",value:Ue,onChange:t=>wn(t),options:Ce.map(t=>({value:t.name,label:t.name}))}):e.jsx(J,{readOnly:!0,placeholder:"Auto-fetched from your profile"})})}),e.jsx(P,{xs:24,sm:12,md:6,children:e.jsx(C.Item,{label:"Executive Name",name:"executive",rules:[{required:!0,message:"Executive is required"}],children:H?e.jsx(Ae,{showSearch:!0,optionFilterProp:"label",placeholder:"Select executive",options:(Te.length?Te:At).map(t=>({value:t.name,label:t.name}))}):e.jsx(J,{readOnly:!0,placeholder:"Auto-fetched from your profile"})})}),e.jsx(P,{xs:24,sm:12,md:6,children:e.jsx(C.Item,{label:"Payment Mode",children:e.jsxs(G.Group,{optionType:"button",buttonStyle:"solid",value:O,onChange:t=>ae(t.target.value),children:[e.jsx(G.Button,{value:"loan",children:"Loan"}),e.jsx(G.Button,{value:"cash",children:"Cash"})]})})}),e.jsx(P,{xs:24,sm:12,md:12,children:e.jsx(C.Item,{label:"Customer Name",name:"name",rules:[{required:!0,message:"Enter name"},Ha],getValueFromEvent:t=>{const n=t?.target?.value??t;return typeof n=="string"?Wa(n):n},children:e.jsx(J,{placeholder:"CUSTOMER NAME",style:{textTransform:"uppercase"}})})}),e.jsx(P,{xs:24,sm:12,md:12,children:e.jsx(C.Item,{label:"Mobile Number",name:"mobile",rules:Ba,normalize:t=>t&&t.replace(/\D/g,"").slice(0,10),children:e.jsx(J,{placeholder:"10-digit mobile",maxLength:10})})}),e.jsx(P,{xs:24,children:e.jsx(C.Item,{label:"Address",name:"address",rules:[{message:"Enter address"}],children:e.jsx(J.TextArea,{rows:2,placeholder:"House No, Street, Area, City, PIN"})})}),e.jsx(P,{span:24,children:e.jsx(Pt,{orientation:"left",children:"Vehicle 1"})}),e.jsx(P,{xs:24,sm:12,md:8,children:e.jsx(C.Item,{label:"Company",name:"company",rules:[{required:!0,message:"Enter company"}],children:R?e.jsx(J,{placeholder:"Type company",onChange:t=>N(t.target.value)}):e.jsx(Ae,{placeholder:"Select Company",options:zt.map(t=>({value:t,label:t})),onChange:t=>{N(t),p(""),T(""),ee(0),ne(0),a.setFieldsValue({bikeModel:void 0,variant:void 0,onRoadPrice:void 0})}})})}),e.jsx(P,{xs:24,sm:12,md:8,children:e.jsx(C.Item,{label:"Model",name:"bikeModel",rules:[{required:!0,message:"Enter model"}],children:R?e.jsx(J,{placeholder:"Type model",onChange:t=>p(t.target.value)}):e.jsx(Ae,{placeholder:"Select Model",disabled:!x,options:Cn.map(t=>({value:t,label:t})),onChange:t=>{p(t),T(""),ee(0),ne(0),a.setFieldsValue({variant:void 0,onRoadPrice:void 0})}})})}),e.jsx(P,{xs:24,sm:12,md:8,children:e.jsx(C.Item,{label:"Variant",name:"variant",rules:[{required:!0,message:"Enter variant"}],children:R?e.jsx(J,{placeholder:"Type variant",onChange:t=>T(t.target.value)}):e.jsx(Ae,{placeholder:"Select Variant",disabled:!u,options:Nn.map(t=>({value:t,label:t})),onChange:Pn})})}),e.jsx(P,{xs:24,sm:12,md:24,children:e.jsx(C.Item,{label:"On-Road Price (â‚¹)",name:"onRoadPrice",rules:[{required:!0,message:"Enter on-road price"},()=>({validator(t,n){return Number(n||0)>0?Promise.resolve():Promise.reject(new Error("On-road price must be greater than 0"))}})],children:e.jsx(ot,{style:{width:"100%"},readOnly:!R,formatter:t=>`â‚¹ ${String(t??"0").replace(/\B(?=(\d{3})+(?!\d))/g,",")}`,parser:t=>String(t||"0").replace(/[â‚¹,\s]/g,"")})})}),O==="loan"&&e.jsxs(e.Fragment,{children:[e.jsx(P,{xs:24,sm:12,md:12,children:e.jsx(C.Item,{label:"Down Payment (â‚¹)",name:"downPayment",rules:[{required:!0,message:"Down payment is required for loan"},()=>({validator(t,n){const s=Number(n||0);return!Number.isFinite(s)||s<=0?Promise.reject(new Error("Enter a positive amount")):s>Number(X||0)?Promise.reject(new Error("Down payment cannot exceed on-road price")):Promise.resolve()}})],children:e.jsx(ot,{style:{width:"100%"},min:0,max:X,step:1e3,value:ie,onChange:t=>{const n=Math.min(Number(t||0),X||0);ne(n),a.setFieldsValue({downPayment:n})},formatter:t=>`â‚¹ ${String(t??"0").replace(/\B(?=(\d{3})+(?!\d))/g,",")}`,parser:t=>String(t||"0").replace(/[â‚¹,\s]/g,"")})})}),e.jsx(P,{xs:24,children:e.jsx(C.Item,{label:"EMI Set",children:e.jsxs(G.Group,{value:E,onChange:t=>te(t.target.value),children:[e.jsx(G,{value:"12",children:"12"}),e.jsx(G,{value:"48",children:"48"})]})})}),e.jsx(P,{xs:24,children:e.jsx("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:oe.map(t=>e.jsxs("div",{className:"emibox",style:{minWidth:140},children:[e.jsxs("div",{style:{fontWeight:700},children:[t," months"]}),e.jsx("div",{style:{fontWeight:900,fontSize:16},children:ce(Qe(X,ie,t))})]},t))})})]}),e.jsx(P,{xs:24,md:12,children:e.jsx(C.Item,{label:"Vehicle Type",name:"vehicleType",children:e.jsxs(G.Group,{optionType:"button",buttonStyle:"solid",value:$e,onChange:t=>We(t.target.value),children:[e.jsx(G.Button,{value:"scooter",children:"Scooter"}),e.jsx(G.Button,{value:"motorcycle",children:"Motorcycle"})]})})}),e.jsx(P,{xs:24,md:12,children:e.jsx(C.Item,{label:"Free Extra Fittings (shown on print)",children:e.jsx(it.Group,{value:ue,onChange:je,children:($e==="scooter"?Fa:Ta).map(t=>e.jsx("div",{style:{marginBottom:6},children:e.jsx(it,{value:t,children:t})},t))})})}),e.jsx(P,{xs:24,children:e.jsx(C.Item,{label:"Documents Required (always printed)",children:e.jsx(it.Group,{value:be,onChange:De,children:kt.map((t,n)=>e.jsx("div",{style:{marginBottom:6},children:e.jsx(it,{value:t,children:t})},`${t}-${n}`))})})}),e.jsx(P,{span:24,children:e.jsx(Pt,{orientation:"left",children:"Follow-up"})}),e.jsx(P,{xs:24,md:8,children:e.jsx(C.Item,{label:"Schedule follow-up?",children:e.jsx(Rt,{checked:Ne,onChange:Oe})})}),e.jsx(P,{xs:24,md:8,children:e.jsx(C.Item,{label:"Follow-up date & time",children:e.jsx(Ln,{showTime:!0,style:{width:"100%"},value:pe,onChange:ve,disabled:!Ne})})}),e.jsx(P,{xs:24,md:8,children:e.jsx(C.Item,{label:"Follow-up notes",children:e.jsx(J,{placeholder:"e.g., Customer will decide after salary",value:Je,onChange:t=>Pe(t.target.value),disabled:!Ne})})}),e.jsxs(P,{span:24,children:[e.jsx(Pt,{orientation:"left",children:"Additional Vehicles"}),le.map((t,n)=>{const s=n+2,r=R?[]:En(t.company),i=R?[]:Dn(t.company,t.model),g=kn(t.emiSet||"12");return e.jsx("div",{style:{border:"1px dashed #d4d4d8",borderRadius:8,padding:12,marginBottom:12},children:e.jsxs(on,{gutter:[12,8],align:"middle",children:[e.jsx(P,{span:24,children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("strong",{children:["Vehicle ",s]}),e.jsx(re,{danger:!0,type:"text",icon:e.jsx(Sa,{}),onClick:()=>Tn(n),children:"Remove"})]})}),e.jsx(P,{xs:24,md:8,children:R?e.jsx(J,{placeholder:"Company",value:t.company,onChange:c=>we(n,{company:c.target.value})}):e.jsx(Ae,{placeholder:"Select Company",value:t.company||void 0,options:zt.map(c=>({value:c,label:c})),onChange:c=>we(n,{company:c})})}),e.jsx(P,{xs:24,md:8,children:R?e.jsx(J,{placeholder:"Model",value:t.model,onChange:c=>we(n,{model:c.target.value})}):e.jsx(Ae,{placeholder:"Select Model",disabled:!t.company,value:t.model||void 0,options:r.map(c=>({value:c,label:c})),onChange:c=>we(n,{model:c})})}),e.jsx(P,{xs:24,md:8,children:R?e.jsx(J,{placeholder:"Variant",value:t.variant,onChange:c=>we(n,{variant:c.target.value})}):e.jsx(Ae,{placeholder:"Select Variant",disabled:!t.model,value:t.variant||void 0,options:i.map(c=>({value:c,label:c})),onChange:c=>we(n,{variant:c})})}),e.jsx(P,{xs:24,md:12,children:e.jsx(ot,{style:{width:"100%"},placeholder:"On-Road Price (â‚¹)",value:t.onRoadPrice,readOnly:!R,onChange:c=>we(n,{onRoadPrice:Number(c||0)}),formatter:c=>`â‚¹ ${String(c??"0").replace(/\B(?=(\d{3})+(?!\d))/g,",")}`,parser:c=>String(c||"0").replace(/[â‚¹,\s]/g,"")})}),O==="loan"&&e.jsxs(e.Fragment,{children:[e.jsx(P,{xs:24,md:12,children:e.jsx(ot,{style:{width:"100%"},placeholder:"Down Payment (â‚¹)",min:0,max:t.onRoadPrice||0,step:1e3,value:t.downPayment||0,onChange:c=>we(n,{downPayment:Math.min(Number(c||0),t.onRoadPrice||0)}),formatter:c=>`â‚¹ ${String(c??"0").replace(/\B(?=(\d{3})+(?!\d))/g,",")}`,parser:c=>String(c||"0").replace(/[â‚¹,\s]/g,"")})}),e.jsxs(P,{xs:24,children:[e.jsxs(G.Group,{value:t.emiSet||"12",onChange:c=>we(n,{emiSet:c.target.value}),style:{marginBottom:8},children:[e.jsx(G,{value:"12",children:"12"}),e.jsx(G,{value:"48",children:"48"})]}),e.jsx("div",{style:{display:"flex",gap:10,flexWrap:"wrap"},children:g.map(c=>e.jsxs("div",{className:"emibox",style:{minWidth:140},children:[e.jsxs("div",{style:{fontWeight:700},children:[c," months"]}),e.jsx("div",{style:{fontWeight:900,fontSize:16},children:ce(Qe(t.onRoadPrice||0,t.downPayment||0,c))})]},c))})]})]})]})},n)}),e.jsx(re,{icon:e.jsx(da,{}),onClick:Fn,disabled:le.length>=3,children:"Add Vehicle"}),le.length>=3&&e.jsx("span",{style:{marginLeft:8,color:"#666"},children:"(Maximum 4 vehicles per quotation)"})]}),e.jsxs(P,{span:24,style:{textAlign:"right"},children:[e.jsx("div",{style:{marginBottom:8,textAlign:"left",color:"#888",fontSize:12},children:!jt&&e.jsxs("span",{children:["Fill ",e.jsx("b",{children:"Branch"}),", ",e.jsx("b",{children:"Executive"}),", ",e.jsx("b",{children:"Customer Name"}),", ",e.jsx("b",{children:"Mobile"}),", and ",e.jsx("b",{children:"Vehicle Details"})," to proceed."]})}),e.jsx(re,{className:"no-print",onClick:Rn,disabled:!jt||he||K>0,style:{marginRight:8,background:"#25D366",borderColor:"#25D366",color:"#fff"},children:"WhatsApp"}),e.jsx(re,{className:"no-print",type:"primary",icon:e.jsx(ca,{}),onClick:wt,disabled:!jt||he||K>0||se,loading:se,children:"Print"})]})]})})]})}),e.jsx("div",{className:"print-sheet",children:e.jsx("div",{className:"page",ref:Ht,children:e.jsxs("div",{className:"sheet",children:[e.jsxs("div",{className:"hdr-line",children:[e.jsxs("div",{style:{textAlign:"center",marginRight:12},children:[e.jsx("img",{src:"/location-qr.png",alt:"Location QR",style:{height:50,objectFit:"contain"}}),e.jsx("div",{style:{fontSize:8,fontWeight:600,marginTop:4},children:"Scan for Location"})]}),e.jsx("div",{className:"hdr-title",children:e.jsx("div",{className:"quo-box",children:"QUOTATION"})}),e.jsxs("div",{className:"hdr-right",children:[e.jsxs("div",{children:["Sl. No.: ",a.getFieldValue("serialNo")||"-"]}),e.jsxs("div",{children:["Date: ",xn]})]})]}),e.jsx("div",{style:{borderBottom:"2px solid #000",paddingBottom:6,marginBottom:8},children:e.jsxs("div",{className:"brand-row2",style:{display:"grid",gridTemplateColumns:"1fr auto",columnGap:16,alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",gap:10,flexWrap:"wrap",marginBottom:4,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:o==="SHANTHA"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title-kn",style:{fontSize:"25pt",fontWeight:800},children:"à²¶à²¾à²‚à²¤ à²®à³‹à²Ÿà²°à³à²¸à³"}),e.jsx("div",{className:"title-en",style:{fontSize:"20pt",fontWeight:800},children:"Shantha Motors"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"title-knhonda",style:{fontSize:"25pt",fontWeight:800},children:"à²Žà²¨à³ à²Žà²šà³ à²®à³‹à²Ÿà²°à³à²¸à³"}),e.jsx("div",{className:"title-en",style:{fontSize:"18pt",fontWeight:700},children:"NH Motors"})]})}),o==="SHANTHA"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"addr-line",style:{fontSize:"13pt"},children:"â€¢ Muddinapalya â€¢ Hegganahalli   â€¢ Nelagadrahalli  â€¢ Andrahalli"}),e.jsx("div",{className:"addr-line",style:{fontSize:"13pt"},children:"â€¢ Kadabagere   â€¢ Channenahali  â€¢ Tavarekere"}),e.jsx("div",{style:{marginTop:6,fontWeight:600},children:"Mob: 9731366921 / 8073283502 / 9035131806"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"addr-linehonda",style:{fontSize:"12pt"},children:"Site No. 116/1, Bydarahalli, Magadi Main Road, Opp. HP Petrol Bunk, Bangalore - 560091"}),e.jsx("div",{style:{marginTop:6,fontWeight:600},children:"Mob: 9731366921 / 8073283502 / 9741609799"})]})]}),e.jsx("div",{className:"brand-right",style:{display:"flex",flexDirection:"row",alignItems:"center",gap:16,justifyContent:"flex-end"},children:e.jsx("img",{src:o==="SHANTHA"?"/shantha-logoprint.jpg":"/honda-logo.png",alt:"Brand Logo",style:{height:130,objectFit:"contain"}})})]})}),e.jsxs("div",{className:"box",style:{marginBottom:8},children:[e.jsx("div",{className:"section-title",children:"Customer Details"}),e.jsxs("div",{className:"row2",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Name:"})," ",a.getFieldValue("name")||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Mobile:"})," ",a.getFieldValue("mobile")||"-"]}),e.jsxs("div",{style:{gridColumn:"1 / span 2"},children:[e.jsx("b",{children:"Address:"})," ",a.getFieldValue("address")||"-"]})]})]}),e.jsxs("div",{className:"box",style:{marginBottom:8},children:[e.jsx("div",{className:"section-title",children:"Vehicle 1 Details"}),e.jsxs("div",{className:"row3",style:{fontSize:"12pt"},children:[e.jsxs("div",{children:[e.jsx("b",{children:"Company:"})," ",x||a.getFieldValue("company")||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Model:"})," ",u||a.getFieldValue("bikeModel")||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Variant:"})," ",A||a.getFieldValue("variant")||"-"]})]}),e.jsx("div",{style:{marginTop:6,textAlign:"center"},children:e.jsxs("span",{className:"big-price",children:[e.jsxs("span",{children:[e.jsx("b",{children:"On-Road Price:"})," "]}),ce(a.getFieldValue("onRoadPrice")??X??0)]})})]}),O==="loan"&&e.jsx("div",{className:"box",style:{marginBottom:8},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"0.5fr 2fr",gap:12,alignItems:"start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4,fontSize:"12pt"},children:"Down Payment"}),e.jsx("div",{style:{fontWeight:800,fontSize:"18pt"},children:ce(ie||0)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:900,textAlign:"center",marginBottom:4,fontSize:"14pt"},children:"EMI DETAILS"}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"space-between",flexWrap:"wrap"},children:oe.map(t=>e.jsxs("div",{className:"emibox",style:{flex:1,minWidth:120},children:[e.jsxs("div",{style:{fontWeight:700},children:[t," months"]}),e.jsx("div",{style:{fontWeight:900},children:ce(Qe(X,ie,t))})]},t))})]})]})}),le.map((t,n)=>{const s=n+2,r=(t.emiSet||"12")==="12"?[12,18,24,36]:[24,30,36,48];return e.jsxs("div",{children:[e.jsxs("div",{className:"box",style:{marginBottom:8},children:[e.jsxs("div",{className:"section-title",children:["Vehicle ",s," Details"]}),e.jsxs("div",{className:"row3",style:{fontSize:"12pt"},children:[e.jsxs("div",{children:[e.jsx("b",{children:"Company:"})," ",t.company||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Model:"})," ",t.model||"-"]}),e.jsxs("div",{children:[e.jsx("b",{children:"Variant:"})," ",t.variant||"-"]})]}),e.jsx("div",{style:{marginTop:6,textAlign:"center"},children:e.jsxs("span",{className:"big-price",children:[e.jsxs("span",{children:[e.jsx("b",{children:"On-Road Price:"})," "]}),ce(t.onRoadPrice||0)]})})]}),O==="loan"&&e.jsx("div",{className:"box",style:{marginBottom:8},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"0.5fr 2fr",gap:12,alignItems:"start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4,fontSize:"12pt"},children:"Down Payment"}),e.jsx("div",{style:{fontWeight:800,fontSize:"18pt"},children:ce(t.downPayment||0)})]}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:900,textAlign:"center",marginBottom:4,fontSize:"14pt"},children:"EMI DETAILS"}),e.jsx("div",{style:{display:"flex",gap:8,justifyContent:"space-between",flexWrap:"wrap"},children:r.map(i=>e.jsxs("div",{className:"emibox",style:{minWidth:140},children:[e.jsxs("div",{style:{fontWeight:700},children:[i," months"]}),e.jsx("div",{style:{fontWeight:900},children:ce(Qe(t.onRoadPrice||0,t.downPayment||0,i))})]},i))})]})]})})]},n)}),e.jsxs("div",{className:"box",style:{marginBottom:8},children:[e.jsxs("div",{style:{marginBottom:6,fontSize:"13pt",fontWeight:700},children:[e.jsx("b",{children:"Executive name:"})," ",tt||"-",yt?` (${yt})`:""]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"0.6fr 1fr 1fr",gap:16,alignItems:"start"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:"Free Extra Fittings"}),e.jsx(en,{items:ue})]}),e.jsx("div",{style:{minHeight:120,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600},children:e.jsx("img",{src:"/shantha-access.png",alt:"Accessories",style:{height:140,margin:"6px 0"}})}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:700,marginBottom:4},children:"Documents Required"}),e.jsx(en,{items:be})]})]})]}),e.jsxs("div",{style:{fontSize:"9.5pt",display:"flex",justifyContent:"space-between"},children:[e.jsx("div",{}),e.jsxs("div",{children:[e.jsx("b",{children:"Note:"})," Prices are indicative and subject to change without prior notice."]})]})]})})})]})}export{vo as default};

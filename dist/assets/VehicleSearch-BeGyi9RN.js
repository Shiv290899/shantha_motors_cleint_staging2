import{r as c,j as t,u as Ht}from"./index-Cpnbu_hS.js";import{u as Gt,B as Zt,d as xt,f as Jt}from"./BookingForm-JiXzIKjQ.js";import{d as Yt,l as Qt,u as J,t as x,n as S,m as Xt,D as eo,A as to,s as oo,a as so}from"./caseInsensitive-DUicqe8X.js";import{e as Mt}from"./StockUpdate-D-ASYu6-.js";import{G as At}from"./index-BzB-oRld.js";import{F as oe}from"./index-DNb1SccI.js";import{S as H}from"./index-Bh1aWF1p.js";import{S as K,R as st,E as nt}from"./index-D-dakd2l.js";import{I as Re,s as B}from"./index-LPdCTC9Y.js";import{B as z}from"./button-BatQfFEZ.js";import{T as de}from"./index-B0Jdr43N.js";import{F as no}from"./Table-CrLdrUTt.js";import{M as Ye}from"./index-_eB-6_5d.js";import{L as He,d as It}from"./index-6X0CyMNZ.js";import{P as ro,h as ao}from"./PostServiceSheet-B3EW42tp.js";import{C as rt}from"./index-DCQr-s-B.js";import{z as lo,A as wt}from"./TextArea-R_tc8-o2.js";import{D as io}from"./index-CNSeZdFE.js";import{T as co}from"./index-1WhPD5b5.js";function Vo(){const l=!At.useBreakpoint().md,[o,m]=c.useState(!1),[f,Y]=c.useState([]),[P,G]=c.useState(!1),[le,I]=c.useState([]),[k,ie]=c.useState("all"),[ce,xe]=c.useState(""),[_,Ne]=c.useState([]),[,me]=c.useState([]),[,Ee]=c.useState([]),[$,F]=c.useState([]),[W,Me]=c.useState([]),[Q,we]=c.useState([]),[ue,Ce]=c.useState([]),[he,Fe]=c.useState([]),[Qe,Le]=c.useState(1),[Pe,w]=c.useState(25),se=c.useMemo(()=>`InStock:list:${k||"all"}`,[k]),[_e,ze]=c.useState(!1),[$e,Be]=c.useState(null),[ge,Ue]=c.useState(null),[Xe,a]=c.useState(!1),[r,u]=c.useState(null),[d,p]=c.useState(!1),[M]=oe.useForm(),[X,pe]=c.useState(!1),[V,ee]=c.useState(null),[T,ve]=c.useState(null),[fe,j]=c.useState(!1),[U]=oe.useForm(),N="https://docs.google.com/spreadsheets/d/e/2PACX-1vQYGuNPY_2ivfS7MTX4bWiu1DWdF2mrHSCnmTznZVEHxNmsrgcGWjVZN4UDUTOzQQdXTnbeM-ylCJbB/pub?gid=408799621&single=true&output=csv",C={company:["Company","Company Name"],model:["Model","Model Name"],variant:["Variant"],color:["Color","Colours","Colors","Colour","Available Colors"]},D=(e,s)=>String(s.map(n=>e[n]??"").find(n=>n!=="")||"").trim(),L=e=>e?String(e).split(/[|,/;\n]+/).map(s=>s.trim()).filter(Boolean):[],Z=(e={})=>({company:D(e,C.company),model:D(e,C.model),variant:D(e,C.variant),color:D(e,C.color)}),ye=e=>{const s=[];let n=[],i="",h=!1;for(let g=0;g<e.length;g++){const v=e[g],O=e[g+1];if(v==='"'&&!h){h=!0;continue}if(v==='"'&&h){if(O==='"'){i+='"',g++;continue}h=!1;continue}if(v===","&&!h){n.push(i),i="";continue}if((v===`
`||v==="\r")&&!h){(i!==""||n.length)&&(n.push(i),s.push(n),n=[],i=""),v==="\r"&&O===`
`&&g++;continue}i+=v}return(i!==""||n.length)&&(n.push(i),s.push(n)),s},q=async e=>{const s=await fetch(e,{cache:"no-store"});if(!s.ok)throw new Error("Sheet fetch failed");const n=await s.text();if(n.trim().startsWith("<"))throw new Error("Expected CSV, got HTML");const i=ye(n);if(!i.length)return[];const h=i[0].map(g=>(g||"").trim());return i.slice(1).map(g=>{const v={};return h.forEach((O,ae)=>v[O]=g[ae]??""),v})},[R,te]=c.useState([]),[ne,Ve]=c.useState(!1),[re,ct]=c.useState(""),[Ae,et]=c.useState(""),[tt,We]=c.useState("");c.useEffect(()=>{(async()=>{try{const s=(await q(N)).map(Z).filter(n=>n.company&&n.model&&n.variant);te(s),Ve(s.length>0)}catch{te([]),Ve(!1)}})()},[]);const Rt=c.useMemo(()=>[...new Set(R.map(e=>e.company))],[R]),zt=c.useMemo(()=>[...new Set(R.filter(e=>e.company===re).map(e=>e.model))],[R,re]),Bt=c.useMemo(()=>[...new Set(R.filter(e=>e.company===re&&e.model===Ae).map(e=>e.variant))],[R,re,Ae]),dt=c.useMemo(()=>{const e=R.filter(n=>n.company===re&&n.model===Ae&&n.variant===tt).flatMap(n=>L(n.color)),s=new Map;return e.forEach(n=>{const i=String(n).toLowerCase();s.has(i)||s.set(i,n)}),Array.from(s.values())},[R,re,Ae,tt]),be=c.useMemo(()=>{try{return JSON.parse(localStorage.getItem("user")||"null")}catch{return null}},[]),mt=c.useMemo(()=>String(be?.role||"").toLowerCase(),[be]),ut=c.useMemo(()=>["admin","owner","backend"].includes(mt),[mt]);c.useEffect(()=>{(async()=>{try{const s=(await Yt({limit:100,status:"active"}).catch(()=>null))?.data?.items||(await Qt({status:"active",limit:100})).data.items||[],n=J((s||[]).map(i=>i?.name));I(n)}catch{I([])}})()},[]),c.useEffect(()=>{try{const e=localStorage.getItem(se);if(!e){G(!1);return}const s=JSON.parse(e);s&&Array.isArray(s.items)?(Y(s.items),G(!0)):G(!1)}catch{G(!1)}},[se]);const De=async()=>{m(!0);try{const e=await Jt({branch:k==="all"?void 0:k,limit:1e3}),n=(Array.isArray(e?.data)?e.data:[]).map((i,h)=>({key:i._id||i.movementId||h,ts:i.timestamp||i.createdAt||"",chassis:i.chassisNo||"",company:i.company||"",model:i.model||"",variant:i.variant||"",color:i.color||"",branch:i.sourceBranch||i.branch||"",status:i.status||"in stock",movementId:i.movementId||i.lastMovementId||"",lastMovementId:i.lastMovementId||i.movementId||"",notes:i.notes||""}));Y(n),G(!0);try{localStorage.setItem(se,JSON.stringify({at:Date.now(),items:n}))}catch{}}catch{P||Y([]),G(!1)}finally{m(!1)}};c.useEffect(()=>{De()},[k]),c.useEffect(()=>{Ne(J(f.map(e=>e.company))),me(J(f.map(e=>e.model))),Ee(J(f.map(e=>e.variant)))},[f]);const Ut=c.useMemo(()=>{const e=x($),s=e.size?f.filter(n=>e.has(S(n.company))):f;return J(s.map(n=>n.model))},[f,$]),Vt=c.useMemo(()=>{const e=x($),s=e.size?f.filter(h=>e.has(S(h.company))):f,n=x(W),i=n.size?s.filter(h=>n.has(S(h.model))):s;return J(i.map(h=>h.variant))},[f,$,W]),Dt=c.useMemo(()=>{const e=x($),s=e.size?f.filter(v=>e.has(S(v.company))):f,n=x(W),i=n.size?s.filter(v=>n.has(S(v.model))):s,h=x(Q),g=h.size?i.filter(v=>h.has(S(v.variant))):i;return J(g.map(v=>v.color))},[f,$,W,Q]),Ot=e=>{const s=x(e),n=s.size?f.filter(A=>s.has(S(A.company))):f,i=J(n.map(A=>A.model)),h=x(i),g=W.filter(A=>h.has(S(A))),v=x(g),O=v.size?n.filter(A=>v.has(S(A.model))):n,ae=J(O.map(A=>A.variant)),Se=x(ae),b=Q.filter(A=>Se.has(S(A))),Oe=x(b),Ke=Oe.size?O.filter(A=>Oe.has(S(A.variant))):O,E=J(Ke.map(A=>A.color)),St=x(E),Te=ue.filter(A=>St.has(S(A)));Me(g),we(b),Ce(Te),F(e)},Et=e=>{const s=x($),n=s.size?f.filter(E=>s.has(S(E.company))):f,i=x(e),h=i.size?n.filter(E=>i.has(S(E.model))):n,g=J(h.map(E=>E.variant)),v=x(g),O=Q.filter(E=>v.has(S(E))),ae=x(O),Se=ae.size?h.filter(E=>ae.has(S(E.variant))):h,b=J(Se.map(E=>E.color)),Oe=x(b),Ke=ue.filter(E=>Oe.has(S(E)));we(O),Ce(Ke),Me(e)},Ft=e=>{const s=x($),n=s.size?f.filter(b=>s.has(S(b.company))):f,i=x(W),h=i.size?n.filter(b=>i.has(S(b.model))):n,g=x(e),v=g.size?h.filter(b=>g.has(S(b.variant))):h,O=J(v.map(b=>b.color)),ae=x(O),Se=ue.filter(b=>ae.has(S(b)));Ce(Se),we(e)},Ie=c.useMemo(()=>{const e=String(ce||"").toLowerCase(),s=!!e,[n,i]=Array.isArray(he)?he:[],h=n&&typeof n?.toDate=="function"?n.toDate():null,g=i&&typeof i?.toDate=="function"?i.toDate():null,v=x($),O=x(W),ae=x(Q),Se=x(ue);return f.filter(b=>{if(s&&![b.chassis,b.company,b.model,b.variant,b.color,b.branch].some(A=>String(A||"").toLowerCase().includes(e))||!(v.size?v.has(S(b.company)):!0)||!(O.size?O.has(S(b.model)):!0)||!(ae.size?ae.has(S(b.variant)):!0)||!(Se.size?Se.has(S(b.color)):!0))return!1;if(h||g){const Te=new Date(b.ts);if(Number.isNaN(Te.getTime())||h&&Te<h)return!1;if(g){const A=new Date(g);if(A.setHours(23,59,59,999),Te>A)return!1}}return!0})},[f,ce,$,W,Q,ue,he]),ht=c.useMemo(()=>{const e=new Map;return(Ie||[]).forEach(s=>{const n=Xt(s.branch)||"Unassigned",i=S(n)||"unassigned";e.has(i)||e.set(i,{label:n,count:0});const h=e.get(i);h.count+=1}),Array.from(e.values()).sort((s,n)=>n.count-s.count).map(({label:s,count:n})=>[s,n])},[Ie]);c.useEffect(()=>{Le(1)},[ce,$,W,Q,ue,he,k]);const pt=f.length,Lt=e=>{const s={company:e.company||"",bikeModel:e.model||"",variant:e.variant||"",color:e.color||"",chassisNo:e.chassis||"",purchaseType:"cash",addressProofMode:"aadhaar",executive:be?.name||be?.email||"",branch:e.branch||""};Be(s),Ue(e),ze(!0)},Pt=e=>{u(e),a(!0),ct(e.company||""),et(e.model||""),We(e.variant||""),M.setFieldsValue({company:e.company||void 0,model:e.model||void 0,variant:e.variant||void 0,color:e.color||void 0,notes:e.notes||void 0})},ft=(e,s)=>{ee(e),ve(s),U.resetFields(),pe(!0)},gt=()=>{pe(!1),ee(null),ve(null),U.resetFields()},_t=async()=>{if(!T||!V){B.warning("Select a vehicle first.");return}try{const e=await U.validateFields();j(!0);const s={Chassis_No:String(T.chassis||"").toUpperCase(),Company:T.company||"",Model:T.model||"",Variant:T.variant||"",Color:T.color||"",Action:V,Source_Branch:T.branch||"",Notes:e.notes||""};V==="transfer"&&(s.Target_Branch=e.targetBranch||""),V==="return"&&(s.Return_To=e.returnTo||"");const n=await xt({data:s,createdBy:be?.name||be?.email||"user"});if(n?.success){const i=V==="transfer"?"Transfer recorded and waiting for admit by the target branch.":"Return recorded.";B.success(i),gt(),De()}else B.error(n?.message||"Save failed")}catch(e){if(e?.errorFields)return;B.error("Save failed")}finally{j(!1)}},qe=e=>String(e||"").trim(),vt={display:"flex",flexDirection:"column",gap:2,lineHeight:1.2},ot={whiteSpace:"normal",wordBreak:"break-word",overflowWrap:"anywhere"},yt={...ot,fontSize:11,color:"#475569"},$t=e=>{const s=String(e||"").toLowerCase();let n="#d1d5db";s.includes("white")?n="#ffffff":s.includes("black")?n="#111827":s.includes("maroon")||s.includes("wine")?n="#800000":s.includes("gold")?n="#d4af37":s.includes("copper")?n="#b87333":s.includes("purple")||s.includes("violet")?n="#8b5cf6":s.includes("brown")?n="#8b4513":s.includes("starlight")&&s.includes("blue")?n="#60a5fa":s.includes("ps")&&s.includes("blue")?n="#1e3a8a":s.includes("decent")&&s.includes("blue")?n="#3b82f6":s.includes("blue")?n="#2563eb":s.includes("deep")&&s.includes("ground")&&s.includes("grey")?n="#374151":s.includes("mat")&&s.includes("grey")?n="#6b7280":s.includes("genny")&&s.includes("grey")?n="#9ca3af":s.includes("silver")?n="#c0c0c0":s.includes("grey")?n="#9ca3af":s.includes("milit")?n="#4b5320":s.includes("green")?n="#10b981":s.includes("yellow")?n="#f59e0b":s.includes("orange")?n="#f97316":s.includes("red")&&(n="#ef4444");const i=n==="#ffffff"?"#e5e7eb":s.includes("silver")?"#9ca3af":"#d1d5db";return t.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:6},children:[t.jsx("span",{style:{width:12,height:12,borderRadius:3,background:n,border:`1px solid ${i}`}}),e||"-"]})},bt=[{title:"Chassis + Branch",key:"chassisBranch",width:l?void 0:180,render:(e,s)=>t.jsxs("div",{style:vt,children:[t.jsx("div",{style:{...ot,fontFamily:"ui-monospace, SFMono-Regular, Menlo, monospace"},children:s.chassis||"-"}),t.jsx("div",{style:yt,children:s.branch||"-"})]})},{title:"Company || Model + Variant || Color",key:"modelVariantColor",width:l?void 0:220,render:(e,s)=>{const n=qe(s.company),i=qe(s.model),h=qe(s.variant),g=qe(s.color);return t.jsxs("div",{style:vt,children:[t.jsx("div",{style:ot,children:[n,i].filter(Boolean).join(" || ")||"-"}),t.jsxs("div",{style:yt,children:[t.jsx("span",{children:h||"-"}),t.jsx("span",{children:h&&g?" || ":""}),g?$t(g):"-"]})]})}}],Wt={title:"Actions",key:"actions",width:l?void 0:200,fixed:l?void 0:"right",render:(e,s)=>ut?t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4},children:[t.jsxs(H,{size:4,children:[t.jsx(z,{size:"small",onClick:()=>ft("transfer",s),style:{fontSize:11,height:20,padding:"0 8px"},children:"Transfer"}),t.jsx(z,{size:"small",type:"primary",onClick:()=>Lt(s),style:{fontSize:11,height:20,padding:"0 8px"},children:"Book"})]}),t.jsxs(H,{size:4,children:[t.jsx(z,{size:"small",onClick:()=>ft("return",s),style:{fontSize:11,height:20,padding:"0 8px"},children:"Return"}),t.jsx(z,{size:"small",onClick:()=>Pt(s),style:{fontSize:11,height:20,padding:"0 8px"},children:"Edit"})]})]}):t.jsx("span",{style:{color:"#94a3b8"},children:"â€”"})},qt=ut?[...bt,Wt]:[...bt],Kt=()=>{if(!Ie.length){B.info("No vehicles to export for current filters");return}const e=[{key:"ts",label:"Timestamp"},{key:"chassis",label:"Chassis"},{key:"company",label:"Company"},{key:"model",label:"Model"},{key:"variant",label:"Variant"},{key:"color",label:"Color"},{key:"branch",label:"Branch"},{key:"status",label:"Status"},{key:"movementId",label:"Movement Id"}],s=Ie.map(n=>({ts:n.ts,chassis:n.chassis,company:n.company,model:n.model,variant:n.variant,color:n.color,branch:n.branch,status:n.status,movementId:n.movementId||n.lastMovementId}));Mt({filename:"in-stock.csv",headers:e,rows:s}),B.success(`Exported ${s.length} vehicles`)};return t.jsxs("div",{children:[t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",marginBottom:12,flexWrap:"wrap"},children:[t.jsxs(H,{size:"small",wrap:!0,children:[t.jsx(K,{value:k,onChange:ie,style:{minWidth:180},options:[{value:"all",label:"All Branches"},...le.map(e=>({value:e,label:e}))]}),t.jsx(Re,{placeholder:"Search chassis / company / model / color",allowClear:!0,value:ce,onChange:e=>xe(e.target.value),style:{minWidth:240}}),t.jsx(K,{mode:"multiple",allowClear:!0,placeholder:"Company",style:{minWidth:180},value:$,onChange:Ot,options:_.map(e=>({value:e,label:e})),maxTagCount:l?1:3}),t.jsx(K,{mode:"multiple",allowClear:!0,placeholder:"Model",style:{minWidth:180},value:W,onChange:Et,options:Ut.map(e=>({value:e,label:e})),maxTagCount:l?1:3}),t.jsx(K,{mode:"multiple",allowClear:!0,placeholder:"Variant",style:{minWidth:200},value:Q,onChange:Ft,options:Vt.map(e=>({value:e,label:e})),maxTagCount:l?1:3}),t.jsx(K,{mode:"multiple",allowClear:!0,placeholder:"Color",style:{minWidth:180},value:ue,onChange:Ce,options:Dt.map(e=>({value:e,label:e})),maxTagCount:l?1:3}),t.jsx(eo.RangePicker,{value:he,onChange:Fe,allowClear:!0,style:{minWidth:220}})]}),t.jsx("div",{style:{flex:1}}),t.jsxs(H,{children:[t.jsx(z,{onClick:Kt,children:"Export CSV"}),t.jsx(z,{onClick:()=>{F([]),Me([]),we([]),Ce([]),Fe([]),xe("")},children:"Reset Filters"}),t.jsx(z,{onClick:De,loading:o,children:"Refresh"})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8,flexWrap:"wrap"},children:[t.jsx(de,{color:"blue",style:{fontSize:12,padding:"4px 10px"},children:k==="all"?`Total In-Stock (All Branches): ${pt}`:`In-Stock (${k}): ${pt}`}),t.jsxs(de,{color:"geekblue",style:{fontSize:12,padding:"4px 10px"},children:["Showing: ",Ie.length]})]}),k==="all"&&ht.length>0&&t.jsxs("div",{style:{marginBottom:8},children:[t.jsx("span",{style:{fontWeight:600,marginRight:8},children:"Available at:"}),t.jsx(H,{size:[6,6],wrap:!0,children:ht.map(([e,s])=>t.jsxs(de,{color:"green",children:[e,": ",s]},`avail-${e}`))})]}),t.jsx(no,{dataSource:Ie,columns:qt,loading:o&&!P,size:"small",className:"compact-table stock-finder-table",tableLayout:l?"auto":"fixed",scroll:l?{x:"max-content"}:void 0,pagination:{current:Qe,pageSize:Pe,showSizeChanger:!0,pageSizeOptions:["10","25","50","100"],onChange:(e,s)=>{Le(e),s!==Pe&&w(s)},showTotal:(e,s)=>`${s[0]}-${s[1]} of ${e}`},rowKey:e=>e.chassis||e.key}),t.jsx(Ye,{title:r?`Edit In-Stock â€“ ${r.chassis}`:"Edit In-Stock",open:Xe,onCancel:()=>{a(!1),u(null),M.resetFields()},onOk:async()=>{try{const e=await M.validateFields();p(!0);const s={Company:e.company,Model:e.model,Variant:e.variant,Color:e.color,Notes:e.notes},n=r?.movementId||r?.lastMovementId;if(!n){B.warning("No movement found for this chassis. Try Refresh."),p(!1);return}const i=await Gt(n,s);i?.success?(B.success("Saved"),a(!1),u(null),M.resetFields(),De()):B.error(i?.message||"Save failed")}catch(e){if(e?.errorFields)return;B.error("Save failed")}finally{p(!1)}},okText:"Save",confirmLoading:d,destroyOnClose:!0,children:t.jsxs(oe,{form:M,layout:"vertical",children:[t.jsx(oe.Item,{name:"company",label:"Company",rules:[{required:!0}],children:t.jsx(K,{showSearch:!0,optionFilterProp:"children",placeholder:ne?"Select company":"Type company",value:re||void 0,onChange:e=>{ct(e),et(""),We(""),M.setFieldsValue({model:void 0,variant:void 0})},disabled:!ne,children:Rt.map(e=>t.jsx(K.Option,{value:e,children:e},e))})}),t.jsx(oe.Item,{name:"model",label:"Model",rules:[{required:!0}],children:t.jsx(K,{showSearch:!0,optionFilterProp:"children",placeholder:ne?"Select model":"Type model",value:Ae||void 0,onChange:e=>{et(e),We(""),M.setFieldsValue({variant:void 0})},disabled:!ne||!re,children:zt.map(e=>t.jsx(K.Option,{value:e,children:e},e))})}),t.jsx(oe.Item,{name:"variant",label:"Variant",rules:[{required:!0}],children:t.jsx(K,{showSearch:!0,optionFilterProp:"children",placeholder:ne?"Select variant":"Type variant",value:tt||void 0,onChange:e=>We(e),disabled:!ne||!Ae,children:Bt.map(e=>t.jsx(K.Option,{value:e,children:e},e))})}),t.jsx(oe.Item,{name:"color",label:"Color",rules:[{required:!0}],children:dt.length?t.jsx(K,{showSearch:!0,optionFilterProp:"children",placeholder:"Select color",children:dt.map(e=>t.jsx(K.Option,{value:e,children:e},e))}):t.jsx(Re,{placeholder:"Color"})}),t.jsxs(oe.Item,{name:"notes",label:"Notes",children:[" ",t.jsx(Re.TextArea,{rows:3,placeholder:"Optional notes"})," "]})]})}),t.jsxs(Ye,{title:V==="transfer"?"Transfer Vehicle":V==="return"?"Return Vehicle":"Movement",open:X,onCancel:gt,onOk:_t,okText:"Save",confirmLoading:fe,destroyOnClose:!0,children:[T&&t.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"#475569"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Chassis:"})," ",T.chassis||"-"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Vehicle:"})," ",[T.company,T.model,T.variant,T.color].filter(Boolean).join(" ")||"-"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Branch:"})," ",T.branch||"-"]})]}),t.jsxs(oe,{form:U,layout:"vertical",children:[V==="transfer"&&t.jsx(oe.Item,{name:"targetBranch",label:"Target Branch",rules:[{required:!0,message:"Select target branch"}],children:t.jsx(K,{showSearch:!0,optionFilterProp:"children",placeholder:"Select branch",options:le.map(e=>({value:e,label:e}))})}),V==="return"&&t.jsx(oe.Item,{name:"returnTo",label:"Return To (Dealer/Area)",rules:[{required:!0,message:"Enter return destination"}],children:t.jsx(Re,{placeholder:"e.g., Kengaria / Dealer name"})}),t.jsx(oe.Item,{name:"notes",label:"Notes",children:t.jsx(Re.TextArea,{rows:3,placeholder:"Optional notes"})})]})]}),t.jsx(Ye,{title:"Book",open:_e,onCancel:()=>{ze(!1),Be(null),Ue(null)},footer:null,destroyOnClose:!0,width:980,children:t.jsx(Zt,{asModal:!0,initialValues:$e||{},autoUpdateStockOnSave:!1,onSuccess:async({response:e,payload:s})=>{try{const n=s?.vehicle||{},i={Chassis_No:String(n.chassisNo||ge?.chassis||"").toUpperCase(),Company:n.company||ge?.company||"",Model:n.model||ge?.model||"",Variant:n.variant||ge?.variant||"",Color:n.color||ge?.color||"",Action:"invoice",Customer_Name:s?.customerName||"",Source_Branch:ge?.branch||"",Notes:e?.bookingId?`Book via Booking ID ${e.bookingId}`:"Book via Booking form"};await xt({data:i,createdBy:be?.name||be?.email||"owner"}),B.success("Stock updated: vehicle marked booked / out of stock"),ze(!1),Be(null),Ue(null),De()}catch{B.error("Saved booking but failed to update stock. Please refresh and try again.")}}})})]})}const{Text:Ge}=co,mo="https://script.google.com/macros/s/AKfycbwSn5hp1cSWlJMGhe2cYUtid2Ruqh9H13mZbq0PwBpYB0lMLufZbIjZ5zioqtKgE_0sNA/exec",uo="https://script.google.com/macros/s/AKfycbxwuwETUUiAoFyksSoEOHVimCtlIZYb6JTQ7yJ8-vkwth9xYwEOlMA8ktiE45UQ6VA3Lg/exec",Ze="",at="",lt=mo,Ct=uo,ho=y=>{const l=["th","st","nd","rd"],o=y%100;return`${y}${l[(o-20)%10]||l[o]||l[0]}`},je=y=>String(y||"").replace(/\D/g,"").slice(-10),it=y=>je(y).length===10,ke=y=>String(y||"").toUpperCase().replace(/\s+/g,""),Je=/^[A-Z]{2}\d{2}[A-Z]{2}\d{4}$/,po=y=>{const l=String(y||"").toUpperCase();return/^[A-Z0-9]*$/.test(l)?[/^[A-Z]{0,2}$/,/^[A-Z]{2}\d{0,2}$/,/^[A-Z]{2}\d{2}[A-Z]{0,2}$/,/^[A-Z]{2}\d{2}[A-Z]{2}\d{0,4}$/].some(m=>m.test(l)):!1},kt={SONU:"7033558306",KARTHIK:"7338386813",MANMOHAN:"9956079799",MANSUR:"7795047627",IRSHAD:"6207176821",DAKSHAT:"7829096931",SALMAN:"7892335161"},jt=y=>{const l=String(y||"").trim();return l&&(kt[l]||kt[l.toUpperCase()])||""},Tt=y=>{const l=It(y);return l.isValid()?l:null},Nt=y=>{const l=y?.values||{},o=y?.payload||y||{},m=o.vehicle||{},f=je(o.mobileNumber||o.mobile||""),Y=Tt(o.ts||o.createdAt),P=_=>String(_||"").trim()||null,G=(Array.isArray(o.attachments)?o.attachments:[])||(Array.isArray(o.files)?o.files:[]),le=(_,Ne)=>Ne.map(me=>_?.[me]).find(me=>me!=null&&String(me).trim()!=="");let I=o.invoiceFileUrl||y?.invoiceFileUrl||o.invoiceUrl||o.invoiceLink||le(l,["Invoice File URL","Invoice","InvoiceFileUrl","InvoiceFileURL"])||le(o,["Invoice File URL","Invoice","InvoiceFileUrl","InvoiceFileURL"])||l?.invoiceFileUrl||l?.invoiceUrl||l?.invoiceLink||l?.["Invoice File URL"]||l?.Invoice||o["Invoice File URL"]||o.Invoice||null,k=o.insuranceFileUrl||y?.insuranceFileUrl||o.insuranceUrl||o.insuranceLink||l?.insuranceFileUrl||l?.insuranceUrl||l?.insuranceLink||l?.["Insurance File URL"]||l?.Insurance||o["Insurance File URL"]||o.Insurance||null;const ce=G.map(_=>P(_?.url||_?.fileId)).filter(Boolean).find(_=>_!==P(I)&&_!==P(k))||P(o.file?.url)||P(o.file?.fileId)||null,xe=I||o.bookingSheetUrl||o.file?.url||o.file?.fileId||l?.bookingSheetUrl||l?.file?.url||l?.file?.fileId||G?.[0]?.url||null;return{id:o.bookingId||o.serialNo||o.id||"",customerName:o.customerName||o.name||"",mobile:f,regNo:o.regNo||o.vehicleNo||o.registrationNumber||o["Vehicle No"]||o.Vehicle_No||o["Registration Number"]||o.RegNo||l["Vehicle No"]||l.Vehicle_No||l.vehicleNo||l["Reg No"]||l.RegNo||l["Registration Number"]||m.regNo||m.vehicleNo||m.registrationNumber||"",company:m.company||"",model:m.model||"",variant:m.variant||"",vehicle:[m.company,m.model,m.variant].filter(Boolean).join(" "),color:m.color||"",chassis:m.chassisNo||"",branch:o.branch||"",purchaseMode:o.purchaseMode||o.purchaseType||"",createdAt:Y,raw:o,billLink:xe,invoiceUrl:I,insuranceUrl:k,docsUrl:ce}},fo=y=>{const l=y||{},o=y?.payload||y?.values||l,m=o.formValues||o.values||{},f=m.custName||o.custName||o.customerName||o["Customer Name"]||o.name||"",Y=je(m.custMobile||o.custMobile||o.mobile||o["Mobile Number"]||o.Mobile||""),P=o.ts||o.timestamp||o.createdAt||o["Created At"]||m.createdAt||m.created_at||m.timestamp||"",G=m.regNo||m.vehicleNo||m.registrationNumber||o.RegNo||o["Vehicle No"]||o["Registration Number"]||"",le=o.billUrl||o.billLink||o.bill?.url||o.file?.url||(Array.isArray(o.attachments)?o.attachments[0]?.url:null)||null;return{jcNo:m.jcNo||o.jcNo||o["JC No"]||o["Job Card No"]||o["JC Number"]||"",serviceType:m.serviceType||o.serviceType||o["Service Type"]||o.Service||"",regNo:G,model:m.model||o.model||"",company:m.company||o.company||"",color:m.color||o.color||"",colour:m.colour||o.colour||o.color||"",custName:f,amount:o.totals&&o.totals.grand||o.amount||o["Service Amount"]||o["Collected Amount"]||"",paymentMode:o.paymentMode||o["Payment Mode"]||o.Payment_Mode||m.paymentMode||"",branch:m.branch||o.branch||"",mechanic:m.mechanic||o.mechanic||"",executive:m.executive||o.executive||"",remarks:o.remark||o.Remarks||o.remarkText||o["Remark Text"]||m.remarks||l.remarks||l.Remarks||l.remarkText||l["Remark Text"]||"",km:(()=>{const I=m.km||o.km||o.KM||o.KM||o["Odometer Reading"]||o.Odometer||o.totals&&o.totals.km||o.payload&&o.payload.km||o.payload&&o.payload.formValues&&o.payload.formValues.km||l.KM||l.KM||l.values&&(l.values.KM||l.values.KM||l.values["Odometer Reading"]||l.values.Odometer);return String(I||"").replace(/\D/g,"")||I||""})(),serviceNo:(()=>{const I=o.serviceNo||o.serviceNumber||o.visitNo||o.visit||m.serviceNo||o["Service No"]||o["Service #"]||o["Visit No"]||"",k=Number.parseInt(I,10);return Number.isFinite(k)?k:null})()||null,mobile:Y,createdAt:Tt(P),billLink:le,raw:o}};function Do(){const l=!At.useBreakpoint().md,o=Ht(),[m,f]=c.useState("vehicle"),[Y,P]=c.useState(""),[G,le]=c.useState(!1),[I,k]=c.useState([]),[ie,ce]=c.useState([]),[xe,_]=c.useState(""),[Ne,me]=c.useState(!1),[Ee,$]=c.useState(null),[F,W]=c.useState({open:!1,url:"",title:"",mobile:""}),Me=c.useRef(null),Q=c.useRef(0),we=a=>{const r=String(a||"").trim();if(!r)return"";const u=r.match(/\/d\/([a-zA-Z0-9_-]+)/);if(u?.[1])return`https://drive.google.com/file/d/${u[1]}/preview`;const d=r.match(/[?&]id=([a-zA-Z0-9_-]+)/);return r.includes("drive.google.com")&&d?.[1]?`https://drive.google.com/file/d/${d[1]}/preview`:r},ue=a=>{const r=String(a||"").trim();if(!r)return"";const u=r.match(/\/d\/([a-zA-Z0-9_-]+)/);return u?.[1]?u[1]:r.match(/[?&]id=([a-zA-Z0-9_-]+)/)?.[1]||""},Ce=a=>{const r=String(a||"").trim(),u=ue(r);return u?`https://drive.google.com/uc?export=download&id=${u}`:r},he=(a,r,u="")=>{const d=String(r||"").trim();d&&W({open:!0,title:a,url:d,mobile:String(u||"")})},Fe=()=>{const a=we(F.url);if(!a)return;const r=window.open(a,"_blank","noopener,noreferrer");if(!r){B.warning("Allow pop-ups to print this file.");return}try{r.focus(),setTimeout(()=>{try{r.print()}catch{}},900)}catch{}},Qe=()=>{const a=Ce(F.url);a&&window.open(a,"_blank","noopener,noreferrer")},Le=async()=>{const a=String(F.url||"").trim();if(a)try{await navigator.clipboard.writeText(a),B.success("Link copied.")}catch{B.error("Could not copy link.")}},Pe=()=>{const a=String(F.url||"").trim();if(!a)return;const r=String(F.mobile||"").replace(/\D/g,"");if(!r||r.length<10){B.warning("Customer mobile number is not available for WhatsApp.");return}const u=r.length===10?`91${r}`:r,d=`${F.title||"Document"}
${a}`,p=`https://wa.me/${u}?text=${encodeURIComponent(d)}`;window.open(p,"_blank","noopener,noreferrer")},w=I[0]||null,se=c.useMemo(()=>[...ie].sort((r,u)=>{const d=r.createdAt?r.createdAt.valueOf():0,p=u.createdAt?u.createdAt.valueOf():0;if(d!==p)return d-p;const M=Number.isFinite(r.serviceNo)?r.serviceNo:0,X=Number.isFinite(u.serviceNo)?u.serviceNo:0;return M-X}),[ie]),_e=async()=>{const a=String(Y||"").trim();if(!a){B.warning("Enter mobile or vehicle number to search");return}let r=a;if(m==="mobile"){const d=je(a);if(d.length!==10){B.error("Enter a valid 10-digit mobile number.");return}r=d}else{const d=ke(a);if(!Je.test(d)){B.error("Enter vehicle as KA03AB1234 (AA##AA####).");return}r=d}le(!0),_(""),k([]),ce([]);const u=Date.now();Q.current=u;try{const d=m==="mobile"?je(r)||r:ke(r),p=()=>Q.current===u,M=(j=[])=>{const U=new Set;return j.filter(N=>{const C=[String(N.jcNo||"").trim(),String(N.regNo||"").trim(),String(N.mobile||"").trim(),N.createdAt?.valueOf?.()||""].join("|");return C?U.has(C)?!1:(U.add(C),!0):!0})},X=async(j,U="GET")=>{const N=await oo({webhookUrl:lt,method:U,payload:j}),C=N?.data||N;return Array.isArray(C?.rows)?C.rows:[]},pe=(async()=>{let j=[];if(!(m==="mobile"||it(r)||r.toUpperCase().startsWith("BK-")||m==="vehicle"))return;const U=r.toUpperCase().startsWith("BK-")?{action:"search",mode:"booking",query:r.toUpperCase()}:m==="vehicle"&&!it(r)?{action:"search",mode:"vehicle",query:ke(r)}:{action:"search",mode:"mobile",query:je(r)||r};let N=!1;const C=async L=>{try{const ye=(await X(U,L)).map(q=>Nt(q));return ye.length&&!N&&p()&&(N=!0,j=ye,k(ye)),ye}catch(Z){return console.warn(`Booking search ${L} failed`,Z),[]}},D=await Promise.allSettled([C("GET"),C("POST")]);if(!j.length){const L=D.flatMap(Z=>Z.status==="fulfilled"&&Array.isArray(Z.value)?Z.value:[]);L.length&&p()&&(j=L,k(L))}return j})(),V=(async()=>{let j=[];const U=m==="vehicle"&&!it(r)?["reg","vehicle"]:["mobile","reg"];let N=!1;const C=(q=[])=>{const R=M(q.map(te=>fo(te)));return R.length&&!N&&p()&&(N=!0,j=R,ce(R)),R},D=[],L=(q,R,te)=>{D.push(so({webhookUrl:Ct,method:q,payload:R}).then(ne=>{const Ve=ne?.data||ne,re=Array.isArray(Ve?.rows)?Ve.rows:[];return C(re),{label:te,rows:re}}).catch(ne=>(console.warn(`Service call failed: ${te}`,ne),{label:te,rows:[]})))},Z=Ze?{action:"getServiceHistory",query:d,mode:m,secret:Ze}:{action:"getServiceHistory",query:d,mode:m};L("GET",Z,"history-get"),L("POST",Z,"history-post"),U.forEach(q=>{const R=Ze?{action:"search",mode:q,query:d,secret:Ze}:{action:"search",mode:q,query:d};L("GET",R,`search-${q}-get`),L("POST",R,`search-${q}-post`)});const ye=await Promise.allSettled(D);if(!j.length){const q=ye.flatMap(te=>te.status==="fulfilled"&&Array.isArray(te.value?.rows)?te.value.rows:[]),R=C(q);R.length&&(j=R)}return j})(),[ee,T]=await Promise.allSettled([pe,V]),ve=ee.status==="fulfilled"&&Array.isArray(ee.value)?ee.value:[],fe=T.status==="fulfilled"&&Array.isArray(T.value)?T.value:[];if(!ve.length&&m==="vehicle"&&lt&&fe.length){const j=je(fe[0]?.mobile||fe[0]?.custMobile||"");if(j.length===10){const U=at?{action:"search",mode:"mobile",query:j,secret:at}:{action:"search",mode:"mobile",query:j};try{let N=await X(U,"GET");N.length||(N=await X(U,"POST").catch(()=>[]));const C=N.map(D=>Nt(D));C.length&&p()&&k(C)}catch(N){console.warn("Fallback booking-by-mobile failed",N)}}}p()&&!ve.length&&!fe.length&&(k([]),ce([]),_("No records found. Check the number and try again."))}finally{Q.current===u&&le(!1)}},ze=w?[{label:"Customer",value:w.customerName||"-"},{label:"Mobile",value:w.mobile||"-"},{label:"Vehicle",value:w.vehicle||"-"},{label:"Color",value:w.color||"-"},{label:"Chassis",value:w.chassis||"-"},{label:"Branch",value:w.branch||"-"},{label:"Mode",value:(w.purchaseMode||"").toUpperCase()||"-"},{label:"Created",value:w.createdAt?w.createdAt.format("DD-MM-YYYY HH:mm"):"-"}]:[],$e=c.useMemo(()=>{const r=(se&&se.length?se[se.length-1]:null)||w;if(!r)return"";const d=(N=>{const C=String(N||"").trim();if(!C)return{company:"",model:""};const D=C.split(/\s+/).filter(Boolean);if(!D.length)return{company:"",model:""};const L=D[0],Z=D.length>1?D.slice(1).join(" "):C;return{company:L,model:Z}})(r.vehicle),p=w||{},M=new URLSearchParams,X=r.regNo||r.vehicleNo||r.registrationNumber||r.chassis||p.regNo||p.vehicleNo||p.registrationNumber||p.chassis||"",pe=ke(r.vehicle||p.vehicle||""),V=ke(Y||""),ee=m==="vehicle"&&Je.test(V)?V:Je.test(ke(X))?ke(X):Je.test(pe)?pe:"",T=r.company||p.company||d.company||"",ve=r.model||p.model||d.model||r.company||r.vehicle||"",fe=r.colour||r.color||r.colour||"",j=r.custName||r.customerName||"",U=r.mobile||r.custMobile||"";return ee&&M.set("regNo",ee),T&&M.set("company",T),ve&&M.set("model",ve),fe&&M.set("colour",fe),j&&M.set("custName",j),U&&M.set("custMobile",U),M.toString()},[se,w,m,Y]),Be=()=>{o($e?`/jobcard?${$e}`:"/jobcard")},ge=a=>{if(!a)return null;const r=a?.raw?.payload||a?.raw||{},u=r.formValues||a?.raw?.formValues||{},d=Array.isArray(r.labourRows)?r.labourRows:[],p=r.totals||{},M=d.reduce((V,ee)=>V+Number(ee?.qty||0)*Number(ee?.rate||0),0),X={labourSub:p.labourSub??M,labourGST:p.labourGST??0,labourDisc:p.labourDisc??0,grand:p.grand??M},pe=a.createdAt&&a.createdAt.toDate&&a.createdAt.toDate()||a.createdAt||r.postServiceAt||r.createdAt||new Date;return{vals:{jcNo:a.jcNo||u.jcNo||"",regNo:a.regNo||u.regNo||"",custName:a.custName||u.custName||"",custMobile:a.mobile||u.custMobile||"",km:u.km||"",model:a.model||u.model||"",colour:a.colour||u.colour||"",branch:a.branch||u.branch||"",executive:a.executive||u.executive||"",createdAt:pe,labourRows:d,gstLabour:p.gstLabour||p.labourGST||0},totals:X}},Ue=a=>{const r=ge(a);r&&($(r),me(!0),setTimeout(()=>{try{ao(Me.current)}catch{}setTimeout(()=>me(!1),500)},50))},Xe=()=>{const a=d=>{const p=It(d);return p.isValid()?p.format("DD-MM-YYYY HH:mm"):""},r=[];if(I.forEach((d,p)=>{r.push({type:"Booking",ref:d.id||`booking-${p+1}`,customer:d.customerName,mobile:d.mobile,vehicle:d.vehicle,color:d.color,chassis:d.chassis,branch:d.branch,createdAt:a(d.createdAt)})}),se.forEach((d,p)=>{r.push({type:"Service",ref:d.jcNo||`service-${p+1}`,customer:d.custName||d.customerName,mobile:d.mobile,vehicle:d.model||d.company,color:d.colour||d.color,chassis:d.regNo,branch:d.branch,createdAt:a(d.createdAt)})}),!r.length){B.info("No search results to export");return}Mt({filename:"vehicle-search.csv",headers:[{key:"type",label:"Type"},{key:"ref",label:"Reference"},{key:"customer",label:"Customer"},{key:"mobile",label:"Mobile"},{key:"vehicle",label:"Vehicle"},{key:"color",label:"Color"},{key:"chassis",label:"Chassis / Reg No"},{key:"branch",label:"Branch"},{key:"createdAt",label:"Created At"}],rows:r}),B.success(`Exported ${r.length} records`)};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{style:{padding:l?12:24,maxWidth:1200,margin:l?"12px auto":"24px auto",borderRadius:l?16:24,background:"radial-gradient(circle at top, #0f172a 0%, #020617 40%, #020617 100%)",boxShadow:"0 24px 60px rgba(15, 23, 42, 0.8)",border:"1px solid rgba(148, 163, 184, 0.2)"},children:[t.jsxs(rt,{title:t.jsxs(H,{align:"center",size:8,children:[t.jsx("span",{style:{fontSize:22,color:"#ef4444"},children:"ðŸï¸"}),t.jsx("span",{children:"Vehicle Search"})]}),extra:t.jsxs(H,{children:[t.jsx(z,{size:"small",onClick:Xe,disabled:!I.length&&!ie.length,children:"Export CSV"}),t.jsxs(st.Group,{value:m,onChange:a=>{const r=a.target.value;f(r),P("")},size:"small",children:[t.jsx(st.Button,{value:"vehicle",children:"Vehicle No"}),t.jsx(st.Button,{value:"mobile",children:"Mobile"})]})]}),bodyStyle:{padding:l?12:16,paddingBottom:l?10:12},style:{borderRadius:l?16:20,boxShadow:"0 18px 45px rgba(15, 23, 42, 0.25)",border:"1px solid rgba(148, 163, 184, 0.3)",overflow:"hidden"},headStyle:{background:"linear-gradient(135deg, #0f172a 0%, #1d4ed8 60%, #22c55e 100%)",color:"#ffffff",borderBottom:"none",fontSize:l?16:18,fontWeight:700,letterSpacing:.4},children:[t.jsxs(H.Compact,{style:{width:"100%"},children:[t.jsx(Re,{size:l?"middle":"large",placeholder:m==="mobile"?"Enter mobile number":"Enter vehicle number (e.g., KA03AB1234)",value:Y,onChange:a=>{const r=a.target.value||"";if(m==="mobile"){const d=r.replace(/\D/g,"").slice(0,10);P(d);return}const u=r.toUpperCase().replace(/[^A-Z0-9]/g,"");po(u)&&P(u)},onPressEnter:_e,allowClear:!0,style:{borderRadius:999,boxShadow:"0 10px 30px rgba(15, 23, 42, 0.2)",border:"1px solid rgba(148, 163, 184, 0.5)"}}),t.jsx(z,{type:"primary",size:l?"middle":"large",loading:G,onClick:_e,style:{borderRadius:999,paddingInline:l?18:28,boxShadow:"0 12px 30px rgba(37, 99, 235, 0.45)",fontWeight:600},children:"Search"})]}),xe&&t.jsx(to,{style:{marginTop:12},type:"warning",message:xe,showIcon:!0})]}),t.jsxs(lo,{gutter:[16,16],style:{marginTop:16},children:[t.jsx(wt,{xs:24,md:12,children:t.jsx(rt,{title:t.jsxs(H,{align:"center",size:6,children:[t.jsx("span",{style:{fontSize:18},children:"ðŸ“’"}),t.jsx("span",{children:"Booking Details"})]}),extra:t.jsx(de,{color:I.length?"green":"default",children:I.length?`${I.length} found`:"None"}),style:{borderRadius:16,boxShadow:"0 8px 24px rgba(15, 23, 42, 0.06)",border:"none",height:"100%"},headStyle:{fontWeight:600,borderBottom:"1px solid #e5e7eb"},bodyStyle:{padding:16},children:I.length?t.jsxs(t.Fragment,{children:[t.jsx(io,{size:"small",column:1,colon:!0,bordered:!0,items:ze.map(a=>({key:a.label,label:a.label,children:a.value||"-"}))}),t.jsxs(H,{wrap:!0,style:{marginTop:8},children:[w.invoiceUrl?t.jsx(z,{size:"small",type:"default",onClick:()=>he("Invoice Preview",w.invoiceUrl,w.mobile),children:"Invoice"}):null,w.insuranceUrl?t.jsx(z,{size:"small",type:"default",onClick:()=>he("Insurance Preview",w.insuranceUrl,w.mobile),children:"Insurance"}):null,w.docsUrl?t.jsx(z,{size:"small",type:"default",onClick:()=>he("Docs Preview",w.docsUrl,w.mobile),children:"Docs"}):null]}),I.length>1&&t.jsx(He,{style:{marginTop:12},size:"small",bordered:!0,dataSource:I.slice(1),renderItem:a=>t.jsx(He.Item,{children:t.jsxs(H,{direction:"vertical",size:2,children:[t.jsx(Ge,{strong:!0,children:a.customerName||"Booking"}),t.jsxs(Ge,{type:"secondary",children:[a.vehicle||"-"," â€¢ ",a.mobile||"-"]})]})})})]}):t.jsx(nt,{description:"No booking data"})})}),t.jsx(wt,{xs:24,md:12,children:t.jsx(rt,{title:t.jsxs(H,{align:"center",size:6,children:[t.jsx("span",{style:{fontSize:18},children:"ðŸ”§"}),t.jsx("span",{children:"Service History"})]}),extra:t.jsxs(H,{size:"small",children:[t.jsx(z,{size:"small",onClick:Be,children:"New Jobcard"}),t.jsx(de,{color:ie.length?"blue":"default",children:ie.length?`${ie.length} found`:"None"})]}),style:{borderRadius:16,boxShadow:"0 8px 24px rgba(15, 23, 42, 0.06)",border:"none",height:"100%"},headStyle:{fontWeight:600,borderBottom:"1px solid #e5e7eb"},bodyStyle:{padding:16},children:ie.length?t.jsx(He,{size:"small",dataSource:se,renderItem:(a,r)=>t.jsx(He.Item,{children:t.jsxs("div",{style:{width:"100%",border:"1px solid #e5e7eb",borderRadius:14,padding:18,background:"linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%)",minWidth:0,boxShadow:"0 6px 16px rgba(15, 23, 42, 0.06)"},children:[t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,alignItems:"flex-start"},children:[t.jsx(de,{color:"gold",style:{fontWeight:600},children:a.createdAt?a.createdAt.format("DD-MM-YYYY HH:mm"):"-"}),t.jsxs(H,{wrap:!0,size:[8,8],children:[t.jsxs(de,{color:"geekblue",children:[ho(a.serviceNo||r+1)," Service"]}),a.serviceType?t.jsx(de,{color:"cyan",children:a.serviceType}):null,a.branch?t.jsx(de,{color:"purple",children:a.branch}):null,a.jcNo?t.jsxs(de,{color:"green",children:["JC #",a.jcNo]}):null]})]}),t.jsxs("div",{style:{marginTop:10,display:"grid",gridTemplateColumns:"1.2fr 1fr 0.6fr",gap:10},children:[t.jsx("div",{style:{fontSize:16},children:a.model||a.company||"-"}),t.jsx("div",{style:{fontSize:16},children:a.colour||a.color||"-"}),t.jsx("div",{style:{fontSize:16},children:a.km?`${a.km} KM`:"-"})]}),t.jsxs("div",{style:{marginTop:8,display:"grid",gridTemplateColumns:"1fr 1fr auto",gap:10,alignItems:"center"},children:[t.jsx("div",{style:{fontSize:15,fontWeight:600},children:a.custName||a.customerName||"-"}),t.jsxs("div",{style:{fontSize:15},children:[a.mechanic||"-",jt(a.mechanic)?` â€¢ ${jt(a.mechanic)}`:""]}),t.jsx(z,{size:"small",type:"primary",ghost:!0,onClick:()=>Ue(a),children:"Service Invoice"},"invoice")]}),t.jsx("div",{style:{marginTop:10,display:"flex",justifyContent:"flex-end",gap:8},children:a.billLink?t.jsx(z,{size:"small",type:"link",href:a.billLink,target:"_blank",rel:"noreferrer",children:"View Bill"},"bill"):null}),a.remarks?t.jsxs("div",{style:{marginTop:6},children:[t.jsx(Ge,{strong:!0,children:"Remarks:"})," ",t.jsx(Ge,{type:"secondary",children:a.remarks})]}):null]})})}):t.jsx(nt,{description:"No service history"})})})]})]}),t.jsx(ro,{ref:Me,active:Ne,vals:Ee?.vals||{},totals:Ee?.totals||{}}),t.jsx(Ye,{open:F.open,title:F.title||"Document Preview",width:l?"96vw":1e3,onCancel:()=>W({open:!1,url:"",title:"",mobile:""}),footer:[t.jsx(z,{type:"primary",ghost:!0,onClick:Pe,children:"WhatsApp"},"whatsapp"),t.jsx(z,{onClick:Le,children:"Copy Link"},"copy-link"),t.jsx(z,{onClick:Qe,children:"Download"},"download"),t.jsx(z,{onClick:Fe,children:"Print"},"print"),t.jsx(z,{type:"primary",onClick:()=>window.open(F.url,"_blank","noopener,noreferrer"),children:"Open in new tab"},"new-tab"),t.jsx(z,{onClick:()=>W({open:!1,url:"",title:"",mobile:""}),children:"Close"},"close")],children:F.url?t.jsx("iframe",{title:F.title||"Document Preview",src:we(F.url),style:{width:"100%",height:l?"62vh":"70vh",border:"1px solid #e5e7eb",borderRadius:8}}):t.jsx(nt,{description:"No document URL available"})})]})}export{Vo as I,Do as V};
